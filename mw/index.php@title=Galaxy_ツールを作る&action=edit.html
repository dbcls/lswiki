<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="ja" dir="ltr">
<head>
<title>ソースを表示 - TogoWiki</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="MediaWiki 1.16.3" />
<meta name="robots" content="noindex,nofollow" />
<link rel="next" href="Galaxy_ツールを作る.html" />
<link rel="shortcut icon" href="http://wiki.lifesciencedb.jp/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="http://wiki.lifesciencedb.jp/mw/opensearch_desc.php" title="TogoWiki (ja)" />
<link rel="copyright" href="http://creativecommons.org/licenses/by/3.0/" />
<link rel="alternate" type="application/atom+xml" title="TogoWikiのAtomフィード" href="http://wiki.lifesciencedb.jp/mw/index.php?title=%E7%89%B9%E5%88%A5:%E6%9C%80%E8%BF%91%E3%81%AE%E6%9B%B4%E6%96%B0&amp;feed=atom" />
<!--[if IE 8]><link rel="stylesheet" href="/mw/skins/common/IE80Fixes.css?270" media="screen" /><![endif]-->
<link rel="stylesheet" href="http://wiki.lifesciencedb.jp/mw/skins/common/shared.css?270" media="screen" />
<link rel="stylesheet" href="http://wiki.lifesciencedb.jp/mw/skins/common/commonPrint.css?270" media="print" />
<link rel="stylesheet" href="http://wiki.lifesciencedb.jp/mw/skins/monobook/main.css?270" media="screen" />
<!--[if lt IE 5.5000]><link rel="stylesheet" href="/mw/skins/monobook/IE50Fixes.css?270" media="screen" /><![endif]-->
<!--[if IE 5.5000]><link rel="stylesheet" href="/mw/skins/monobook/IE55Fixes.css?270" media="screen" /><![endif]-->
<!--[if IE 6]><link rel="stylesheet" href="/mw/skins/monobook/IE60Fixes.css?270" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/mw/skins/monobook/IE70Fixes.css?270" media="screen" /><![endif]-->
<link rel="stylesheet" href="http://wiki.lifesciencedb.jp/mw/index.php?title=MediaWiki:Common.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" />
<link rel="stylesheet" href="http://wiki.lifesciencedb.jp/mw/index.php?title=MediaWiki:Print.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" media="print" />
<link rel="stylesheet" href="http://wiki.lifesciencedb.jp/mw/index.php?title=MediaWiki:Monobook.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" />
<link rel="stylesheet" href="http://wiki.lifesciencedb.jp/mw/index.php?title=-&amp;action=raw&amp;maxage=18000&amp;gen=css" />
<script>
var skin="monobook",
stylepath="/mw/skins",
wgUrlProtocols="http\\:\\/\\/|https\\:\\/\\/|ftp\\:\\/\\/|irc\\:\\/\\/|gopher\\:\\/\\/|telnet\\:\\/\\/|nntp\\:\\/\\/|worldwind\\:\\/\\/|mailto\\:|news\\:|svn\\:\\/\\/",
wgArticlePath="/mw/$1",
wgScriptPath="/mw",
wgScriptExtension=".php",
wgScript="/mw/index.php",
wgVariantArticlePath=false,
wgActionPaths={},
wgServer="http://wiki.lifesciencedb.jp",
wgCanonicalNamespace="",
wgCanonicalSpecialPageName=false,
wgNamespaceNumber=0,
wgPageName="Galaxy_ツールを作る",
wgTitle="Galaxy ツールを作る",
wgAction="edit",
wgArticleId=38,
wgIsArticle=false,
wgUserName=null,
wgUserGroups=null,
wgUserLanguage="ja",
wgContentLanguage="ja",
wgBreakFrames=true,
wgCurRevisionId=901,
wgVersion="1.16.3",
wgEnableAPI=true,
wgEnableWriteAPI=true,
wgSeparatorTransformTable=["", ""],
wgDigitTransformTable=["", ""],
wgMainPageTitle="メインページ",
wgFormattedNamespaces={"-2": "メディア", "-1": "特別", "0": "", "1": "ノート", "2": "利用者", "3": "利用者‐会話", "4": "TogoWiki", "5": "TogoWiki‐ノート", "6": "ファイル", "7": "ファイル‐ノート", "8": "MediaWiki", "9": "MediaWiki‐ノート", "10": "Template", "11": "Template‐ノート", "12": "Help", "13": "Help‐ノート", "14": "Category", "15": "Category‐ノート"},
wgNamespaceIds={"メディア": -2, "特別": -1, "": 0, "ノート": 1, "利用者": 2, "利用者‐会話": 3, "togowiki": 4, "togowiki‐ノート": 5, "ファイル": 6, "ファイル‐ノート": 7, "mediawiki": 8, "mediawiki‐ノート": 9, "template": 10, "template‐ノート": 11, "help": 12, "help‐ノート": 13, "category": 14, "category‐ノート": 15, "画像": 6, "画像‐ノート": 7, "image": 6, "image_talk": 7},
wgSiteName="TogoWiki",
wgCategories=[],
wgRestrictionEdit=[],
wgRestrictionMove=[];
</script><script src="http://wiki.lifesciencedb.jp/mw/skins/common/wikibits.js?270"></script>
<script src="http://wiki.lifesciencedb.jp/mw/skins/common/edit.js?270"></script>
<script src="http://wiki.lifesciencedb.jp/mw/skins/common/ajax.js?270"></script>
<script src="http://wiki.lifesciencedb.jp/mw/index.php?title=-&amp;action=raw&amp;gen=js&amp;useskin=monobook&amp;270"></script>

		<style type='text/css'>
		li#pt-openidlogin {
		  background: url(http://wiki.lifesciencedb.jp/mw/extensions/OpenID/skin/icons/openid-inputicon.png) top left no-repeat;
		  padding-left: 20px;
		  text-transform: none;
		}
		</style>
</head>
<body class="mediawiki ltr ns-0 ns-subject page-Galaxy_ツールを作る skin-monobook">
<div id="globalWrapper">
<div id="column-content"><div id="content" >
	<a id="top"></a>
	
	<h1 id="firstHeading" class="firstHeading">Galaxy ツールを作る</h1>
	<div id="bodyContent">
		<h3 id="siteSub">提供：TogoWiki</h3>
		<div id="contentSub"><a href="Galaxy_ツールを作る.html" title="Galaxy ツールを作る">Galaxy ツールを作る</a>のソース</div>
		<div id="jump-to-nav">移動： <a href="index.php@title=Galaxy_ツールを作る&amp;action=edit.html#column-one">案内</a>, <a href="index.php@title=Galaxy_ツールを作る&amp;action=edit.html#searchInput">検索</a></div>
		<!-- start content -->
<p>以下に示された理由により、このページの編集を行うことができません：
</p>
<div class="permissions-errors">
<p>この操作は、<a href="http://wiki.lifesciencedb.jp/mw/index.php?title=TogoWiki:%E5%88%A9%E7%94%A8%E8%80%85&amp;action=edit&amp;redlink=1" class="new" title="TogoWiki:利用者（存在しないページ）">利用者</a>のグループに属する利用者のみが実行できます。
</p>
</div>
<p>このページのソースを閲覧し、コピーすることができます：
</p><textarea id="wpTextbox1" name="wpTextbox1" cols="80" rows="25" readonly="">= Galaxyツールを作る =

Galaxyにツールを組み込むには大きく分けて以下の二通り方法がある。

* UNIXコマンドやスクリプトをGalaxyツールとして組み込む方法
* 外部のサイトをGalaxyの内部にツールとして組み込む方法

== コマンドを利用したGalaxyツールの作り方 ==

[[Galaxy ツールを作る/コマンドを利用したGalaxyツール]] を参照

== 外部サイトと連携を行うGalaxyツールの作り方 ==

[[Galaxy_ツールを作る/外部サイト連携Galaxyツール]] を参照

== GalaxyツールTips ==

=== ひとつのツールから複数データセットを出力 ===

ツールの設定ファイル内のoutputs要素へ複数のdata要素を定義することで、ひとつのツールから複数のデータセットを出力させることができる。また、ワークフロー上ではそれぞれの出力を次のツールの入力へと接続することができる。

設定ファイルのサンプル(multi_output.xml)

 &lt;?xml version="1.0"?>
 &lt;tool id="multi_output" name="Multi Output">
   &lt;description>Output multiple datasets&lt;/description>
   
   &amp;lt;!-- コマンドへ output1 と output2 を渡す --&amp;gt;
   &lt;command interpreter="sh">multi_output.sh '$source' '$output1' '$output2'&lt;/command>
   &lt;inputs>
     &lt;param name="source" format="txt" type="data" label="Source Data" />
   &lt;/inputs>
   
   &amp;lt;!-- outputs へ output1 と output2 を定義 --&amp;gt;
   &lt;outputs>
     &lt;data format="tabular" name="output1" />
     &lt;data format="tabular" name="output2" />
   &lt;/outputs>
   &lt;help>
   &lt;/help> 
 &lt;/tool>

コマンドのサンプル(multi_output.sh)

 #!/bin/sh
 
 # output1 は入力をそのまま出力
 cat $1 > $2
 # output2 へは行番号を付加して出力 
 cat -n $1 > $3


=== メニューのカスタマイズ ===
メニューのカスタマイズの際，変更するファイルは $GALAXY/tool_conf.xmlである．

例えば，DBCLS Galaxy( http://galaxy.dbcls.jp/ )の tool_conf.xml は下記のようになる：

 &lt;?xml version='1.0'?>
 &lt;toolbox>
   &lt;section name='Get Data' id='getext'>                                  
     &lt;tool file='data_source/upload.xml'/>
     &lt;label text='DBCLS TogoWS Tools' id='togows_tools'/>
     &lt;tool file='togows/search_resources.xml'/>
     &lt;tool file='togows/search_resources_with_history.xml'/>
     &lt;tool file='togows/get_restful_resources.xml'/>
     &lt;tool file='togows/get_restful_togodb_resources.xml'/>
     &lt;tool file='pubmed/pubmed_get_resource.xml'/>
     &lt;label text='DBCLS Text Mining Tools' id='tm_tools'/>
     &lt;tool file='medline/search_medline_direct.xml'/>
     &lt;tool file='medline/search_medline_with_history.xml'/>
 ...

* section タグ: '''Get Data''', '''Send Data'''などのツールカテゴリの見出しの設定
* label タグ: DBCLS TOGOWS TOOLS などの中見出しの設定
* tool タグ: 各ツールの設定

ツールカテゴリやツールを削りたいとき: 当該するタグを削除あるいはコメントアウトすることで，メニューからツールを削除する &lt;br/>
新しいツールカテゴリを作りたいとき: section タグを新しく設定し，その中に入れたいツールの設定(toolタグ)を書く&lt;br/>
新しいツールを組み込みたいとき: 下記，ツールの組み込み方を参照

=== 公開されているツール ===
* 本家のユーザーベースなツール公開レポジトリ [http://community.g2.bx.psu.edu/ Galaxy Tool Shed]。
* CSHLの[http://cancan.cshl.edu/publicgalaxy/ Hannon Laboratory public galaxy website]

= BH10.10 Galaxy グループログ =

* メンバー
** 神田 (こうだ、トピックリーダー)※大活躍！ありがとうございました
** 山口
** 畠山
** 神沼
** 中尾
** 長崎
** 望月


* 興味のあるトピック書き出し
** 具体的にどう使ってるのか?
*** 外部にだしてるのは少なくて、ローカルで使うパターンばかりが多い
** セキュリティはどうすれば?
*** ヒトデータをアップロード可能かな? (これは倫理関係だからここではパスかな)
*** ユーザーごとに分離されてるか?
** ユーザーごとにツールの表示をカスタマイズ出来るか?
*** デフォルトだと全部表示されて、ユーザーには多すぎる → 現状ユーザごとにはできない，サイトごとなら tool_conf.xml を書き換えて再起動する．詳しくは下記．
** ソフトウェアを同梱して配布可能なのか調べたい
*** DBCLS Galaxy は既にこの形で配布している

=== 成果リスト ===
* 各自ローカルでの開発環境の整備
* ツール組み込み => 達成 (Unix Tools, Annovar) + さらに複数ファイルの出力対応法も調査できた
* 自分の欲しいワークフロー作成 => 必要なツール組み込みが出来たので、Exome ワークフローの作成できた
* チームで KPT を行った http://wiki.lifesciencedb.jp/mw/images/6/64/Galaxy_kpt.JPG
* 成果に関わるログを TogoWiki に集約できた
* conf.xml などの変更点およびファイル追加を成果として還元できるように svn レポジトリへアップできる体制が整えられた

=== 進行中だけど、頑張って終わらせるタスク ===
* TogoWiki galaxy の読み易さ、親切度アップ
* ワークフロー (Exome)、ツール (Annovar) を bh10.10-galaxy-central に移植する
* 
* 
*

=== 今後の課題 ===
* 
* 
*

=== 開発用trac &amp; svn ===

* http://kiban.dbcls.jp/bh10.10
* http://kiban.dbcls.jp/svn/bh10.10


=== まだ未解決・知ってたら教えて欲しい(ﾁﾗｯﾁﾗｯ・またはプラン@SOMEDAY ===
* 達成!! '''Tabular データの任意のカラムに"chr"を付加したい''' => 以下のツールを組み込むとsedで処理対象のカラム指定+正規表現で文字リプレスが可能になる、と山口さん・畠山さんに教えてもらった
  →これを使いましょう http://hannonlab.cshl.edu/galaxy_unix_tools/galaxy.html
README ファイルから抜粋&lt;br>
 Galaxy Installation
 ===================
 You'll need a local Galaxy installation to use these tools.
 
 run:
    $  ./install_galaxy_files.sh [GALAXY-SERVER-DIRECTORY]
 to copy the needed files to the Galaxy root.
 Under &lt;galaxy>/tools a new directory named 'unix_tools' will be created.
 In &lt;galaxy>/test-data some files will be placed (for the functional testing).
 
 Now, manually merge the content of 'tool_conf.xml.add' into your Galaxy's tool_conf.xml file.
 
 
 
 Functional Testing
 ==================
 
 Some of the unix tools have a functional unit-test files.
 To run the functional testing in Galaxy, add the content
 of 'tool_conf.xml.add' to your Galaxy's   tool_conf.xml.sample
 (NOTE: not tool_conf.xml, but tool_conf.xml.sample).
 
 Then, from Galaxy's root directory, run:
 
 $ sh run_functional_tests.sh -id cshl_awk_tool
 $ sh run_functional_tests.sh -id cshl_sed_tool
 $ sh run_functional_tests.sh -id cshl_grep_tool
 $ sh run_functional_tests.sh -id cshl_sort_tool
 $ sh run_functional_tests.sh -id cshl_cut_tool
 $ sh run_functional_tests.sh -id Remove_ending
 $ sh run_functional_tests.sh -id cshl_sed_replace_in_line
 $ sh run_functional_tests.sh -id cshl_awk_replace_in_column
 
 If the results of the tests is anyhthing other than "OK", you'll need to
 fix whatever is wrong.
 
 If the AWK tool failed, make sure you've installed AWK with the 'sandbox' patch.
 If the SED tool failed, make sure you've installed SED with the 'sandbox' patch.
 If the sort tool failed, make sure you've installed coreutils version 7.1 or later.
テストあるけど、通らないよ…僕の環境?&lt;br>
 
* 達成!!  '''複数のファイルが出力されるケースの対応'''
** どれか一つを決め打ちで出力としたい
** 可能なら複数の出力を持ち越せるといい
 →ひとつのツールから複数データセットを出力 を参照
*** チェックボックスで選べるようになるとかね
* 達成!! '''元々入ってる Intersect が使いこなせない''' => Galaxy の特徴である genomic interval の方が良いことが分かりました
(あとで書く#こうだ) SNP の位置と genomics interval の 0bp&lt;br>
* '''現状、最終的な可視化が NGS ビューワーの IGV に頼っているが、UCSC Genome Browser か Track Star でも可視化できないか?''' # こうだ
* Workflow の export/import は可能か?
http://bitbucket.org/galaxy/galaxy-central/wiki/Features/DevNewsBrief/2010_10_05 に Both workflows and histories can now be exported to files. Importing workflows and histories is coming soon. とある (import がまだ)
* 再起動なしにデバッグを進める方法あるのか

== タスク (ツール組み込み、ワークフロー作成) == 
手元でツール作成しつつ、本家or DBCLSに組込み公開する。
* Exome workflow (神田さん)
** History からの Extract Workflow 便利・すごい!!
** galaxy-central/database/files/000 にデータがたまるみたい http://skitch.com/mako/dhxbn/2
* (岩崎さん) 
* SAMtoolsの変換ツール組込(長崎さん)
* workflow test(望月さん)
* Assembly用評価/グラフ生成workflow :そのうちDDBJ Pipelineから出します (神沼)

=== 結果ログ ===

== インストール情報 ==
 galaxyOnMacOSX_install_log
 http://bitbucket.org/galaxy/galaxy-central/wiki/GetGalaxy を参照 OSX 10.6.4です。
 na% echo $shell /bin/tcsh 
 na% mkdir ~/galaxy-python
 na% ln -s /usr/bin/python2.6 ~/galaxy-python/python (2.5から2.6に変更し て今のとこ問題なし)
 na% .tcshrcに set path = ($path ~/galaxy-python)
 na% echo ${PATH}
 /bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/X11/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/X11/bin:/Applications/bioinfo/bwa- 0.5.8a:/Applications/bioinfo/samtools-0.1.7_i386-darwin:/Users/na/galaxy- python
 参照先にあるhgがOSXに入ってないので... easy_installでインストール
 na% which easy_install /usr/bin/easy_install
 na% sudo easy_install Mercurial
 Password:XXXXXXX Searching for Mercurial Best match: mercurial 1.6.2 Processing mercurial-1.6.2-py2.6-macosx-10.6-universal.egg mercurial 1.6.2 is already the active version in easy-install.pth Installing hg script to /usr/local/bin
 Using /Library/Python/2.6/site-packages/mercurial-1.6.2-py2.6-macosx- 10.6-universal.egg
 Processing dependencies for Mercurial Finished processing dependencies for Mercurial
 na% /usr/local/bin/hg clone http://www.bx.psu.edu/hg/galaxy galaxy_dist
 real URL is http://bitbucket.org/galaxy/galaxy-dist requesting all changes adding changesets
 adding manifests adding file changes added 4093 changesets with 18251 changes to 4360 files updating to branch default 2776 files updated, 0 files merged, 0 files removed, 0 files unresolved
 na% cd galaxy_dist
 na% sh setup.sh
 na% sh run.sh で起動

== スケーラブル設定 ==
[http://bitbucket.org/galaxy/galaxy-central/wiki/DevConf2010 galaxy / galaxy-central / wiki / DevConf2010 – Bitbucket] でのトーク [http://bitbucket.org/galaxy/galaxy-central/wiki/DevConf2010/galaxy_devconf_2010_scalable.pdf Building Scalable Galaxy] - Nate Coraor と [http://www.slideshare.net/nakao/galaxy-developer-conference-2010-report Galaxy Developer Conference 2010 レポート] を参照。
* バックエンドDBの選択：デフォルトはsqlite3、PostgreSQLやMySQLに変更すると性能アップ。
* ファイルアップロード／ダウンロード時のI/Oブロックを回避する為のプロキシ設定。
* マシンのコア数にあわせたスレッドモデル。

== 調査情報 ==
* 利用可能な世界中の[http://main.g2.bx.psu.edu/workflow/list_published workflow]
* 配布ライセンスの種類 = MIT

== ツールの組み込み方 ==

Galaxy にツールを組み込むには，大きく分けて二種類の方法が存在する．

ひとつは，Galaxy のフレーム内でツールを組み込む方法であり，このセクションで詳述する．もうひとつの方法は外部サイトにGalaxy から
アクセス可能にする方法で，別ページにて解説する．

[http://bitbucket.org/galaxy/galaxy-central/wiki/NGSLocalSetup galaxy / galaxy-central / wiki / NGSLocalSetup – Bitbucket] &lt;br>
[http://bitbucket.org/galaxy/galaxy-central/wiki/ToolConfigSyntax galaxy / galaxy-central / wiki / ToolConfigSyntax – Bitbucket] tool_hoge.xml を書く際に参考にする (&lt;param> tag set のセクションとか)&lt;br>

関連情報: DBCLS Galaxy に同梱のツールジェネレータを利用して，DBCLS Galaxy に自分のツールを組み込む &lt;br>
( http://galaxy.g.hatena.ne.jp/morita_hideyuki/ )&lt;br>

外部サイトをツールとして利用する場合（例：UCSC Table Browser）&lt;br>
( http://bitbucket.org/galaxy/galaxy-central/wiki/ExternalDisplayApplications/Tutorial ) &lt;br>
任意web application利用可能だが、web application側にgalaxy対応が必要。&lt;br>

10/21 ローカルの Galaxy にツール組み込み&lt;br>
http://bitbucket.org/galaxy/galaxy-central/wiki/NGSLocalSetup を読みつつインストール&lt;br>


1. BWA の組み込み&lt;br>
 cd ~/Projects/bh10.10/galaxy/galaxy-central/tool-data
 cp bwa_index.loc.sample bwa_index.loc

 bwa_index.locに追記
 hg18	/Users/mako/Projects/bh10.10/galaxy/hg18_data/hg18.fasta


 bwa の実行ファイルをパスが通っているところに配置
 sudo cp bwa /usr/local/bin

 bwa_index.loc の記述に合うように hg18.fasta とそのインデックスファイルを任意のディレクトリに配置
 cp ~/Projects/exome_tools_test/Data/hg18.* /Users/mako/Projects/bh10.10/galaxy/hg18_data/
 hg18.fasta
 hg18.fasta.ann
 hg18.fasta.bwt
 hg18.fasta.pac
 hg18.fasta.rbwt
 hg18.fasta.rpac
 hg18.fasta.rsa
 hg18.fasta.sa

Galaxy's built-in indexes will be available for download soon ということらしい&lt;br>


2. SAM Tools 組み込み&lt;br>
 mate sam_fa_indices.loc
 index	hg18	/Users/mako/Projects/bh10.10/galaxy/hg18_data/hg18.fasta

 bwa の実行ファイルをパスが通っているところに配置
 sudo cp ~/Downloads/exome_softwares/samtools/samtools /usr/local/bin/

 hg18.fasta とそのインデックスファイルを galaxy ディレクトリに配置
 cp ~/Projects/exome_tools_test/Data/hg18.fasta.fai /Users/mako/Projects/bh10.10/galaxy/hg18_data/


3. BEDTools 組み込み&lt;br>
http://groups.google.com/group/bedtools-discuss/browse_thread/thread/e3be681586693399 から始めた&lt;br>
http://cancan.cshl.edu/publicgalaxy/ ショウケースになってる&lt;br>

 cp -r ../../../Download/galaxy_BEDTools/tool-data/BEDTools ~/Projects/bh10.10/galaxy/galaxy-central/tool-data/
 cp -r ../../../Download/galaxy_BEDTools/tools/BEDTools ../tools/BEDTools
 cp -r ../../../Download/galaxy_BEDTools/static/images/genomeCoverageBed_bedgraph.png ../static/images

 Add the following section to &lt;galaxy>/tool_conf.xml
 
     &lt;section name="BEDTools" id="BEDTools">
         &lt;tool file="BEDTools/genomeCoverageBed_bedgraph.xml" />
     &lt;/section>


4. Exome 関連ツールを自前で組み込み
* [http://galaxy.g.hatena.ne.jp/morita_hideyuki/20090918/1253265925 お持ち帰り用DBCLS Galaxyでのツール作成方法(1) - morita_hideyukiの日記 - Galaxy グループ]
* [http://galaxy.g.hatena.ne.jp/morita_hideyuki/20090924/1253778651 お持ち帰り用DBCLS Galaxyでのツール作成方法(2) - morita_hideyukiの日記 - Galaxy グループ]
を参考にした&lt;br>

DBCLS の tool wrapper generater を利用してみた&lt;br>
 cd dbcls-galaxy
 ./scripts/tool_generator/generate_tool.sh exome annovar

 galaxy-central へコピー
 mv tools/exome ../galaxy-central/tools

 tool_conf.xml に記述追加
   &lt;section name='Exome' id='exome'>
     &lt;tool file='exome/annovar.xml'/>
   &lt;/section>

 Galaxy の出す pileup format が自分のコマンドライン操作時の pileup format と2番目のカラムだけ合わないことがわかったので修正する (cut で2番目のカラムを削る)
 grep 46498888 Galaxy18-\[Filter_on_data_17\].interval.interval.pileup.interval s_8_sequence.aln.sorted.removedup.ontarget.bam.filtered.pileup  | less
 Galaxy18-[Filter_on_data_17].interval.interval.pileup.interval:chr1     46498887        46498888        G       R       &lt;= Galaxy で作った pileup file
 s_8_sequence.aln.sorted.removedup.ontarget.bam.filtered.pileup:chr1     46498888                        G       R       &lt;= ローカルの samtools で作った pileup file

 Galaxy の cut で2番目カラムを捨てる
 c1,c3,c4,c5,c6,c7,c8,c9,c10,c11,c12,c13,c14,c15,c16,c17

続いて Annovar [http://www.openbioinformatics.org/annovar/ ANNOVAR: Functional annotation of genetic variants from high-throughput sequencing data  ] を組み込み&lt;br>
galaxy-central/tools/exome に以下の2つのファイル (annovar.xml と annovar.rb) を配置する&lt;br>
'''annovar.xml'''
 &lt;?xml version="1.0"?>
 &lt;tool id="annovar" name="Annovar">
   &lt;description>&lt;/description>
   
   &lt;inputs>
     &lt;param name="input" format="tabular" type="data" label="Source Data" />
   &lt;/inputs>
 
   &lt;outputs>
     &lt;data format="txt" name="output" />
   &lt;/outputs>
 
   &lt;command interpreter="ruby">annovar.rb '$input' '$output'&lt;/command>
 
   &lt;help>
   &lt;/help>
 &lt;/tool>
 
'''annovar.rb'''
 #!/usr/bin/env ruby
 # -*- coding: utf-8 -*-
 
 CONVERT2ANNOVAR    = "~/Downloads/exome_softwares/annovar/convert2annovar.pl"
 ANNOTATE_VARIATION = "~/Downloads/exome_softwares/annovar/annotate_variation.pl"
 AUTO_ANNOVAR       = "~/Downloads/exome_softwares/annovar/auto_annovar.pl"
 SUMMARIZE_ANNOVAR  = "~/Downloads/exome_softwares/annovar/summarize_annovar.pl"
 ANNOVAR_HUMANDB    = "~/Projects/exome_tools_test/Download/annovar_humandb"
 
 # ANNOVAR website http://www.openbioinformatics.org/annovar/annovar_input.html
 system "#{CONVERT2ANNOVAR} -format pileup #{ARGV[0]} > #{ARGV[1]} 2>/dev/null"
 
 # See detail: http://www.openbioinformatics.org/annovar/annovar_accessary.html
 system "#{AUTO_ANNOVAR} #{ARGV[1]} #{ANNOVAR_HUMANDB} 2>/dev/null"

== History履歴を基にした最短Workflow作成法 ==
1. History作成後に右上オプションからExtract Workflowを選択

2. Workflow nameをテキストボックス中に記入し、Create Workflowボタンを選択

3. Workflow menuに移動し、一番下の「Configure your workflow menu」を選択

4. Analyze data menuに移動して、左パネルのツールリストから「Workflows」をクリックすると、中央パネルにWorkflowの実行画面が現われる。後は「Run workflow」実行

== 公開されているツール ==
* 本家のユーザーベースなツール公開レポジトリ [http://community.g2.bx.psu.edu/ Galaxy Tool Shed]。
* CSHLの[http://cancan.cshl.edu/publicgalaxy/ Hannon Laboratory public galaxy website]

== スクリーンショット ==
*[http://skitch.com/mako/dhq8n/galaxy workflow例1 (10/21午前)]
*[http://skitch.com/mako/dhqgc/galaxy workflow例2 (10/21午前)]
*[http://skitch.com/mako/dhx8i/galaxy workflow例3 (10/21午後)]
*[http://skitch.com/mako/dhxgh/2 ワークフローで dbSNP に登録されている SNP を除去した後の SNP リスト (10/21午後)]
*[http://skitch.com/mako/dhxgx/org.broad.igv.ui.igvmainframe ワークフローで得られた一塩基変異を IGV で可視化した図 (10/21午後)]
*[https://docs.google.com/a/g.nig.ac.jp/document/edit?id=1x8gnlIU5xjDtOmvvEQrxy9DJ3C8Q88g2zKWdjauiZPs&amp;hl=ja# Assembly評価用に生成されるContig長ヒストグラム(10/20午後)]

== galaxyを外部に公開する方法 ==

1) apacheを導入する。Macの場合、はじめからinstallされている。

2) httpd.conf(Macなら、/etc/apache2にあるよ。)に以下の2行を追記

RewriteEngine on

RewriteRule ^(.*) http://localhost:8080$1 [P]

3)http://ip_address:80/にアクセスする。

※~/galaxy_dist/universe_wsgi.iniは修正なしでOKです。
詳細は以下参照
http://bitbucket.org/galaxy/galaxy-central/wiki/Config/ApacheProxy


[[Category:bh10.10]]
[[Category:Galaxy]]</textarea><div class='templatesUsed'>

</div>
<p id="mw-returnto"><a href="Galaxy_ツールを作る.html" title="Galaxy ツールを作る">Galaxy ツールを作る</a>に戻る。</p>
<div class="printfooter">
「<a href="Galaxy_ツールを作る.html">http://wiki.lifesciencedb.jp/mw/Galaxy_%E3%83%84%E3%83%BC%E3%83%AB%E3%82%92%E4%BD%9C%E3%82%8B</a>」より作成</div>
		<div id='catlinks' class='catlinks catlinks-allhidden'></div>		<!-- end content -->
				<div class="visualClear"></div>
	</div>
</div></div>
<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>表示</h5>
		<div class="pBody">
			<ul>
				 <li id="ca-nstab-main" class="selected"><a href="Galaxy_ツールを作る.html" title="本文を表示 [c]" accesskey="c">ページ</a></li>
				 <li id="ca-talk" class="new"><a href="http://wiki.lifesciencedb.jp/mw/index.php?title=%E3%83%8E%E3%83%BC%E3%83%88:Galaxy_%E3%83%84%E3%83%BC%E3%83%AB%E3%82%92%E4%BD%9C%E3%82%8B&amp;action=edit&amp;redlink=1" title="記事についての議論 [t]" accesskey="t">議論</a></li>
				 <li id="ca-viewsource" class="selected"><a href="index.php@title=Galaxy_ツールを作る&amp;action=edit.html" title="このページは保護されています。&#10;ページのソースを閲覧できます。 [e]" accesskey="e">ソースを表示</a></li>
				 <li id="ca-history"><a href="index.php@title=Galaxy_ツールを作る&amp;action=history.html" title="このページの過去の版 [h]" accesskey="h">履歴</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>個人用ツール</h5>
		<div class="pBody">
			<ul>
				<li id="pt-anonuserpage"><a href="http://wiki.lifesciencedb.jp/mw/%E5%88%A9%E7%94%A8%E8%80%85:172.18.8.51" title="自分が編集しているIPアドレスの利用者ページ [.]" accesskey="." class="new">172.18.8.51</a></li>
				<li id="pt-anontalk"><a href="http://wiki.lifesciencedb.jp/mw/%E5%88%A9%E7%94%A8%E8%80%85%E2%80%90%E4%BC%9A%E8%A9%B1:172.18.8.51" title="このIPアドレスからなされた編集についての議論 [n]" accesskey="n" class="new">このIPアドレスのトーク</a></li>
				<li id="pt-anonlogin"><a href="http://wiki.lifesciencedb.jp/mw/index.php?title=%E7%89%B9%E5%88%A5:%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3&amp;returnto=Galaxy_%E3%83%84%E3%83%BC%E3%83%AB%E3%82%92%E4%BD%9C%E3%82%8B&amp;returntoquery=action%3Dedit" title="ログインすることが推奨されます。ただし、必須ではありません。 [o]" accesskey="o">ログイン</a></li>
				<li id="pt-openidlogin"><a href="index.php@title=特別%253AOpenIDログイン&amp;returnto=Galaxy_ツールを作る.html">OpenIDでログイン</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a style="background-image: url(http://wiki.lifesciencedb.jp/mw/images/togowiki-logo.png);" href="index.html" title="メインページに移動"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
	<div class='generated-sidebar portlet' id='p-navigation'>
		<h5>案内</h5>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage-description"><a href="index.html" title="メインページに移動する [z]" accesskey="z">メインページ</a></li>
				<li id="n-portal"><a href="http://wiki.lifesciencedb.jp/mw/TogoWiki:%E3%82%B3%E3%83%9F%E3%83%A5%E3%83%8B%E3%83%86%E3%82%A3%E3%83%BB%E3%83%9D%E3%83%BC%E3%82%BF%E3%83%AB" title="このプロジェクトについて、できること、情報を入手する場所">コミュニティ・ポータル</a></li>
				<li id="n-currentevents"><a href="http://wiki.lifesciencedb.jp/mw/TogoWiki:%E6%9C%80%E8%BF%91%E3%81%AE%E5%87%BA%E6%9D%A5%E4%BA%8B" title="最近の出来事について予備知識を得る">最近の出来事</a></li>
				<li id="n-recentchanges"><a href="http://wiki.lifesciencedb.jp/mw/%E7%89%B9%E5%88%A5:%E6%9C%80%E8%BF%91%E3%81%AE%E6%9B%B4%E6%96%B0" title="ウィキにおける最近の更新の一覧 [r]" accesskey="r">最近の更新</a></li>
				<li id="n-randompage"><a href="http://wiki.lifesciencedb.jp/mw/%E7%89%B9%E5%88%A5:%E3%81%8A%E3%81%BE%E3%81%8B%E3%81%9B%E8%A1%A8%E7%A4%BA" title="無作為に抽出されたページの読み込み [x]" accesskey="x">おまかせ表示</a></li>
				<li id="n-help"><a href="http://wiki.lifesciencedb.jp/mw/Help:%E7%9B%AE%E6%AC%A1" title="情報を得る場所">ヘルプ</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">検索</label></h5>
		<div id="searchBody" class="pBody">
			<form action="http://wiki.lifesciencedb.jp/mw/index.php" id="searchform">
				<input type='hidden' name="title" value="特別:検索"/>
				<input id="searchInput" title="TogoWiki内を検索" accesskey="f" type="search" name="search" />
				<input type='submit' name="go" class="searchButton" id="searchGoButton"	value="表示" title="厳密に一致する名前のページが存在すれば、そのページへ移動します" />&nbsp;
				<input type='submit' name="fulltext" class="searchButton" id="mw-searchButton" value="検索" title="入力された文字列が含まれるページを検索します" />
			</form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>ツールボックス</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="特別%253Aリンク元/Galaxy_ツールを作る.html" title="ここにリンクしている全ウィキのページの一覧 [j]" accesskey="j">リンク元</a></li>
				<li id="t-recentchangeslinked"><a href="特別%253A関連ページの更新状況/Galaxy_ツールを作る.html" title="このページからリンクしているページの最近の更新 [k]" accesskey="k">関連ページの更新状況</a></li>
<li id="t-specialpages"><a href="http://wiki.lifesciencedb.jp/mw/%E7%89%B9%E5%88%A5:%E7%89%B9%E5%88%A5%E3%83%9A%E3%83%BC%E3%82%B8%E4%B8%80%E8%A6%A7" title="特別ページの一覧 [q]" accesskey="q">特別ページ</a></li>
			</ul>
		</div>
	</div>
</div><!-- end of the left (by default at least) column -->
<div class="visualClear"></div>
<div id="footer">
	<div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="http://wiki.lifesciencedb.jp/mw/skins/common/images/poweredby_mediawiki_88x31.png" height="31" width="88" alt="Powered by MediaWiki" /></a></div>
	<div id="f-copyrightico"><a href="http://creativecommons.org/licenses/by/3.0/"><img src="http://i.creativecommons.org/l/by/3.0/88x31.png" alt="Attribution 3.0 Unported" width="88" height="31" /></a></div>
	<ul id="f-list">
		<li id="privacy"><a href="http://wiki.lifesciencedb.jp/mw/TogoWiki:%E3%83%97%E3%83%A9%E3%82%A4%E3%83%90%E3%82%B7%E3%83%BC%E3%83%BB%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC" title="TogoWiki:プライバシー・ポリシー">プライバシー・ポリシー</a></li>
		<li id="about"><a href="http://wiki.lifesciencedb.jp/mw/TogoWiki:TogoWiki%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6" title="TogoWiki:TogoWikiについて">TogoWikiについて</a></li>
		<li id="disclaimer"><a href="http://wiki.lifesciencedb.jp/mw/TogoWiki:%E5%85%8D%E8%B2%AC%E4%BA%8B%E9%A0%85" title="TogoWiki:免責事項">免責事項</a></li>
	</ul>
</div>
</div>

<script>if (window.runOnloadHook) runOnloadHook();</script>
<!-- Served in 0.360 secs. --></body></html>
