<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="ja" dir="ltr">
<head>
<title>SPARQLthon55/togo rdfstore - TogoWiki</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="MediaWiki 1.16.3" />
<meta name="robots" content="noindex,nofollow" />
<link rel="shortcut icon" href="http://wiki.lifesciencedb.jp/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="http://wiki.lifesciencedb.jp/mw/opensearch_desc.php" title="TogoWiki (ja)" />
<link title="Creative Commons" type="application/rdf+xml" href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;action=creativecommons" rel="meta" />
<link rel="copyright" href="http://creativecommons.org/licenses/by/3.0/" />
<link rel="alternate" type="application/atom+xml" title="TogoWikiのAtomフィード" href="http://wiki.lifesciencedb.jp/mw/index.php?title=%E7%89%B9%E5%88%A5:%E6%9C%80%E8%BF%91%E3%81%AE%E6%9B%B4%E6%96%B0&amp;feed=atom" />
<link rel="stylesheet" href="http://wiki.lifesciencedb.jp/mw/skins/common/shared.css?270" media="screen" />
<link rel="stylesheet" href="http://wiki.lifesciencedb.jp/mw/skins/common/commonPrint.css?270" media="print" />
<link rel="stylesheet" href="http://wiki.lifesciencedb.jp/mw/skins/monobook/main.css?270" media="screen" />
<!--[if lt IE 5.5000]><link rel="stylesheet" href="/mw/skins/monobook/IE50Fixes.css?270" media="screen" /><![endif]-->
<!--[if IE 5.5000]><link rel="stylesheet" href="/mw/skins/monobook/IE55Fixes.css?270" media="screen" /><![endif]-->
<!--[if IE 6]><link rel="stylesheet" href="/mw/skins/monobook/IE60Fixes.css?270" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/mw/skins/monobook/IE70Fixes.css?270" media="screen" /><![endif]-->
<link rel="stylesheet" href="http://wiki.lifesciencedb.jp/mw/index.php?title=MediaWiki:Common.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" />
<link rel="stylesheet" href="http://wiki.lifesciencedb.jp/mw/index.php?title=MediaWiki:Print.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" media="print" />
<link rel="stylesheet" href="http://wiki.lifesciencedb.jp/mw/index.php?title=MediaWiki:Monobook.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" />
<link rel="stylesheet" href="http://wiki.lifesciencedb.jp/mw/index.php?title=-&amp;action=raw&amp;maxage=18000&amp;gen=css" />
<script>
var skin="monobook",
stylepath="/mw/skins",
wgUrlProtocols="http\\:\\/\\/|https\\:\\/\\/|ftp\\:\\/\\/|irc\\:\\/\\/|gopher\\:\\/\\/|telnet\\:\\/\\/|nntp\\:\\/\\/|worldwind\\:\\/\\/|mailto\\:|news\\:|svn\\:\\/\\/",
wgArticlePath="/mw/$1",
wgScriptPath="/mw",
wgScriptExtension=".php",
wgScript="/mw/index.php",
wgVariantArticlePath=false,
wgActionPaths={},
wgServer="http://wiki.lifesciencedb.jp",
wgCanonicalNamespace="",
wgCanonicalSpecialPageName=false,
wgNamespaceNumber=0,
wgPageName="SPARQLthon55/togo_rdfstore",
wgTitle="SPARQLthon55/togo rdfstore",
wgAction="view",
wgArticleId=806,
wgIsArticle=true,
wgUserName=null,
wgUserGroups=null,
wgUserLanguage="ja",
wgContentLanguage="ja",
wgBreakFrames=false,
wgCurRevisionId=22128,
wgVersion="1.16.3",
wgEnableAPI=true,
wgEnableWriteAPI=true,
wgSeparatorTransformTable=["", ""],
wgDigitTransformTable=["", ""],
wgMainPageTitle="メインページ",
wgFormattedNamespaces={"-2": "メディア", "-1": "特別", "0": "", "1": "ノート", "2": "利用者", "3": "利用者‐会話", "4": "TogoWiki", "5": "TogoWiki‐ノート", "6": "ファイル", "7": "ファイル‐ノート", "8": "MediaWiki", "9": "MediaWiki‐ノート", "10": "Template", "11": "Template‐ノート", "12": "Help", "13": "Help‐ノート", "14": "Category", "15": "Category‐ノート"},
wgNamespaceIds={"メディア": -2, "特別": -1, "": 0, "ノート": 1, "利用者": 2, "利用者‐会話": 3, "togowiki": 4, "togowiki‐ノート": 5, "ファイル": 6, "ファイル‐ノート": 7, "mediawiki": 8, "mediawiki‐ノート": 9, "template": 10, "template‐ノート": 11, "help": 12, "help‐ノート": 13, "category": 14, "category‐ノート": 15, "画像": 6, "画像‐ノート": 7, "image": 6, "image_talk": 7},
wgSiteName="TogoWiki",
wgCategories=[],
wgRestrictionEdit=[],
wgRestrictionMove=[];
</script><script src="http://wiki.lifesciencedb.jp/mw/skins/common/wikibits.js?270"></script>
<script src="http://wiki.lifesciencedb.jp/mw/skins/common/ajax.js?270"></script>
<script src="http://wiki.lifesciencedb.jp/mw/index.php?title=-&amp;action=raw&amp;gen=js&amp;useskin=monobook&amp;270"></script>

		<style type='text/css'>
		li#pt-openidlogin {
		  background: url(http://wiki.lifesciencedb.jp/mw/extensions/OpenID/skin/icons/openid-inputicon.png) top left no-repeat;
		  padding-left: 20px;
		  text-transform: none;
		}
		</style>
</head>
<body class="mediawiki ltr ns-0 ns-subject page-SPARQLthon55_togo_rdfstore skin-monobook">
<div id="globalWrapper">
<div id="column-content"><div id="content" >
	<a id="top"></a>
	
	<h1 id="firstHeading" class="firstHeading">SPARQLthon55/togo rdfstore</h1>
	<div id="bodyContent">
		<h3 id="siteSub">提供：TogoWiki</h3>
		<div id="contentSub">
				<div id="mw-revision-info">2017年6月16日 (金) 04:09時点における<a href="http://wiki.lifesciencedb.jp/mw/index.php?title=%E5%88%A9%E7%94%A8%E8%80%85:Yokookbp&amp;action=edit&amp;redlink=1" class="new mw-userlink" title="利用者:Yokookbp（存在しないページ）">Yokookbp</a>  <span class="mw-usertoollinks">(<a href="http://wiki.lifesciencedb.jp/mw/index.php?title=%E5%88%A9%E7%94%A8%E8%80%85%E2%80%90%E4%BC%9A%E8%A9%B1:Yokookbp&amp;action=edit&amp;redlink=1" class="new" title="利用者‐会話:Yokookbp（存在しないページ）">トーク</a> | <a href="http://wiki.lifesciencedb.jp/mw/%E7%89%B9%E5%88%A5:%E6%8A%95%E7%A8%BF%E8%A8%98%E9%8C%B2/Yokookbp" title="特別:投稿記録/Yokookbp">投稿記録</a>)</span>による版</div>

				<div id="mw-revision-nav">(<a href="http://wiki.lifesciencedb.jp/mw/index.php?title=SPARQLthon55/togo_rdfstore&amp;diff=prev&amp;oldid=22127" title="SPARQLthon55/togo rdfstore">差分</a>) <a href="http://wiki.lifesciencedb.jp/mw/index.php?title=SPARQLthon55/togo_rdfstore&amp;direction=prev&amp;oldid=22127" title="SPARQLthon55/togo rdfstore">←前の版</a> | <a href="SPARQLthon55/togo_rdfstore.html" title="SPARQLthon55/togo rdfstore">最新版</a> (<a href="http://wiki.lifesciencedb.jp/mw/index.php?title=SPARQLthon55/togo_rdfstore&amp;diff=cur&amp;oldid=22127" title="SPARQLthon55/togo rdfstore">差分</a>) | <a href="http://wiki.lifesciencedb.jp/mw/index.php?title=SPARQLthon55/togo_rdfstore&amp;direction=next&amp;oldid=22127" title="SPARQLthon55/togo rdfstore">次の版→</a> (<a href="http://wiki.lifesciencedb.jp/mw/index.php?title=SPARQLthon55/togo_rdfstore&amp;diff=next&amp;oldid=22127" title="SPARQLthon55/togo rdfstore">差分</a>)</div>
			</div>
		<div id="jump-to-nav">移動： <a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;direction=prev&amp;oldid=22128.html#column-one">案内</a>, <a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;direction=prev&amp;oldid=22128.html#searchInput">検索</a></div>
		<!-- start content -->
<p>現在のTogoGenomeのRDFストアにはVirtuosoを使用しているが、他のRDFストアへ移行できるかの検討を行った。
AllegroGraphとStar Dogを
</p>
<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>目次</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;direction=prev&amp;oldid=22128.html#AllegroGraph"><span class="tocnumber">1</span> <span class="toctext">AllegroGraph</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;direction=prev&amp;oldid=22128.html#togostanza.28ruby.E7.89.88.29"><span class="tocnumber">1.1</span> <span class="toctext">togostanza(ruby版)</span></a>
<ul>
<li class="toclevel-3 tocsection-3"><a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;direction=prev&amp;oldid=22128.html#.E7.8F.BE.E8.B1.A1"><span class="tocnumber">1.1.1</span> <span class="toctext">現象</span></a></li>
<li class="toclevel-3 tocsection-4"><a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;direction=prev&amp;oldid=22128.html#.E5.8E.9F.E5.9B.A0"><span class="tocnumber">1.1.2</span> <span class="toctext">原因</span></a></li>
<li class="toclevel-3 tocsection-5"><a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;direction=prev&amp;oldid=22128.html#.E5.AF.BE.E5.87.A6.28.E6.9A.AB.E5.AE.9A.29"><span class="tocnumber">1.1.3</span> <span class="toctext">対処(暫定)</span></a></li>
<li class="toclevel-3 tocsection-6"><a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;direction=prev&amp;oldid=22128.html#Stanza.E3.82.B3.E3.83.BC.E3.83.89.E4.BF.AE.E6.AD.A3.E5.86.85.E5.AE.B9"><span class="tocnumber">1.1.4</span> <span class="toctext">Stanzaコード修正内容</span></a></li>
<li class="toclevel-3 tocsection-7"><a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;direction=prev&amp;oldid=22128.html#.E7.B5.90.E6.9E.9C.E3.81.A8.E6.84.9F.E6.83.B3"><span class="tocnumber">1.1.5</span> <span class="toctext">結果と感想</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-8"><a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;direction=prev&amp;oldid=22128.html#togostanza.28js.E7.89.88.29"><span class="tocnumber">1.2</span> <span class="toctext">togostanza(js版)</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;direction=prev&amp;oldid=22128.html#SPARQList"><span class="tocnumber">1.3</span> <span class="toctext">SPARQList</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-10"><a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;direction=prev&amp;oldid=22128.html#Stardog"><span class="tocnumber">2</span> <span class="toctext">Stardog</span></a>
<ul>
<li class="toclevel-2 tocsection-11"><a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;direction=prev&amp;oldid=22128.html#togostanza.28ruby.E7.89.88.29_2"><span class="tocnumber">2.1</span> <span class="toctext">togostanza(ruby版)</span></a>
<ul>
<li class="toclevel-3 tocsection-12"><a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;direction=prev&amp;oldid=22128.html#Stanza.E3.82.B3.E3.83.BC.E3.83.89.E4.BF.AE.E6.AD.A3.E5.86.85.E5.AE.B9_2"><span class="tocnumber">2.1.1</span> <span class="toctext">Stanzaコード修正内容</span></a></li>
<li class="toclevel-3 tocsection-13"><a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;direction=prev&amp;oldid=22128.html#.E7.B5.90.E6.9E.9C.E3.81.A8.E6.84.9F.E6.83.B3_2"><span class="tocnumber">2.1.2</span> <span class="toctext">結果と感想</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-14"><a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;direction=prev&amp;oldid=22128.html#.E3.82.AF.E3.82.A8.E3.83.AA.E6.8A.9C.E3.81.8D.E5.87.BA.E3.81.97"><span class="tocnumber">2.2</span> <span class="toctext">クエリ抜き出し</span></a>
<ul>
<li class="toclevel-3 tocsection-15"><a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;direction=prev&amp;oldid=22128.html#gene_attributes"><span class="tocnumber">2.2.1</span> <span class="toctext">gene_attributes</span></a></li>
<li class="toclevel-3 tocsection-16"><a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;direction=prev&amp;oldid=22128.html#gene_length_nano"><span class="tocnumber">2.2.2</span> <span class="toctext">gene_length_nano</span></a></li>
<li class="toclevel-3 tocsection-17"><a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;direction=prev&amp;oldid=22128.html#genome_jbrowse"><span class="tocnumber">2.2.3</span> <span class="toctext">genome_jbrowse</span></a></li>
<li class="toclevel-3 tocsection-18"><a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;direction=prev&amp;oldid=22128.html#protein_attributes"><span class="tocnumber">2.2.4</span> <span class="toctext">protein_attributes</span></a></li>
<li class="toclevel-3 tocsection-19"><a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;direction=prev&amp;oldid=22128.html#protein_general_annotation"><span class="tocnumber">2.2.5</span> <span class="toctext">protein_general_annotation</span></a></li>
<li class="toclevel-3 tocsection-20"><a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;direction=prev&amp;oldid=22128.html#protein_ontologies"><span class="tocnumber">2.2.6</span> <span class="toctext">protein_ontologies</span></a></li>
<li class="toclevel-3 tocsection-21"><a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;direction=prev&amp;oldid=22128.html#protein_sequence_annotation"><span class="tocnumber">2.2.7</span> <span class="toctext">protein_sequence_annotation</span></a></li>
<li class="toclevel-3 tocsection-22"><a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;direction=prev&amp;oldid=22128.html#protein_sequence"><span class="tocnumber">2.2.8</span> <span class="toctext">protein_sequence</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</td></tr></table><script>if (window.showTocToggle) { var tocShowText = "表示"; var tocHideText = "非表示"; showTocToggle(); } </script>
<h2> <span class="mw-headline" id="AllegroGraph"> AllegroGraph </span></h2>
<h3> <span class="mw-headline" id="togostanza.28ruby.E7.89.88.29">togostanza(ruby版)</span></h3>
<h4> <span class="mw-headline" id=".E7.8F.BE.E8.B1.A1">現象</span></h4>
<p>SPARQL中の"?"がillegal characterとしてエラーになり実行できない。<br />
</p>
<pre>
?query=PREFIX%20taxid:%20%3Chttp:%2F%2Fidentifiers.org%2Ftaxonomy%2F%3E%0APREFIX%20stats:%20%3C
http:%2F%2Ftogogenome.org%2Fstats%2F%3E%0A%0ASELECT%20?genome_size%0AFROM%20%3Chttp:%2F%2Ftogogenome.org%2Fgraph%2Fstats%3E%0A
WHERE%0A%7B%0A%20%20taxid:103690%20stats:sequence_length%20?genome_size%20.%0A%7D%0A&quot;\n contains illegal character #\? at position 173.
</pre>
<h4> <span class="mw-headline" id=".E5.8E.9F.E5.9B.A0">原因</span></h4>
<ul><li> togostanzaが内部で呼び出しているrdfモジュール(ruby-rdf)中でURIを一度デコードしていてエンコードしているがその際に"?"のエンコードが漏れる
</li></ul>
<p><a href="https://github.com/ruby-rdf/rdf/blob/develop/lib/rdf/model/uri.rb#L1266-L1274" class="external text" rel="nofollow">ソースコード</a>  URI.encode()ではなくCGI.escape()に
</p>
<ul><li> Virtuosoの場合は"?"が含まれていてもエラーにならないため、AllegroGraph側の問題かもしれない
</li></ul>
<h4> <span class="mw-headline" id=".E5.AF.BE.E5.87.A6.28.E6.9A.AB.E5.AE.9A.29">対処(暫定)</span></h4>
<p>ruby-rdfのエンコード処理部分のコードを改修する
</p>
<h4> <span class="mw-headline" id="Stanza.E3.82.B3.E3.83.BC.E3.83.89.E4.BF.AE.E6.AD.A3.E5.86.85.E5.AE.B9">Stanzaコード修正内容</span></h4>
<p>Allegro graphで動作するために以下のようなSPARQL改修を行った
</p>
<ul><li>Virtuoso独自メソッドの排除
</li></ul>
<pre> 削除: DEFINE sql:select-option &quot;order&quot; </pre>
<pre>
//subClassOf*で階層順序を取得するための独自関数
?search_tax rdfs:subClassOf&nbsp;?tax OPTION (transitive, t_direction 1, t_min(0), t_step(&quot;step_no&quot;) as&nbsp;?step) .
</pre>
<ul><li>ASで変数に別名をつける際には括弧で囲む
</li></ul>
<pre>
前: SELECT COUNT(DISTINCT&nbsp;?gold) AS&nbsp;?cnt
後: SELECT (COUNT(DISTINCT&nbsp;?gold) AS&nbsp;?cnt)
</pre>
<p>GROUP_CONCATの文法は仕様に準拠する
</p>
<pre>
前: (GROUP_CONCAT(DISTINCT&nbsp;?exact_synonym, &quot;, &quot;) AS&nbsp;?exact_synonyms)
後: (GROUP_CONCAT(DISTINCT&nbsp;?exact_synonym; SEPARATOR = &quot;, &quot;) AS&nbsp;?exact_synonyms)
</pre>
<p>暗黙的GROUP BYは効かないのでGROUP BYを記述する
</p>
<pre>
前:
SELECT&nbsp;?tax_id (COUNT(DISTINCT&nbsp;?gold) AS&nbsp;?cnt) {
   (略)
}
後:
SELECT&nbsp;?type (COUNT(DISTINCT&nbsp;?gold) AS&nbsp;?cnt) {
   (略)
} GROUP BY&nbsp;?tax_id
</pre>
<p>URIを文字列系関数にかける場合にはSRT()で必ず文字列置換する
</p>
<pre>
前: FILTER(regex(?pdo_uri, &quot;PDO&quot;))
後: FILTER(regex(STR(?pdo_uri), &quot;PDO&quot;))
</pre>
<p>よく分からないがBINDがエラーになるケースがあるので、その場合は(可能なら)SELECT句に記述する
</p>
<pre>
前:
SELECT&nbsp;?type {
   (略)
  BIND (&quot;GOLD&quot; AS&nbsp;?type ).
}
後: SELECT (&quot;GOLD&quot; AS&nbsp;?type)  {
   (略)
  //BIND削除
}
</pre>
<ul><li> FROMでグラフ名を差すのはVirtuoso独自だと思っていたが、意外と動いている(内容は確認が必要)
</li></ul>
<h4> <span class="mw-headline" id=".E7.B5.90.E6.9E.9C.E3.81.A8.E6.84.9F.E6.83.B3">結果と感想</span></h4>
<ul><li> SPARQLは仕様に則り正しく書きましょう
</li><li> 体感だが実行速度はVirtuosoより遅い。チューニング方法があるかもしれないが、分からない。
<ul><li> organismやenvironmentのIDを軸にした軽いクエリは動作するがやや重い
</li><li> gene系(数十億トリプルのGraphを使用)するとタイムアウトするものが多い。メモリが上限に達したというエラーが出ることもある
</li></ul>
</li></ul>
<h3> <span class="mw-headline" id="togostanza.28js.E7.89.88.29">togostanza(js版)</span></h3>
<p>Ruby版でみられたような"?"で怒られることはなく、クエリを実行できる。速度計測や個々のクエリの検証は未済(Ruby版で検証したので)
</p>
<h3> <span class="mw-headline" id="SPARQList">SPARQList</span></h3>
<h2> <span class="mw-headline" id="Stardog"> Stardog </span></h2>
<h3> <span class="mw-headline" id="togostanza.28ruby.E7.89.88.29_2">togostanza(ruby版)</span></h3>
<h4> <span class="mw-headline" id="Stanza.E3.82.B3.E3.83.BC.E3.83.89.E4.BF.AE.E6.AD.A3.E5.86.85.E5.AE.B9_2">Stanzaコード修正内容</span></h4>
<p>TogoGenomeのスタンザクエリはそのままStardogで動作するものもあったが、いくつかの理由で書き換えが必要になるものもあった。
</p>
<ul><li> Virtuoso独自メソッドの排除 (Allegro graphと同じ)
</li><li> FROM句を省略した場合Stardogでは結果がヒットしない
</li></ul>
<p>ロードデータは全てNamed graphにロードされ、default graphには何も入っていない状態のためだと思われる(仕様通りの挙動)
</p>
<pre>
前:
SELECT *
{
 ?protein a &lt;http://purl.uniprot.org/core/Protein&gt;
} LIMIT 10
=&gt; ノーヒット
後:
SELECT *
FROM &lt;http://togogenome.org/graph/uniprot&gt;
{
 ?protein a &lt;http://purl.uniprot.org/core/Protein&gt;
} LIMIT 10
</pre>
<ul><li> GRAPH句を使っている場合Stardogでは結果がヒットしない
</li></ul>
<p>Virtuosoでは速度チューニングのためにわざとGRAPH句で囲っている場合がある。ただしグラフを混ぜたくない場合にも使う事があるためその場合の回避方法が不明(ドキュメント読めば分かるかも?)
</p>
<pre>
前:
GRAPH &lt;http://togogenome.org/graph/uniprot&gt; {
 &nbsp;?isoform rdf:value&nbsp;?protein_seq .
}
後:
 ?isoform rdf:value&nbsp;?protein_seq .
</pre>
<ul><li> OPTIONALのグループグラフ(波カッコ)内で複数パターンを囲む際は遅くなるクエリが遅くなる場合がある
</li></ul>
<p>OPTIONAL句内のパターン同士が先にマッピングされているらしいので、外側で?isoformなどの変数が絞り込まれていても反映されず重くなる。<br />
このようなケースではquery explainコマンドでクエリ実行計画を出力して遅くなる部分を特定する。<br />
<a href="https://community.stardog.com/t/java-lang-outofmemoryerror-java-heap-space/240/14" class="external text" rel="nofollow">相談したページ</a> <a href="https://docs.stardog.com/man/query-explain.html" class="external text" rel="nofollow">explainコマンド</a> <a href="https://docs.stardog.com/#_managing_query_performance" class="external text" rel="nofollow">実行計画の見方</a>
</p>
<pre>
前:
OPTIONAL {
 &nbsp;?annotation up:substitution&nbsp;?substitution . 
 &nbsp;?isoform rdf:value&nbsp;?seq .
}
=&gt; OPTIONAL句内のパターン同士で先にマッピングされるが変数が被っていないので総当たりになり返ってこない
後:
OPTIONAL {
 &nbsp;?annotation up:substitution&nbsp;?substitution . 
}
OPTIONAL {
 &nbsp;?isoform rdf:value&nbsp;?seq .
}
</pre>
<ul><li> UNIONのグループグラフ(波カッコ)内で複数パターンを囲む際は遅くなるクエリが遅くなる場合がある
</li></ul>
<p>OPTIONALと同様にグループグラフ内を先に解決するのか、外側のVALUES句で指定した条件でトリプルが絞れるにも関わらず返ってこない
</p>
<pre>
前:
{
  VALUES&nbsp;?gene_id { tg:XXX }
  {
   &nbsp;?gene_id skos:exactMatch&nbsp;?gene&nbsp;;
     ....
  }
  UNION
  {
   &nbsp;?gene_id skos:exactMatch&nbsp;?gene&nbsp;;
     ....
  }
}
後:
{
  {
    VALUES&nbsp;?gene_id { tg:XXX }
   &nbsp;?gene_id skos:exactMatch&nbsp;?gene&nbsp;;
     ....
  }
  UNION
  {
    VALUES&nbsp;?gene_id { tg:XXX }
   &nbsp;?gene_id skos:exactMatch&nbsp;?gene&nbsp;;
     ....
  }
}
</pre>
<ul><li> VALUES句を使うと遅くなる場合がある
</li></ul>
<p>よく分からないがVALUESで絞ろうとすると遅くなる場合がある。必ずしも遅くなるわけでない(explain実行すれば分かるかも)
</p>
<pre>
前:
VALUES&nbsp;?feature_type { insdc:Coding_Sequence }
?feature a&nbsp;?feature_type&nbsp;;
後:
?feature a insdc:Coding_Sequence&nbsp;;
</pre>
<ul><li> VALUES句を使わないと遅くなる場合がある
</li></ul>
<p>逆にVALUES句を使わないと遅くなるケースもあった。VALUES句を使わないければ遅くて返ってこない(explain実行すれば分かるかも)。
</p>
<pre>
前:
?strand_type rdfs:subClassOf faldo:StrandedPosition
後:
VALUES&nbsp;?strand_postype { faldo:StrandedPosition }
?strand_type rdfs:subClassOf&nbsp;?strand_postype&nbsp;;
</pre>
<ul><li> SELECT句で文字列変換をすると遅くなる場合がある
</li></ul>
<p>SELECT句でReplace関数を使用したら返ってこなかったが、BINDで置換を実行したら速度改善した。他のクエリでは大丈夫な場合もあったので不明。
</p>
<pre>
前:
SELECT DISTINCT (REPLACE(STR(?taxonomy),&quot;http://identifiers.org/taxonomy/&quot;,&quot;&quot;) AS&nbsp;?tax_id)
後:
BIND (REPLACE(STR(?taxonomy),&quot;http://identifiers.org/taxonomy/&quot;,&quot;&quot;) AS&nbsp;?tax_id)
</pre>
<h4> <span class="mw-headline" id=".E7.B5.90.E6.9E.9C.E3.81.A8.E6.84.9F.E6.83.B3_2">結果と感想</span></h4>
<ul><li> gene系の大量データを検索する際にもVirtuosoと同じぐらいのスピードで返ってくるようになったクエリもある
</li><li> TogoGenomeのページのように同時に重数個のスタンザ表示を行おうとすると、いくつかはタイムアウトで返ってこなくなる(まだ遅いクエリのチューニング、同時接続数を増やす事で可能かも？)
</li><li> メモリ消費が130G程になっていたが、現実的なメモリ量でも動作するかは検証が必要
</li><li> Virtuosoでのパフォーマンスチューニングは「上から順番に解釈させる」というものだったがStardogは同じ方法は取れない。データ量が多い場合、複数のRDFストア間で共通のSPARQLを使い回す事は難しい
</li></ul>
<h3> <span class="mw-headline" id=".E3.82.AF.E3.82.A8.E3.83.AA.E6.8A.9C.E3.81.8D.E5.87.BA.E3.81.97">クエリ抜き出し</span></h3>
<h4> <span class="mw-headline" id="gene_attributes">gene_attributes</span></h4>
<pre>
     PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
      PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;
      PREFIX skos: &lt;http://www.w3.org/2004/02/skos/core#&gt;
      PREFIX obo:    &lt;http://purl.obolibrary.org/obo/&gt;
      PREFIX insdc: &lt;http://ddbj.nig.ac.jp/ontologies/nucleotide/&gt;
      PREFIX uniprot: &lt;http://purl.uniprot.org/core/&gt;
      PREFIX faldo: &lt;http://biohackathon.org/resource/faldo#&gt;
      SELECT DISTINCT
       &nbsp;?locus_tag&nbsp;?gene_type_label&nbsp;?gene_name
       &nbsp;?refseq_link&nbsp;?seq_label&nbsp;?seq_type_label&nbsp;?refseq_label&nbsp;?organism&nbsp;?tax_link
       &nbsp;?strand&nbsp;?insdc_location
      FROM &lt;http://togogenome.org/graph/tgup&gt;
      FROM &lt;http://togogenome.org/graph/uniprot&gt;
      FROM &lt;http://togogenome.org/graph/refseq&gt;
      FROM &lt;http://togogenome.org/graph/so&gt;
      FROM &lt;http://togogenome.org/graph/faldo&gt;
      {
        {
          SELECT&nbsp;?feature
          {
            {
              &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS0908&gt; skos:exactMatch&nbsp;?gene&nbsp;;
                rdfs:seeAlso/rdfs:seeAlso&nbsp;?uniprot .
             &nbsp;?uniprot a uniprot:Protein&nbsp;;
                uniprot:sequence&nbsp;?isoform .
             &nbsp;?isoform rdf:value&nbsp;?protein_seq .
             &nbsp;?feature obo:so_part_of&nbsp;?gene&nbsp;;
                a insdc:Coding_Sequence&nbsp;;
                insdc:translation&nbsp;?translation .
              FILTER (?protein_seq =&nbsp;?translation)
            }
            UNION
            {
              VALUES&nbsp;?feature_type { insdc:Transfer_RNA insdc:Ribosomal_RNA insdc:Non_Coding_RNA }
              &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS0908&gt;  skos:exactMatch&nbsp;?gene .
             &nbsp;?feature obo:so_part_of&nbsp;?gene&nbsp;;
                insdc:location&nbsp;?insdc_location&nbsp;;
                a&nbsp;?feature_type .
            }
          } LIMIT 1
        }
        #feature info
        VALUES&nbsp;?feature_type { obo:SO_0000316 obo:SO_0000252 obo:SO_0000253 obo:SO_0000655 } #CDS,rRNA,tRNA,ncRNA
        VALUES&nbsp;?strand_postype { faldo:StrandedPosition }
       &nbsp;?feature rdfs:subClassOf&nbsp;?feature_type&nbsp;;
          rdfs:label&nbsp;?gene_label .
        #sequence / organism info
       &nbsp;?feature obo:so_part_of*&nbsp;?seq .
       &nbsp;?seq rdfs:subClassOf&nbsp;?seq_type .
       &nbsp;?refseq_link insdc:sequence&nbsp;?seq&nbsp;;
          insdc:definition&nbsp;?seq_label&nbsp;;
          insdc:sequence_version&nbsp;?refseq_label&nbsp;;
          insdc:sequence_version&nbsp;?refseq_ver&nbsp;;
          insdc:organism&nbsp;?organism .
       &nbsp;?feature obo:RO_0002162&nbsp;?tax_link .
        #location info
       &nbsp;?feature insdc:location &nbsp;?insdc_location&nbsp;;
          faldo:location &nbsp;?faldo .
       &nbsp;?faldo faldo:begin/rdf:type&nbsp;?strand_type .
        OPTIONAL {&nbsp;?feature insdc:gene&nbsp;?gene_name }
        OPTIONAL {&nbsp;?feature insdc:locus_tag&nbsp;?locus_tag }
       &nbsp;?feature_type rdfs:label&nbsp;?gene_type_label .
       &nbsp;?seq_type rdfs:label&nbsp;?seq_type_label .
       &nbsp;?strand_type rdfs:subClassOf&nbsp;?strand_postype&nbsp;;
        rdfs:label&nbsp;?strand .
      }
</pre>
<h4> <span class="mw-headline" id="gene_length_nano">gene_length_nano</span></h4>
<pre>
      PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
      PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;
      PREFIX skos: &lt;http://www.w3.org/2004/02/skos/core#&gt;
      PREFIX obo:    &lt;http://purl.obolibrary.org/obo/&gt;
      PREFIX insdc: &lt;http://ddbj.nig.ac.jp/ontologies/nucleotide/&gt;
      PREFIX uniprot: &lt;http://purl.uniprot.org/core/&gt;

      SELECT&nbsp;?insdc_location
      FROM &lt;http://togogenome.org/graph/tgup&gt;
      FROM &lt;http://togogenome.org/graph/uniprot&gt;
      FROM &lt;http://togogenome.org/graph/refseq&gt;
      {
        {
          SELECT&nbsp;?feature
          {
            {
              &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085&gt; skos:exactMatch&nbsp;?gene&nbsp;;
                rdfs:seeAlso/rdfs:seeAlso&nbsp;?uniprot .
             &nbsp;?uniprot a uniprot:Protein&nbsp;;
                uniprot:sequence&nbsp;?isoform .
             &nbsp;?isoform rdf:value&nbsp;?protein_seq .
             &nbsp;?feature obo:so_part_of&nbsp;?gene&nbsp;;
                a insdc:Coding_Sequence&nbsp;;
                insdc:translation&nbsp;?translation .
              FILTER (?protein_seq =&nbsp;?translation)
            }
            UNION
            {
              VALUES&nbsp;?feature_type { insdc:Transfer_RNA insdc:Ribosomal_RNA insdc:Non_Coding_RNA }
              &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085&gt; skos:exactMatch&nbsp;?gene .
             &nbsp;?feature obo:so_part_of&nbsp;?gene&nbsp;;
                insdc:location&nbsp;?insdc_location&nbsp;;
                a&nbsp;?feature_type .
            }
          } LIMIT 1
        }
       &nbsp;?feature insdc:location&nbsp;?insdc_location .
      }
</pre>
<h4> <span class="mw-headline" id="genome_jbrowse">genome_jbrowse</span></h4>
<pre>
      PREFIX skos: &lt;http://www.w3.org/2004/02/skos/core#&gt;
      PREFIX obo: &lt;http://purl.obolibrary.org/obo/&gt;

      SELECT DISTINCT&nbsp;?tax_id
      FROM &lt;http://togogenome.org/graph/tgup&gt;
      FROM &lt;http://togogenome.org/graph/refseq&gt;
      WHERE
      {
        {
          SELECT&nbsp;?feature_uri
          {
            &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085&gt; skos:exactMatch&nbsp;?feature_uri .
          } ORDER BY&nbsp;?feature_uri LIMIT 1
        }
       &nbsp;?feature_uri  obo:RO_0002162&nbsp;?taxonomy
        BIND (REPLACE(STR(?taxonomy),&quot;http://identifiers.org/taxonomy/&quot;,&quot;&quot;) AS&nbsp;?tax_id)
      }
</pre>
<pre>
      PREFIX skos: &lt;http://www.w3.org/2004/02/skos/core#&gt;
      PREFIX obo: &lt;http://purl.obolibrary.org/obo/&gt;
      PREFIX insdc: &lt;http://ddbj.nig.ac.jp/ontologies/nucleotide/&gt;
      PREFIX faldo: &lt;http://biohackathon.org/resource/faldo#&gt;

      SELECT&nbsp;?seq_label&nbsp;?start&nbsp;?end&nbsp;?seq_length
      FROM &lt;http://togogenome.org/graph/tgup&gt;
      FROM &lt;http://togogenome.org/graph/refseq&gt;
      WHERE
      {
        {
          SELECT&nbsp;?feature_uri
          {
            &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085&gt; skos:exactMatch&nbsp;?feature_uri .
          } ORDER BY&nbsp;?feature_uri LIMIT 1
        }
       &nbsp;?feature_uri insdc:location &nbsp;?insdc_location&nbsp;;
          faldo:location &nbsp;?faldo .
       &nbsp;?faldo faldo:begin/faldo:position&nbsp;?start .
       &nbsp;?faldo faldo:end/faldo:position&nbsp;?end .

       &nbsp;?feature_uri obo:so_part_of&nbsp;?seq .
       &nbsp;?refseq insdc:sequence&nbsp;?seq&nbsp;;
          insdc:sequence_version&nbsp;?seq_label .
       &nbsp;?seq insdc:sequence_length&nbsp;?seq_length
      }
</pre>
<h4> <span class="mw-headline" id="protein_attributes">protein_attributes</span></h4>
<pre>
      PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;
      PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
      PREFIX skos: &lt;http://www.w3.org/2004/02/skos/core#&gt;
      PREFIX up: &lt;http://purl.uniprot.org/core/&gt;

      SELECT DISTINCT&nbsp;?sequence&nbsp;?fragment&nbsp;?precursor&nbsp;?existence_label
      FROM &lt;http://togogenome.org/graph/uniprot&gt;
      FROM &lt;http://togogenome.org/graph/tgup&gt;
      WHERE {
        {
          SELECT&nbsp;?gene
          {
            &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085&gt; skos:exactMatch&nbsp;?gene .
          } ORDER BY&nbsp;?gene LIMIT 1
        }
        &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085&gt; skos:exactMatch&nbsp;?gene&nbsp;;
          rdfs:seeAlso&nbsp;?id_upid .
       &nbsp;?id_upid rdfs:seeAlso&nbsp;?protein .
       &nbsp;?protein a up:Protein&nbsp;;
                 up:sequence&nbsp;?seq .

        # Sequence
        OPTIONAL {
         &nbsp;?seq rdf:value&nbsp;?sequence .
        }

        # Sequence status
        OPTIONAL {
         &nbsp;?seq up:fragment&nbsp;?fragment .
        }

        # Sequence processing
        OPTIONAL {
         &nbsp;?seq up:precursor&nbsp;?precursor .
        }

        # Protein existence
        OPTIONAL {
         &nbsp;?protein up:existence&nbsp;?existence .
         &nbsp;?existence rdfs:label&nbsp;?existence_label .
        }
      }
</pre>
<h4> <span class="mw-headline" id="protein_general_annotation">protein_general_annotation</span></h4>
<pre>
    PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;
    PREFIX skos: &lt;http://www.w3.org/2004/02/skos/core#&gt;
    PREFIX up: &lt;http://purl.uniprot.org/core/&gt;

    SELECT DISTINCT&nbsp;?name&nbsp;?message
    FROM &lt;http://togogenome.org/graph/uniprot&gt;
    FROM &lt;http://togogenome.org/graph/tgup&gt;
    WHERE {
        {
          SELECT&nbsp;?gene
          {
            &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085&gt; skos:exactMatch&nbsp;?gene .
          } LIMIT 1
        }
        &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085&gt; skos:exactMatch&nbsp;?gene&nbsp;;
          rdfs:seeAlso&nbsp;?id_upid .
       &nbsp;?id_upid rdfs:seeAlso&nbsp;?protein .
       &nbsp;?protein a up:Protein&nbsp;;
                 up:annotation&nbsp;?annotation .

        {
            # type がup:Annotation のアノテーション

           &nbsp;?annotation a up:Annotation .

            # name, message の取得
            BIND(STR('Miscellaneous') AS&nbsp;?name) .
           &nbsp;?annotation rdfs:comment&nbsp;?message .
        }UNION{
            # subClassOf Annotation で type が up:Subcellular_Location_Annotation のアノテーション

           &nbsp;?annotation a up:Subcellular_Location_Annotation .

            # name, message の取得
           &nbsp;?annotation up:locatedIn&nbsp;?located_in .
           &nbsp;?located_in up:cellularComponent&nbsp;?location .
           &nbsp;?location up:alias&nbsp;?message .
            BIND(STR(&quot;Subcellular Location&quot;) AS&nbsp;?name) .
        }UNION{
            # type が up:Subcellular_Location_Annotation 以外の subClassOf Annotation のアノテーション
 
           &nbsp;?annotation a&nbsp;?type .
           &nbsp;?type rdfs:subClassOf up:Annotation .
            FILTER (?type&nbsp;!= up:Subcellular_Location_Annotation)

            # name, message の取得
           &nbsp;?type rdfs:label&nbsp;?name .
           &nbsp;?annotation rdfs:comment&nbsp;?message .
        }
    }
</pre>
<h4> <span class="mw-headline" id="protein_ontologies">protein_ontologies</span></h4>
<pre>
      PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
      PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;
      PREFIX up: &lt;http://purl.uniprot.org/core/&gt;
      PREFIX skos: &lt;http://www.w3.org/2004/02/skos/core#&gt;

      SELECT DISTINCT&nbsp;?root_name&nbsp;?concept (GROUP_CONCAT(?name; SEPARATOR = &quot;, &quot;) AS&nbsp;?names)
      FROM &lt;http://togogenome.org/graph/uniprot&gt;
      FROM &lt;http://togogenome.org/graph/tgup&gt;
      WHERE {
        {
          SELECT&nbsp;?gene
          {
            &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085&gt; skos:exactMatch&nbsp;?gene .
          } ORDER BY&nbsp;?gene LIMIT 1
        }
        &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085&gt; skos:exactMatch&nbsp;?gene&nbsp;;
          rdfs:seeAlso&nbsp;?id_upid .
       &nbsp;?id_upid rdfs:seeAlso&nbsp;?protein .
       &nbsp;?protein a up:Protein&nbsp;;
                 up:classifiedWith&nbsp;?concept .
       &nbsp;?concept rdf:type up:Concept .
        FILTER contains(str(?concept), 'keywords') .

       &nbsp;?concept&nbsp;?label&nbsp;?name FILTER (?label = skos:prefLabel ||&nbsp;?label = skos:altLabel).
       &nbsp;?concept rdfs:subClassOf*&nbsp;?parents .
       &nbsp;?parents skos:prefLabel&nbsp;?root_name .
        FILTER (str(?root_name) IN ('Biological process', 'Cellular component', 'Domain', 'Ligand', 'Molecular function', 'Technical term')) .
      }
      GROUP BY&nbsp;?root_name&nbsp;?concept
      ORDER BY&nbsp;?root_name&nbsp;?concept&nbsp;?names
</pre>
<pre>
      PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;
      PREFIX skos: &lt;http://www.w3.org/2004/02/skos/core#&gt;
      PREFIX up: &lt;http://purl.uniprot.org/core/&gt;
      PREFIX taxonomy: &lt;http://purl.uniprot.org/taxonomy/&gt;

      SELECT DISTINCT&nbsp;?name&nbsp;?root_name&nbsp;?obo_go_uri
      FROM &lt;http://togogenome.org/graph/uniprot&gt;
      FROM &lt;http://togogenome.org/graph/tgup&gt;
      FROM &lt;http://togogenome.org/graph/go&gt;
      WHERE {
        {
          SELECT&nbsp;?gene
          {
            &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085&gt; skos:exactMatch&nbsp;?gene .
          } ORDER BY&nbsp;?gene LIMIT 1
        }
        &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085&gt; skos:exactMatch&nbsp;?gene&nbsp;;
          rdfs:seeAlso&nbsp;?id_upid .
       &nbsp;?id_upid rdfs:seeAlso&nbsp;?protein .
       &nbsp;?protein a up:Protein&nbsp;;
                 up:classifiedWith&nbsp;?obo_go_uri .
       &nbsp;?obo_go_uri rdfs:label&nbsp;?name .
       &nbsp;?obo_go_uri rdfs:subClassOf*&nbsp;?parents .
       &nbsp;?parents rdfs:label&nbsp;?root_name .
        FILTER (str(?root_name) IN ('biological_process', 'cellular_component', 'molecular_function')) .
      }
</pre>
<h4> <span class="mw-headline" id="protein_sequence_annotation">protein_sequence_annotation</span></h4>
<pre>
      PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
      PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;
      PREFIX skos: &lt;http://www.w3.org/2004/02/skos/core#&gt;
      PREFIX up: &lt;http://purl.uniprot.org/core/&gt;
      PREFIX faldo: &lt;http://biohackathon.org/resource/faldo#&gt;

      SELECT DISTINCT&nbsp;?parent_label&nbsp;?label&nbsp;?begin_location&nbsp;?end_location&nbsp;?seq_length&nbsp;?comment (GROUP_CONCAT(?substitution; SEPARATOR = &quot;, &quot;) AS&nbsp;?substitutions)&nbsp;?seq_txt&nbsp;?feature_identifier
      FROM &lt;http://togogenome.org/graph/uniprot&gt;
      FROM &lt;http://togogenome.org/graph/tgup&gt;
      WHERE {
        {
          SELECT&nbsp;?gene
          {
            &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085&gt; skos:exactMatch&nbsp;?gene .
          } ORDER BY&nbsp;?gene LIMIT 1
        }
        &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085&gt; skos:exactMatch&nbsp;?gene&nbsp;;
          rdfs:seeAlso&nbsp;?id_upid .
       &nbsp;?id_upid rdfs:seeAlso&nbsp;?protein .
       &nbsp;?protein a up:Protein&nbsp;;
                 up:annotation&nbsp;?annotation .

       &nbsp;?annotation rdf:type&nbsp;?type .
       &nbsp;?type rdfs:label&nbsp;?label .

        # sequence annotation 直下のtype のラベルを取得(Region, Site, Molecule Processing, Experimental Information)
       &nbsp;?type rdfs:subClassOf*&nbsp;?parent_type .
       &nbsp;?parent_type rdfs:subClassOf up:Sequence_Annotation&nbsp;;
                     rdfs:label&nbsp;?parent_label .

       &nbsp;?annotation up:range&nbsp;?range .
        OPTIONAL {&nbsp;?annotation rdfs:comment&nbsp;?comment . }
       &nbsp;?range faldo:begin/faldo:position&nbsp;?begin_location&nbsp;;
               faldo:end/faldo:position&nbsp;?end_location .


        # 互いに isoform なUniprotがあるので (e.g. P42166, P42167) 同じIDの isoform で配列のあるものに絞る
       &nbsp;?protein up:sequence&nbsp;?isoform .
        BIND( REPLACE( STR(?protein), &quot;http://purl.uniprot.org/uniprot/&quot;, &quot;&quot;) AS&nbsp;?up_id)
        FILTER( REGEX(STR(?isoform),&nbsp;?up_id))
       &nbsp;?isoform rdf:value&nbsp;?value .

        # description の一部が取得できるが、内容の表示に必要があるのか
        OPTIONAL {
         &nbsp;?annotation up:substitution&nbsp;?substitution . 
        }

        # sequence の長さ取得
        OPTIONAL {
         &nbsp;?isoform rdf:value&nbsp;?seq_txt .
          BIND (STRLEN(?seq_txt) AS&nbsp;?seq_length) .
        }

        OPTIONAL {
         &nbsp;?annotation rdf:type&nbsp;?any_type . # Virtuoso 対応
          BIND (STR(?annotation) AS&nbsp;?feature_identifier) .
          FILTER REGEX(STR(?feature_identifier), &quot;http://purl.uniprot.org/annotation&quot;)
        }
      }
      GROUP BY&nbsp;?parent_label&nbsp;?label&nbsp;?begin_location&nbsp;?end_location&nbsp;?seq_length&nbsp;?comment&nbsp;?seq_txt&nbsp;?feature_identifier
      ORDER BY&nbsp;?parent_label&nbsp;?label&nbsp;?begin_location&nbsp;?end_location
</pre>
<h4> <span class="mw-headline" id="protein_sequence">protein_sequence</span></h4>
<pre>
      PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
      PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;
      PREFIX skos: &lt;http://www.w3.org/2004/02/skos/core#&gt;
      PREFIX up: &lt;http://purl.uniprot.org/core/&gt;

      SELECT DISTINCT&nbsp;?up_id&nbsp;?aminoacid&nbsp;?mass&nbsp;?modified&nbsp;?version&nbsp;?checksum&nbsp;?fragment&nbsp;?precursor&nbsp;?existence_label
      FROM &lt;http://togogenome.org/graph/uniprot&gt;
      FROM &lt;http://togogenome.org/graph/tgup&gt;
      WHERE {
        {
          SELECT&nbsp;?gene
          {
            &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085&gt; skos:exactMatch&nbsp;?gene .
          } ORDER BY&nbsp;?gene LIMIT 1
        }
        &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085&gt; skos:exactMatch&nbsp;?gene&nbsp;;
          rdfs:seeAlso&nbsp;?id_upid .
       &nbsp;?id_upid rdfs:seeAlso&nbsp;?protein .
       &nbsp;?protein a up:Protein&nbsp;;
                 up:sequence&nbsp;?isoform .

        # (P42166 &amp; P42167) x (P42166-1 &amp; P42167-1) =&gt; P42166 - P42166-1, P42167 - P42167-1
        BIND( REPLACE( STR(?protein), &quot;http://purl.uniprot.org/uniprot/&quot;, &quot;&quot;) AS&nbsp;?up_id)
        FILTER( REGEX(STR(?isoform),&nbsp;?up_id))

       &nbsp;?isoform rdf:value&nbsp;?aminoacid&nbsp;;
                 up:mass&nbsp;?mass&nbsp;;
                 up:modified&nbsp;?modified&nbsp;;
                 up:version&nbsp;?version&nbsp;;
                 up:crc64Checksum&nbsp;?checksum .

        # Sequence status
        OPTIONAL {
         &nbsp;?isoform up:fragment&nbsp;?fragment .
        }

        # Sequence processing
        OPTIONAL {
         &nbsp;?isoform up:precursor&nbsp;?precursor .
        }

        # Protein existence
        OPTIONAL {
         &nbsp;?protein up:existence&nbsp;?existence .
         &nbsp;?existence rdfs:label&nbsp;?existence_label .
        }
      }
</pre>

<!-- 
NewPP limit report
Preprocessor node count: 306/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->
<div class="printfooter">
「<a href="SPARQLthon55/togo_rdfstore.html">http://wiki.lifesciencedb.jp/mw/SPARQLthon55/togo_rdfstore</a>」より作成</div>
		<div id='catlinks' class='catlinks catlinks-allhidden'></div>		<!-- end content -->
				<div class="visualClear"></div>
	</div>
</div></div>
<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>表示</h5>
		<div class="pBody">
			<ul>
				 <li id="ca-nstab-main" class="selected"><a href="SPARQLthon55/togo_rdfstore.html" title="本文を表示 [c]" accesskey="c">ページ</a></li>
				 <li id="ca-talk" class="new"><a href="http://wiki.lifesciencedb.jp/mw/index.php?title=%E3%83%8E%E3%83%BC%E3%83%88:SPARQLthon55/togo_rdfstore&amp;action=edit&amp;redlink=1" title="記事についての議論 [t]" accesskey="t">議論</a></li>
				 <li id="ca-viewsource"><a href="http://wiki.lifesciencedb.jp/mw/index.php?title=SPARQLthon55/togo_rdfstore&amp;action=edit&amp;oldid=22127" title="このページは保護されています。&#10;ページのソースを閲覧できます。 [e]" accesskey="e">ソースを表示</a></li>
				 <li id="ca-history"><a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;action=history.html" title="このページの過去の版 [h]" accesskey="h">履歴</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>個人用ツール</h5>
		<div class="pBody">
			<ul>
				<li id="pt-anonuserpage"><a href="http://wiki.lifesciencedb.jp/mw/%E5%88%A9%E7%94%A8%E8%80%85:172.18.8.51" title="自分が編集しているIPアドレスの利用者ページ [.]" accesskey="." class="new">172.18.8.51</a></li>
				<li id="pt-anontalk"><a href="http://wiki.lifesciencedb.jp/mw/%E5%88%A9%E7%94%A8%E8%80%85%E2%80%90%E4%BC%9A%E8%A9%B1:172.18.8.51" title="このIPアドレスからなされた編集についての議論 [n]" accesskey="n" class="new">このIPアドレスのトーク</a></li>
				<li id="pt-anonlogin"><a href="http://wiki.lifesciencedb.jp/mw/index.php?title=%E7%89%B9%E5%88%A5:%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3&amp;returnto=SPARQLthon55/togo_rdfstore&amp;returntoquery=direction%3Dprev%26oldid%3D22128" title="ログインすることが推奨されます。ただし、必須ではありません。 [o]" accesskey="o">ログイン</a></li>
				<li id="pt-openidlogin"><a href="index.php@title=特別%253AOpenIDログイン&amp;returnto=SPARQLthon55%252Ftogo_rdfstore.html">OpenIDでログイン</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a style="background-image: url(http://wiki.lifesciencedb.jp/mw/images/togowiki-logo.png);" href="index.html" title="メインページに移動"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
	<div class='generated-sidebar portlet' id='p-navigation'>
		<h5>案内</h5>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage-description"><a href="index.html" title="メインページに移動する [z]" accesskey="z">メインページ</a></li>
				<li id="n-portal"><a href="http://wiki.lifesciencedb.jp/mw/TogoWiki:%E3%82%B3%E3%83%9F%E3%83%A5%E3%83%8B%E3%83%86%E3%82%A3%E3%83%BB%E3%83%9D%E3%83%BC%E3%82%BF%E3%83%AB" title="このプロジェクトについて、できること、情報を入手する場所">コミュニティ・ポータル</a></li>
				<li id="n-currentevents"><a href="http://wiki.lifesciencedb.jp/mw/TogoWiki:%E6%9C%80%E8%BF%91%E3%81%AE%E5%87%BA%E6%9D%A5%E4%BA%8B" title="最近の出来事について予備知識を得る">最近の出来事</a></li>
				<li id="n-recentchanges"><a href="http://wiki.lifesciencedb.jp/mw/%E7%89%B9%E5%88%A5:%E6%9C%80%E8%BF%91%E3%81%AE%E6%9B%B4%E6%96%B0" title="ウィキにおける最近の更新の一覧 [r]" accesskey="r">最近の更新</a></li>
				<li id="n-randompage"><a href="http://wiki.lifesciencedb.jp/mw/%E7%89%B9%E5%88%A5:%E3%81%8A%E3%81%BE%E3%81%8B%E3%81%9B%E8%A1%A8%E7%A4%BA" title="無作為に抽出されたページの読み込み [x]" accesskey="x">おまかせ表示</a></li>
				<li id="n-help"><a href="http://wiki.lifesciencedb.jp/mw/Help:%E7%9B%AE%E6%AC%A1" title="情報を得る場所">ヘルプ</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">検索</label></h5>
		<div id="searchBody" class="pBody">
			<form action="http://wiki.lifesciencedb.jp/mw/index.php" id="searchform">
				<input type='hidden' name="title" value="特別:検索"/>
				<input id="searchInput" title="TogoWiki内を検索" accesskey="f" type="search" name="search" />
				<input type='submit' name="go" class="searchButton" id="searchGoButton"	value="表示" title="厳密に一致する名前のページが存在すれば、そのページへ移動します" />&nbsp;
				<input type='submit' name="fulltext" class="searchButton" id="mw-searchButton" value="検索" title="入力された文字列が含まれるページを検索します" />
			</form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>ツールボックス</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="特別%253Aリンク元/SPARQLthon55/togo_rdfstore.html" title="ここにリンクしている全ウィキのページの一覧 [j]" accesskey="j">リンク元</a></li>
				<li id="t-recentchangeslinked"><a href="特別%253A関連ページの更新状況/SPARQLthon55/togo_rdfstore.html" title="このページからリンクしているページの最近の更新 [k]" accesskey="k">関連ページの更新状況</a></li>
<li id="t-specialpages"><a href="http://wiki.lifesciencedb.jp/mw/%E7%89%B9%E5%88%A5:%E7%89%B9%E5%88%A5%E3%83%9A%E3%83%BC%E3%82%B8%E4%B8%80%E8%A6%A7" title="特別ページの一覧 [q]" accesskey="q">特別ページ</a></li>
				<li id="t-print"><a href="http://wiki.lifesciencedb.jp/mw/index.php?title=SPARQLthon55/togo_rdfstore&amp;direction=prev&amp;oldid=22128&amp;printable=yes" rel="alternate" title="このページの印刷用ページ [p]" accesskey="p">印刷用バージョン</a></li>				<li id="t-permalink"><a href="http://wiki.lifesciencedb.jp/mw/index.php?title=SPARQLthon55/togo_rdfstore&amp;oldid=22127" title="ページのこの版への固定リンク">この版への固定リンク</a></li>			</ul>
		</div>
	</div>
</div><!-- end of the left (by default at least) column -->
<div class="visualClear"></div>
<div id="footer">
	<div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="http://wiki.lifesciencedb.jp/mw/skins/common/images/poweredby_mediawiki_88x31.png" height="31" width="88" alt="Powered by MediaWiki" /></a></div>
	<div id="f-copyrightico"><a href="http://creativecommons.org/licenses/by/3.0/"><img src="http://i.creativecommons.org/l/by/3.0/88x31.png" alt="Attribution 3.0 Unported" width="88" height="31" /></a></div>
	<ul id="f-list">
		<li id="copyright">内容は<a href="http://creativecommons.org/licenses/by/3.0/" class="external ">Attribution 3.0 Unported</a>のライセンスで利用することができます。</li>
		<li id="privacy"><a href="http://wiki.lifesciencedb.jp/mw/TogoWiki:%E3%83%97%E3%83%A9%E3%82%A4%E3%83%90%E3%82%B7%E3%83%BC%E3%83%BB%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC" title="TogoWiki:プライバシー・ポリシー">プライバシー・ポリシー</a></li>
		<li id="about"><a href="http://wiki.lifesciencedb.jp/mw/TogoWiki:TogoWiki%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6" title="TogoWiki:TogoWikiについて">TogoWikiについて</a></li>
		<li id="disclaimer"><a href="http://wiki.lifesciencedb.jp/mw/TogoWiki:%E5%85%8D%E8%B2%AC%E4%BA%8B%E9%A0%85" title="TogoWiki:免責事項">免責事項</a></li>
	</ul>
</div>
</div>

<script>if (window.runOnloadHook) runOnloadHook();</script>
<!-- Served in 0.717 secs. --></body></html>
