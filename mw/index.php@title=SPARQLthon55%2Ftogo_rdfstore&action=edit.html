<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="ja" dir="ltr">
<head>
<title>ソースを表示 - TogoWiki</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="MediaWiki 1.16.3" />
<meta name="robots" content="noindex,nofollow" />
<link rel="next" href="SPARQLthon55/togo_rdfstore.html" />
<link rel="shortcut icon" href="http://wiki.lifesciencedb.jp/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="http://wiki.lifesciencedb.jp/mw/opensearch_desc.php" title="TogoWiki (ja)" />
<link rel="copyright" href="http://creativecommons.org/licenses/by/3.0/" />
<link rel="alternate" type="application/atom+xml" title="TogoWikiのAtomフィード" href="http://wiki.lifesciencedb.jp/mw/index.php?title=%E7%89%B9%E5%88%A5:%E6%9C%80%E8%BF%91%E3%81%AE%E6%9B%B4%E6%96%B0&amp;feed=atom" />
<!--[if IE 8]><link rel="stylesheet" href="/mw/skins/common/IE80Fixes.css?270" media="screen" /><![endif]-->
<link rel="stylesheet" href="http://wiki.lifesciencedb.jp/mw/skins/common/shared.css?270" media="screen" />
<link rel="stylesheet" href="http://wiki.lifesciencedb.jp/mw/skins/common/commonPrint.css?270" media="print" />
<link rel="stylesheet" href="http://wiki.lifesciencedb.jp/mw/skins/monobook/main.css?270" media="screen" />
<!--[if lt IE 5.5000]><link rel="stylesheet" href="/mw/skins/monobook/IE50Fixes.css?270" media="screen" /><![endif]-->
<!--[if IE 5.5000]><link rel="stylesheet" href="/mw/skins/monobook/IE55Fixes.css?270" media="screen" /><![endif]-->
<!--[if IE 6]><link rel="stylesheet" href="/mw/skins/monobook/IE60Fixes.css?270" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/mw/skins/monobook/IE70Fixes.css?270" media="screen" /><![endif]-->
<link rel="stylesheet" href="http://wiki.lifesciencedb.jp/mw/index.php?title=MediaWiki:Common.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" />
<link rel="stylesheet" href="http://wiki.lifesciencedb.jp/mw/index.php?title=MediaWiki:Print.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" media="print" />
<link rel="stylesheet" href="http://wiki.lifesciencedb.jp/mw/index.php?title=MediaWiki:Monobook.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" />
<link rel="stylesheet" href="http://wiki.lifesciencedb.jp/mw/index.php?title=-&amp;action=raw&amp;maxage=18000&amp;gen=css" />
<script>
var skin="monobook",
stylepath="/mw/skins",
wgUrlProtocols="http\\:\\/\\/|https\\:\\/\\/|ftp\\:\\/\\/|irc\\:\\/\\/|gopher\\:\\/\\/|telnet\\:\\/\\/|nntp\\:\\/\\/|worldwind\\:\\/\\/|mailto\\:|news\\:|svn\\:\\/\\/",
wgArticlePath="/mw/$1",
wgScriptPath="/mw",
wgScriptExtension=".php",
wgScript="/mw/index.php",
wgVariantArticlePath=false,
wgActionPaths={},
wgServer="http://wiki.lifesciencedb.jp",
wgCanonicalNamespace="",
wgCanonicalSpecialPageName=false,
wgNamespaceNumber=0,
wgPageName="SPARQLthon55/togo_rdfstore",
wgTitle="SPARQLthon55/togo rdfstore",
wgAction="edit",
wgArticleId=806,
wgIsArticle=false,
wgUserName=null,
wgUserGroups=null,
wgUserLanguage="ja",
wgContentLanguage="ja",
wgBreakFrames=true,
wgCurRevisionId=22128,
wgVersion="1.16.3",
wgEnableAPI=true,
wgEnableWriteAPI=true,
wgSeparatorTransformTable=["", ""],
wgDigitTransformTable=["", ""],
wgMainPageTitle="メインページ",
wgFormattedNamespaces={"-2": "メディア", "-1": "特別", "0": "", "1": "ノート", "2": "利用者", "3": "利用者‐会話", "4": "TogoWiki", "5": "TogoWiki‐ノート", "6": "ファイル", "7": "ファイル‐ノート", "8": "MediaWiki", "9": "MediaWiki‐ノート", "10": "Template", "11": "Template‐ノート", "12": "Help", "13": "Help‐ノート", "14": "Category", "15": "Category‐ノート"},
wgNamespaceIds={"メディア": -2, "特別": -1, "": 0, "ノート": 1, "利用者": 2, "利用者‐会話": 3, "togowiki": 4, "togowiki‐ノート": 5, "ファイル": 6, "ファイル‐ノート": 7, "mediawiki": 8, "mediawiki‐ノート": 9, "template": 10, "template‐ノート": 11, "help": 12, "help‐ノート": 13, "category": 14, "category‐ノート": 15, "画像": 6, "画像‐ノート": 7, "image": 6, "image_talk": 7},
wgSiteName="TogoWiki",
wgCategories=[],
wgRestrictionEdit=[],
wgRestrictionMove=[];
</script><script src="http://wiki.lifesciencedb.jp/mw/skins/common/wikibits.js?270"></script>
<script src="http://wiki.lifesciencedb.jp/mw/skins/common/edit.js?270"></script>
<script src="http://wiki.lifesciencedb.jp/mw/skins/common/ajax.js?270"></script>
<script src="http://wiki.lifesciencedb.jp/mw/index.php?title=-&amp;action=raw&amp;gen=js&amp;useskin=monobook&amp;270"></script>

		<style type='text/css'>
		li#pt-openidlogin {
		  background: url(http://wiki.lifesciencedb.jp/mw/extensions/OpenID/skin/icons/openid-inputicon.png) top left no-repeat;
		  padding-left: 20px;
		  text-transform: none;
		}
		</style>
</head>
<body class="mediawiki ltr ns-0 ns-subject page-SPARQLthon55_togo_rdfstore skin-monobook">
<div id="globalWrapper">
<div id="column-content"><div id="content" >
	<a id="top"></a>
	
	<h1 id="firstHeading" class="firstHeading">SPARQLthon55/togo rdfstore</h1>
	<div id="bodyContent">
		<h3 id="siteSub">提供：TogoWiki</h3>
		<div id="contentSub"><a href="SPARQLthon55/togo_rdfstore.html" title="SPARQLthon55/togo rdfstore">SPARQLthon55/togo rdfstore</a>のソース</div>
		<div id="jump-to-nav">移動： <a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;action=edit.html#column-one">案内</a>, <a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;action=edit.html#searchInput">検索</a></div>
		<!-- start content -->
<p>以下に示された理由により、このページの編集を行うことができません：
</p>
<div class="permissions-errors">
<p>この操作は、<a href="http://wiki.lifesciencedb.jp/mw/index.php?title=TogoWiki:%E5%88%A9%E7%94%A8%E8%80%85&amp;action=edit&amp;redlink=1" class="new" title="TogoWiki:利用者（存在しないページ）">利用者</a>のグループに属する利用者のみが実行できます。
</p>
</div>
<p>このページのソースを閲覧し、コピーすることができます：
</p><textarea id="wpTextbox1" name="wpTextbox1" cols="80" rows="25" readonly="">現在のTogoGenomeのRDFストアにはVirtuosoを使用しているが、他のRDFストアへ移行できるかの検討を行った。
AllegroGraphとStar Dogを

== AllegroGraph ==
===togostanza(ruby版)===
====現象====
SPARQL中の"?"がillegal characterとしてエラーになり実行できない。&lt;br/>
&lt;pre>
?query=PREFIX%20taxid:%20%3Chttp:%2F%2Fidentifiers.org%2Ftaxonomy%2F%3E%0APREFIX%20stats:%20%3C
http:%2F%2Ftogogenome.org%2Fstats%2F%3E%0A%0ASELECT%20?genome_size%0AFROM%20%3Chttp:%2F%2Ftogogenome.org%2Fgraph%2Fstats%3E%0A
WHERE%0A%7B%0A%20%20taxid:103690%20stats:sequence_length%20?genome_size%20.%0A%7D%0A"\n contains illegal character #\? at position 173.
&lt;/pre>

====原因====
* togostanzaが内部で呼び出しているrdfモジュール(ruby-rdf)中でURIを一度デコードしていてエンコードしているがその際に"?"のエンコードが漏れる
[https://github.com/ruby-rdf/rdf/blob/develop/lib/rdf/model/uri.rb#L1266-L1274 ソースコード]  URI.encode()ではなくCGI.escape()に
* Virtuosoの場合は"?"が含まれていてもエラーにならないため、AllegroGraph側の問題かもしれない

====対処(暫定)====
ruby-rdfのエンコード処理部分のコードを改修する

====Stanzaコード修正内容====
Allegro graphで動作するために以下のようなSPARQL改修を行った
*Virtuoso独自メソッドの排除
&lt;pre> 削除: DEFINE sql:select-option "order" &lt;/pre>
&lt;pre>
//subClassOf*で階層順序を取得するための独自関数
?search_tax rdfs:subClassOf ?tax OPTION (transitive, t_direction 1, t_min(0), t_step("step_no") as ?step) .
&lt;/pre>
*ASで変数に別名をつける際には括弧で囲む
&lt;pre>
前: SELECT COUNT(DISTINCT ?gold) AS ?cnt
後: SELECT (COUNT(DISTINCT ?gold) AS ?cnt)
&lt;/pre>
GROUP_CONCATの文法は仕様に準拠する
&lt;pre>
前: (GROUP_CONCAT(DISTINCT ?exact_synonym, ", ") AS ?exact_synonyms)
後: (GROUP_CONCAT(DISTINCT ?exact_synonym; SEPARATOR = ", ") AS ?exact_synonyms)
&lt;/pre>
暗黙的GROUP BYは効かないのでGROUP BYを記述する
&lt;pre>
前:
SELECT ?tax_id (COUNT(DISTINCT ?gold) AS ?cnt) {
   (略)
}
後:
SELECT ?type (COUNT(DISTINCT ?gold) AS ?cnt) {
   (略)
} GROUP BY ?tax_id
&lt;/pre>
URIを文字列系関数にかける場合にはSRT()で必ず文字列置換する
&lt;pre>
前: FILTER(regex(?pdo_uri, "PDO"))
後: FILTER(regex(STR(?pdo_uri), "PDO"))
&lt;/pre>
よく分からないがBINDがエラーになるケースがあるので、その場合は(可能なら)SELECT句に記述する
&lt;pre>
前:
SELECT ?type {
   (略)
  BIND ("GOLD" AS ?type ).
}
後: SELECT ("GOLD" AS ?type)  {
   (略)
  //BIND削除
}
&lt;/pre>
* FROMでグラフ名を差すのはVirtuoso独自だと思っていたが、意外と動いている(内容は確認が必要)

====結果と感想====
* SPARQLは仕様に則り正しく書きましょう
* 体感だが実行速度はVirtuosoより遅い。チューニング方法があるかもしれないが、分からない。
** organismやenvironmentのIDを軸にした軽いクエリは動作するがやや重い
** gene系(数十億トリプルのGraphを使用)するとタイムアウトするものが多い。メモリが上限に達したというエラーが出ることもある

===togostanza(js版)===
Ruby版でみられたような"?"で怒られることはなく、クエリを実行できる。速度計測や個々のクエリの検証は未済(Ruby版で検証したので)

===SPARQList===

== Stardog ==

===togostanza(ruby版)===
====Stanzaコード修正内容====
TogoGenomeのスタンザクエリはそのままStardogで動作するものもあったが、いくつかの理由で書き換えが必要になるものもあった。
* Virtuoso独自メソッドの排除 (Allegro graphと同じ)
* FROM句を省略した場合Stardogでは結果がヒットしない
ロードデータは全てNamed graphにロードされ、default graphには何も入っていない状態のためだと思われる(仕様通りの挙動)
&lt;pre>
前:
SELECT *
{
 ?protein a &lt;http://purl.uniprot.org/core/Protein>
} LIMIT 10
=> ノーヒット
後:
SELECT *
FROM &lt;http://togogenome.org/graph/uniprot>
{
 ?protein a &lt;http://purl.uniprot.org/core/Protein>
} LIMIT 10
&lt;/pre>
* GRAPH句を使っている場合Stardogでは結果がヒットしない
Virtuosoでは速度チューニングのためにわざとGRAPH句で囲っている場合がある。ただしグラフを混ぜたくない場合にも使う事があるためその場合の回避方法が不明(ドキュメント読めば分かるかも?)
&lt;pre>
前:
GRAPH &lt;http://togogenome.org/graph/uniprot> {
  ?isoform rdf:value ?protein_seq .
}
後:
 ?isoform rdf:value ?protein_seq .
&lt;/pre>

* OPTIONALのグループグラフ(波カッコ)内で複数パターンを囲む際は遅くなるクエリが遅くなる場合がある
OPTIONAL句内のパターン同士が先にマッピングされているらしいので、外側で?isoformなどの変数が絞り込まれていても反映されず重くなる。&lt;br/>
このようなケースではquery explainコマンドでクエリ実行計画を出力して遅くなる部分を特定する。&lt;br/>
[https://community.stardog.com/t/java-lang-outofmemoryerror-java-heap-space/240/14 相談したページ] [https://docs.stardog.com/man/query-explain.html explainコマンド] [https://docs.stardog.com/#_managing_query_performance 実行計画の見方]
&lt;pre>
前:
OPTIONAL {
  ?annotation up:substitution ?substitution . 
  ?isoform rdf:value ?seq .
}
=> OPTIONAL句内のパターン同士で先にマッピングされるが変数が被っていないので総当たりになり返ってこない
後:
OPTIONAL {
  ?annotation up:substitution ?substitution . 
}
OPTIONAL {
  ?isoform rdf:value ?seq .
}
&lt;/pre>

* UNIONのグループグラフ(波カッコ)内で複数パターンを囲む際は遅くなるクエリが遅くなる場合がある
OPTIONALと同様にグループグラフ内を先に解決するのか、外側のVALUES句で指定した条件でトリプルが絞れるにも関わらず返ってこない
&lt;pre>
前:
{
  VALUES ?gene_id { tg:XXX }
  {
    ?gene_id skos:exactMatch ?gene ;
     ....
  }
  UNION
  {
    ?gene_id skos:exactMatch ?gene ;
     ....
  }
}
後:
{
  {
    VALUES ?gene_id { tg:XXX }
    ?gene_id skos:exactMatch ?gene ;
     ....
  }
  UNION
  {
    VALUES ?gene_id { tg:XXX }
    ?gene_id skos:exactMatch ?gene ;
     ....
  }
}
&lt;/pre>

* VALUES句を使うと遅くなる場合がある
よく分からないがVALUESで絞ろうとすると遅くなる場合がある。必ずしも遅くなるわけでない(explain実行すれば分かるかも)
&lt;pre>
前:
VALUES ?feature_type { insdc:Coding_Sequence }
?feature a ?feature_type ;
後:
?feature a insdc:Coding_Sequence ;
&lt;/pre>
* VALUES句を使わないと遅くなる場合がある
逆にVALUES句を使わないと遅くなるケースもあった。VALUES句を使わないければ遅くて返ってこない(explain実行すれば分かるかも)。
&lt;pre>
前:
?strand_type rdfs:subClassOf faldo:StrandedPosition
後:
VALUES ?strand_postype { faldo:StrandedPosition }
?strand_type rdfs:subClassOf ?strand_postype ;
&lt;/pre>
* SELECT句で文字列変換をすると遅くなる場合がある
SELECT句でReplace関数を使用したら返ってこなかったが、BINDで置換を実行したら速度改善した。他のクエリでは大丈夫な場合もあったので不明。
&lt;pre>
前:
SELECT DISTINCT (REPLACE(STR(?taxonomy),"http://identifiers.org/taxonomy/","") AS ?tax_id)
後:
BIND (REPLACE(STR(?taxonomy),"http://identifiers.org/taxonomy/","") AS ?tax_id)
&lt;/pre>

====結果と感想====
* gene系の大量データを検索する際にもVirtuosoと同じぐらいのスピードで返ってくるようになったクエリもある
* TogoGenomeのページのように同時に重数個のスタンザ表示を行おうとすると、いくつかはタイムアウトで返ってこなくなる(まだ遅いクエリのチューニング、同時接続数を増やす事で可能かも？)
* メモリ消費が130G程になっていたが、現実的なメモリ量でも動作するかは検証が必要
* Virtuosoでのパフォーマンスチューニングは「上から順番に解釈させる」というものだったがStardogは同じ方法は取れない。データ量が多い場合、複数のRDFストア間で共通のSPARQLを使い回す事は難しい

===クエリ例===
====gene_attributes====
&lt;pre>
     PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#>
      PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#>
      PREFIX skos: &lt;http://www.w3.org/2004/02/skos/core#>
      PREFIX obo:    &lt;http://purl.obolibrary.org/obo/>
      PREFIX insdc: &lt;http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX uniprot: &lt;http://purl.uniprot.org/core/>
      PREFIX faldo: &lt;http://biohackathon.org/resource/faldo#>
      SELECT DISTINCT
        ?locus_tag ?gene_type_label ?gene_name
        ?refseq_link ?seq_label ?seq_type_label ?refseq_label ?organism ?tax_link
        ?strand ?insdc_location
      FROM &lt;http://togogenome.org/graph/tgup>
      FROM &lt;http://togogenome.org/graph/uniprot>
      FROM &lt;http://togogenome.org/graph/refseq>
      FROM &lt;http://togogenome.org/graph/so>
      FROM &lt;http://togogenome.org/graph/faldo>
      {
        {
          SELECT ?feature
          {
            {
              &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS0908> skos:exactMatch ?gene ;
                rdfs:seeAlso/rdfs:seeAlso ?uniprot .
              ?uniprot a uniprot:Protein ;
                uniprot:sequence ?isoform .
              ?isoform rdf:value ?protein_seq .
              ?feature obo:so_part_of ?gene ;
                a insdc:Coding_Sequence ;
                insdc:translation ?translation .
              FILTER (?protein_seq = ?translation)
            }
            UNION
            {
              VALUES ?feature_type { insdc:Transfer_RNA insdc:Ribosomal_RNA insdc:Non_Coding_RNA }
              &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS0908>  skos:exactMatch ?gene .
              ?feature obo:so_part_of ?gene ;
                insdc:location ?insdc_location ;
                a ?feature_type .
            }
          } LIMIT 1
        }
        #feature info
        VALUES ?feature_type { obo:SO_0000316 obo:SO_0000252 obo:SO_0000253 obo:SO_0000655 } #CDS,rRNA,tRNA,ncRNA
        VALUES ?strand_postype { faldo:StrandedPosition }
        ?feature rdfs:subClassOf ?feature_type ;
          rdfs:label ?gene_label .
        #sequence / organism info
        ?feature obo:so_part_of* ?seq .
        ?seq rdfs:subClassOf ?seq_type .
        ?refseq_link insdc:sequence ?seq ;
          insdc:definition ?seq_label ;
          insdc:sequence_version ?refseq_label ;
          insdc:sequence_version ?refseq_ver ;
          insdc:organism ?organism .
        ?feature obo:RO_0002162 ?tax_link .
        #location info
        ?feature insdc:location  ?insdc_location ;
          faldo:location  ?faldo .
        ?faldo faldo:begin/rdf:type ?strand_type .
        OPTIONAL { ?feature insdc:gene ?gene_name }
        OPTIONAL { ?feature insdc:locus_tag ?locus_tag }
        ?feature_type rdfs:label ?gene_type_label .
        ?seq_type rdfs:label ?seq_type_label .
        ?strand_type rdfs:subClassOf ?strand_postype ;
        rdfs:label ?strand .
      }
&lt;/pre>

====gene_length_nano====
&lt;pre>
      PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#>
      PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#>
      PREFIX skos: &lt;http://www.w3.org/2004/02/skos/core#>
      PREFIX obo:    &lt;http://purl.obolibrary.org/obo/>
      PREFIX insdc: &lt;http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX uniprot: &lt;http://purl.uniprot.org/core/>

      SELECT ?insdc_location
      FROM &lt;http://togogenome.org/graph/tgup>
      FROM &lt;http://togogenome.org/graph/uniprot>
      FROM &lt;http://togogenome.org/graph/refseq>
      {
        {
          SELECT ?feature
          {
            {
              &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085> skos:exactMatch ?gene ;
                rdfs:seeAlso/rdfs:seeAlso ?uniprot .
              ?uniprot a uniprot:Protein ;
                uniprot:sequence ?isoform .
              ?isoform rdf:value ?protein_seq .
              ?feature obo:so_part_of ?gene ;
                a insdc:Coding_Sequence ;
                insdc:translation ?translation .
              FILTER (?protein_seq = ?translation)
            }
            UNION
            {
              VALUES ?feature_type { insdc:Transfer_RNA insdc:Ribosomal_RNA insdc:Non_Coding_RNA }
              &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085> skos:exactMatch ?gene .
              ?feature obo:so_part_of ?gene ;
                insdc:location ?insdc_location ;
                a ?feature_type .
            }
          } LIMIT 1
        }
        ?feature insdc:location ?insdc_location .
      }
&lt;/pre>

====genome_jbrowse====
&lt;pre>
      PREFIX skos: &lt;http://www.w3.org/2004/02/skos/core#>
      PREFIX obo: &lt;http://purl.obolibrary.org/obo/>

      SELECT DISTINCT ?tax_id
      FROM &lt;http://togogenome.org/graph/tgup>
      FROM &lt;http://togogenome.org/graph/refseq>
      WHERE
      {
        {
          SELECT ?feature_uri
          {
            &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085> skos:exactMatch ?feature_uri .
          } ORDER BY ?feature_uri LIMIT 1
        }
        ?feature_uri  obo:RO_0002162 ?taxonomy
        BIND (REPLACE(STR(?taxonomy),"http://identifiers.org/taxonomy/","") AS ?tax_id)
      }
&lt;/pre>
&lt;pre>
      PREFIX skos: &lt;http://www.w3.org/2004/02/skos/core#>
      PREFIX obo: &lt;http://purl.obolibrary.org/obo/>
      PREFIX insdc: &lt;http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX faldo: &lt;http://biohackathon.org/resource/faldo#>

      SELECT ?seq_label ?start ?end ?seq_length
      FROM &lt;http://togogenome.org/graph/tgup>
      FROM &lt;http://togogenome.org/graph/refseq>
      WHERE
      {
        {
          SELECT ?feature_uri
          {
            &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085> skos:exactMatch ?feature_uri .
          } ORDER BY ?feature_uri LIMIT 1
        }
        ?feature_uri insdc:location  ?insdc_location ;
          faldo:location  ?faldo .
        ?faldo faldo:begin/faldo:position ?start .
        ?faldo faldo:end/faldo:position ?end .

        ?feature_uri obo:so_part_of ?seq .
        ?refseq insdc:sequence ?seq ;
          insdc:sequence_version ?seq_label .
        ?seq insdc:sequence_length ?seq_length
      }
&lt;/pre>
====protein_attributes====
&lt;pre>
      PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#>
      PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#>
      PREFIX skos: &lt;http://www.w3.org/2004/02/skos/core#>
      PREFIX up: &lt;http://purl.uniprot.org/core/>

      SELECT DISTINCT ?sequence ?fragment ?precursor ?existence_label
      FROM &lt;http://togogenome.org/graph/uniprot>
      FROM &lt;http://togogenome.org/graph/tgup>
      WHERE {
        {
          SELECT ?gene
          {
            &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085> skos:exactMatch ?gene .
          } ORDER BY ?gene LIMIT 1
        }
        &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085> skos:exactMatch ?gene ;
          rdfs:seeAlso ?id_upid .
        ?id_upid rdfs:seeAlso ?protein .
        ?protein a up:Protein ;
                 up:sequence ?seq .

        # Sequence
        OPTIONAL {
          ?seq rdf:value ?sequence .
        }

        # Sequence status
        OPTIONAL {
          ?seq up:fragment ?fragment .
        }

        # Sequence processing
        OPTIONAL {
          ?seq up:precursor ?precursor .
        }

        # Protein existence
        OPTIONAL {
          ?protein up:existence ?existence .
          ?existence rdfs:label ?existence_label .
        }
      }
&lt;/pre>
====protein_general_annotation====
&lt;pre>
    PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#>
    PREFIX skos: &lt;http://www.w3.org/2004/02/skos/core#>
    PREFIX up: &lt;http://purl.uniprot.org/core/>

    SELECT DISTINCT ?name ?message
    FROM &lt;http://togogenome.org/graph/uniprot>
    FROM &lt;http://togogenome.org/graph/tgup>
    WHERE {
        {
          SELECT ?gene
          {
            &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085> skos:exactMatch ?gene .
          } LIMIT 1
        }
        &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085> skos:exactMatch ?gene ;
          rdfs:seeAlso ?id_upid .
        ?id_upid rdfs:seeAlso ?protein .
        ?protein a up:Protein ;
                 up:annotation ?annotation .

        {
            # type がup:Annotation のアノテーション

            ?annotation a up:Annotation .

            # name, message の取得
            BIND(STR('Miscellaneous') AS ?name) .
            ?annotation rdfs:comment ?message .
        }UNION{
            # subClassOf Annotation で type が up:Subcellular_Location_Annotation のアノテーション

            ?annotation a up:Subcellular_Location_Annotation .

            # name, message の取得
            ?annotation up:locatedIn ?located_in .
            ?located_in up:cellularComponent ?location .
            ?location up:alias ?message .
            BIND(STR("Subcellular Location") AS ?name) .
        }UNION{
            # type が up:Subcellular_Location_Annotation 以外の subClassOf Annotation のアノテーション
 
            ?annotation a ?type .
            ?type rdfs:subClassOf up:Annotation .
            FILTER (?type != up:Subcellular_Location_Annotation)

            # name, message の取得
            ?type rdfs:label ?name .
            ?annotation rdfs:comment ?message .
        }
    }
&lt;/pre>
====protein_ontologies====
&lt;pre>
      PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#>
      PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#>
      PREFIX up: &lt;http://purl.uniprot.org/core/>
      PREFIX skos: &lt;http://www.w3.org/2004/02/skos/core#>

      SELECT DISTINCT ?root_name ?concept (GROUP_CONCAT(?name; SEPARATOR = ", ") AS ?names)
      FROM &lt;http://togogenome.org/graph/uniprot>
      FROM &lt;http://togogenome.org/graph/tgup>
      WHERE {
        {
          SELECT ?gene
          {
            &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085> skos:exactMatch ?gene .
          } ORDER BY ?gene LIMIT 1
        }
        &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085> skos:exactMatch ?gene ;
          rdfs:seeAlso ?id_upid .
        ?id_upid rdfs:seeAlso ?protein .
        ?protein a up:Protein ;
                 up:classifiedWith ?concept .
        ?concept rdf:type up:Concept .
        FILTER contains(str(?concept), 'keywords') .

        ?concept ?label ?name FILTER (?label = skos:prefLabel || ?label = skos:altLabel).
        ?concept rdfs:subClassOf* ?parents .
        ?parents skos:prefLabel ?root_name .
        FILTER (str(?root_name) IN ('Biological process', 'Cellular component', 'Domain', 'Ligand', 'Molecular function', 'Technical term')) .
      }
      GROUP BY ?root_name ?concept
      ORDER BY ?root_name ?concept ?names
&lt;/pre>
&lt;pre>
      PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#>
      PREFIX skos: &lt;http://www.w3.org/2004/02/skos/core#>
      PREFIX up: &lt;http://purl.uniprot.org/core/>
      PREFIX taxonomy: &lt;http://purl.uniprot.org/taxonomy/>

      SELECT DISTINCT ?name ?root_name ?obo_go_uri
      FROM &lt;http://togogenome.org/graph/uniprot>
      FROM &lt;http://togogenome.org/graph/tgup>
      FROM &lt;http://togogenome.org/graph/go>
      WHERE {
        {
          SELECT ?gene
          {
            &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085> skos:exactMatch ?gene .
          } ORDER BY ?gene LIMIT 1
        }
        &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085> skos:exactMatch ?gene ;
          rdfs:seeAlso ?id_upid .
        ?id_upid rdfs:seeAlso ?protein .
        ?protein a up:Protein ;
                 up:classifiedWith ?obo_go_uri .
        ?obo_go_uri rdfs:label ?name .
        ?obo_go_uri rdfs:subClassOf* ?parents .
        ?parents rdfs:label ?root_name .
        FILTER (str(?root_name) IN ('biological_process', 'cellular_component', 'molecular_function')) .
      }
&lt;/pre>

====protein_sequence_annotation====
&lt;pre>
      PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#>
      PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#>
      PREFIX skos: &lt;http://www.w3.org/2004/02/skos/core#>
      PREFIX up: &lt;http://purl.uniprot.org/core/>
      PREFIX faldo: &lt;http://biohackathon.org/resource/faldo#>

      SELECT DISTINCT ?parent_label ?label ?begin_location ?end_location ?seq_length ?comment (GROUP_CONCAT(?substitution; SEPARATOR = ", ") AS ?substitutions) ?seq_txt ?feature_identifier
      FROM &lt;http://togogenome.org/graph/uniprot>
      FROM &lt;http://togogenome.org/graph/tgup>
      WHERE {
        {
          SELECT ?gene
          {
            &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085> skos:exactMatch ?gene .
          } ORDER BY ?gene LIMIT 1
        }
        &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085> skos:exactMatch ?gene ;
          rdfs:seeAlso ?id_upid .
        ?id_upid rdfs:seeAlso ?protein .
        ?protein a up:Protein ;
                 up:annotation ?annotation .

        ?annotation rdf:type ?type .
        ?type rdfs:label ?label .

        # sequence annotation 直下のtype のラベルを取得(Region, Site, Molecule Processing, Experimental Information)
        ?type rdfs:subClassOf* ?parent_type .
        ?parent_type rdfs:subClassOf up:Sequence_Annotation ;
                     rdfs:label ?parent_label .

        ?annotation up:range ?range .
        OPTIONAL { ?annotation rdfs:comment ?comment . }
        ?range faldo:begin/faldo:position ?begin_location ;
               faldo:end/faldo:position ?end_location .


        # 互いに isoform なUniprotがあるので (e.g. P42166, P42167) 同じIDの isoform で配列のあるものに絞る
        ?protein up:sequence ?isoform .
        BIND( REPLACE( STR(?protein), "http://purl.uniprot.org/uniprot/", "") AS ?up_id)
        FILTER( REGEX(STR(?isoform), ?up_id))
        ?isoform rdf:value ?value .

        # description の一部が取得できるが、内容の表示に必要があるのか
        OPTIONAL {
          ?annotation up:substitution ?substitution . 
        }

        # sequence の長さ取得
        OPTIONAL {
          ?isoform rdf:value ?seq_txt .
          BIND (STRLEN(?seq_txt) AS ?seq_length) .
        }

        OPTIONAL {
          ?annotation rdf:type ?any_type . # Virtuoso 対応
          BIND (STR(?annotation) AS ?feature_identifier) .
          FILTER REGEX(STR(?feature_identifier), "http://purl.uniprot.org/annotation")
        }
      }
      GROUP BY ?parent_label ?label ?begin_location ?end_location ?seq_length ?comment ?seq_txt ?feature_identifier
      ORDER BY ?parent_label ?label ?begin_location ?end_location
&lt;/pre>

====protein_sequence====
&lt;pre>
      PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#>
      PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#>
      PREFIX skos: &lt;http://www.w3.org/2004/02/skos/core#>
      PREFIX up: &lt;http://purl.uniprot.org/core/>

      SELECT DISTINCT ?up_id ?aminoacid ?mass ?modified ?version ?checksum ?fragment ?precursor ?existence_label
      FROM &lt;http://togogenome.org/graph/uniprot>
      FROM &lt;http://togogenome.org/graph/tgup>
      WHERE {
        {
          SELECT ?gene
          {
            &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085> skos:exactMatch ?gene .
          } ORDER BY ?gene LIMIT 1
        }
        &lt;http://togogenome.org/gene/103690:PCC7120DELTA_RS09085> skos:exactMatch ?gene ;
          rdfs:seeAlso ?id_upid .
        ?id_upid rdfs:seeAlso ?protein .
        ?protein a up:Protein ;
                 up:sequence ?isoform .

        # (P42166 &amp; P42167) x (P42166-1 &amp; P42167-1) => P42166 - P42166-1, P42167 - P42167-1
        BIND( REPLACE( STR(?protein), "http://purl.uniprot.org/uniprot/", "") AS ?up_id)
        FILTER( REGEX(STR(?isoform), ?up_id))

        ?isoform rdf:value ?aminoacid ;
                 up:mass ?mass ;
                 up:modified ?modified ;
                 up:version ?version ;
                 up:crc64Checksum ?checksum .

        # Sequence status
        OPTIONAL {
          ?isoform up:fragment ?fragment .
        }

        # Sequence processing
        OPTIONAL {
          ?isoform up:precursor ?precursor .
        }

        # Protein existence
        OPTIONAL {
          ?protein up:existence ?existence .
          ?existence rdfs:label ?existence_label .
        }
      }
&lt;/pre></textarea><div class='templatesUsed'>

</div>
<p id="mw-returnto"><a href="SPARQLthon55/togo_rdfstore.html" title="SPARQLthon55/togo rdfstore">SPARQLthon55/togo rdfstore</a>に戻る。</p>
<div class="printfooter">
「<a href="SPARQLthon55/togo_rdfstore.html">http://wiki.lifesciencedb.jp/mw/SPARQLthon55/togo_rdfstore</a>」より作成</div>
		<div id='catlinks' class='catlinks catlinks-allhidden'></div>		<!-- end content -->
				<div class="visualClear"></div>
	</div>
</div></div>
<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>表示</h5>
		<div class="pBody">
			<ul>
				 <li id="ca-nstab-main" class="selected"><a href="SPARQLthon55/togo_rdfstore.html" title="本文を表示 [c]" accesskey="c">ページ</a></li>
				 <li id="ca-talk" class="new"><a href="http://wiki.lifesciencedb.jp/mw/index.php?title=%E3%83%8E%E3%83%BC%E3%83%88:SPARQLthon55/togo_rdfstore&amp;action=edit&amp;redlink=1" title="記事についての議論 [t]" accesskey="t">議論</a></li>
				 <li id="ca-viewsource" class="selected"><a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;action=edit.html" title="このページは保護されています。&#10;ページのソースを閲覧できます。 [e]" accesskey="e">ソースを表示</a></li>
				 <li id="ca-history"><a href="index.php@title=SPARQLthon55%252Ftogo_rdfstore&amp;action=history.html" title="このページの過去の版 [h]" accesskey="h">履歴</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>個人用ツール</h5>
		<div class="pBody">
			<ul>
				<li id="pt-anonuserpage"><a href="http://wiki.lifesciencedb.jp/mw/%E5%88%A9%E7%94%A8%E8%80%85:172.18.8.51" title="自分が編集しているIPアドレスの利用者ページ [.]" accesskey="." class="new">172.18.8.51</a></li>
				<li id="pt-anontalk"><a href="http://wiki.lifesciencedb.jp/mw/%E5%88%A9%E7%94%A8%E8%80%85%E2%80%90%E4%BC%9A%E8%A9%B1:172.18.8.51" title="このIPアドレスからなされた編集についての議論 [n]" accesskey="n" class="new">このIPアドレスのトーク</a></li>
				<li id="pt-anonlogin"><a href="http://wiki.lifesciencedb.jp/mw/index.php?title=%E7%89%B9%E5%88%A5:%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3&amp;returnto=SPARQLthon55/togo_rdfstore&amp;returntoquery=action%3Dedit" title="ログインすることが推奨されます。ただし、必須ではありません。 [o]" accesskey="o">ログイン</a></li>
				<li id="pt-openidlogin"><a href="index.php@title=特別%253AOpenIDログイン&amp;returnto=SPARQLthon55%252Ftogo_rdfstore.html">OpenIDでログイン</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a style="background-image: url(http://wiki.lifesciencedb.jp/mw/images/togowiki-logo.png);" href="index.html" title="メインページに移動"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
	<div class='generated-sidebar portlet' id='p-navigation'>
		<h5>案内</h5>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage-description"><a href="index.html" title="メインページに移動する [z]" accesskey="z">メインページ</a></li>
				<li id="n-portal"><a href="http://wiki.lifesciencedb.jp/mw/TogoWiki:%E3%82%B3%E3%83%9F%E3%83%A5%E3%83%8B%E3%83%86%E3%82%A3%E3%83%BB%E3%83%9D%E3%83%BC%E3%82%BF%E3%83%AB" title="このプロジェクトについて、できること、情報を入手する場所">コミュニティ・ポータル</a></li>
				<li id="n-currentevents"><a href="http://wiki.lifesciencedb.jp/mw/TogoWiki:%E6%9C%80%E8%BF%91%E3%81%AE%E5%87%BA%E6%9D%A5%E4%BA%8B" title="最近の出来事について予備知識を得る">最近の出来事</a></li>
				<li id="n-recentchanges"><a href="http://wiki.lifesciencedb.jp/mw/%E7%89%B9%E5%88%A5:%E6%9C%80%E8%BF%91%E3%81%AE%E6%9B%B4%E6%96%B0" title="ウィキにおける最近の更新の一覧 [r]" accesskey="r">最近の更新</a></li>
				<li id="n-randompage"><a href="http://wiki.lifesciencedb.jp/mw/%E7%89%B9%E5%88%A5:%E3%81%8A%E3%81%BE%E3%81%8B%E3%81%9B%E8%A1%A8%E7%A4%BA" title="無作為に抽出されたページの読み込み [x]" accesskey="x">おまかせ表示</a></li>
				<li id="n-help"><a href="http://wiki.lifesciencedb.jp/mw/Help:%E7%9B%AE%E6%AC%A1" title="情報を得る場所">ヘルプ</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">検索</label></h5>
		<div id="searchBody" class="pBody">
			<form action="http://wiki.lifesciencedb.jp/mw/index.php" id="searchform">
				<input type='hidden' name="title" value="特別:検索"/>
				<input id="searchInput" title="TogoWiki内を検索" accesskey="f" type="search" name="search" />
				<input type='submit' name="go" class="searchButton" id="searchGoButton"	value="表示" title="厳密に一致する名前のページが存在すれば、そのページへ移動します" />&nbsp;
				<input type='submit' name="fulltext" class="searchButton" id="mw-searchButton" value="検索" title="入力された文字列が含まれるページを検索します" />
			</form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>ツールボックス</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="特別%253Aリンク元/SPARQLthon55/togo_rdfstore.html" title="ここにリンクしている全ウィキのページの一覧 [j]" accesskey="j">リンク元</a></li>
				<li id="t-recentchangeslinked"><a href="特別%253A関連ページの更新状況/SPARQLthon55/togo_rdfstore.html" title="このページからリンクしているページの最近の更新 [k]" accesskey="k">関連ページの更新状況</a></li>
<li id="t-specialpages"><a href="http://wiki.lifesciencedb.jp/mw/%E7%89%B9%E5%88%A5:%E7%89%B9%E5%88%A5%E3%83%9A%E3%83%BC%E3%82%B8%E4%B8%80%E8%A6%A7" title="特別ページの一覧 [q]" accesskey="q">特別ページ</a></li>
			</ul>
		</div>
	</div>
</div><!-- end of the left (by default at least) column -->
<div class="visualClear"></div>
<div id="footer">
	<div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="http://wiki.lifesciencedb.jp/mw/skins/common/images/poweredby_mediawiki_88x31.png" height="31" width="88" alt="Powered by MediaWiki" /></a></div>
	<div id="f-copyrightico"><a href="http://creativecommons.org/licenses/by/3.0/"><img src="http://i.creativecommons.org/l/by/3.0/88x31.png" alt="Attribution 3.0 Unported" width="88" height="31" /></a></div>
	<ul id="f-list">
		<li id="privacy"><a href="http://wiki.lifesciencedb.jp/mw/TogoWiki:%E3%83%97%E3%83%A9%E3%82%A4%E3%83%90%E3%82%B7%E3%83%BC%E3%83%BB%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC" title="TogoWiki:プライバシー・ポリシー">プライバシー・ポリシー</a></li>
		<li id="about"><a href="http://wiki.lifesciencedb.jp/mw/TogoWiki:TogoWiki%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6" title="TogoWiki:TogoWikiについて">TogoWikiについて</a></li>
		<li id="disclaimer"><a href="http://wiki.lifesciencedb.jp/mw/TogoWiki:%E5%85%8D%E8%B2%AC%E4%BA%8B%E9%A0%85" title="TogoWiki:免責事項">免責事項</a></li>
	</ul>
</div>
</div>

<script>if (window.runOnloadHook) runOnloadHook();</script>
<!-- Served in 0.372 secs. --></body></html>
