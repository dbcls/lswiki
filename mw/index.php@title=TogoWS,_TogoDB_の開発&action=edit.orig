<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="ja" dir="ltr">
<head>
<title>ソースを表示 - TogoWiki</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="MediaWiki 1.16.3" />
<meta name="robots" content="noindex,nofollow" />
<link rel="next" href="http://wiki.lifesciencedb.jp/mw/TogoWS,_TogoDB_%E3%81%AE%E9%96%8B%E7%99%BA" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="/mw/opensearch_desc.php" title="TogoWiki (ja)" />
<link rel="copyright" href="http://creativecommons.org/licenses/by/3.0/" />
<link rel="alternate" type="application/atom+xml" title="TogoWikiのAtomフィード" href="/mw/index.php?title=%E7%89%B9%E5%88%A5:%E6%9C%80%E8%BF%91%E3%81%AE%E6%9B%B4%E6%96%B0&amp;feed=atom" />
<!--[if IE 8]><link rel="stylesheet" href="/mw/skins/common/IE80Fixes.css?270" media="screen" /><![endif]-->
<link rel="stylesheet" href="/mw/skins/common/shared.css?270" media="screen" />
<link rel="stylesheet" href="/mw/skins/common/commonPrint.css?270" media="print" />
<link rel="stylesheet" href="/mw/skins/monobook/main.css?270" media="screen" />
<!--[if lt IE 5.5000]><link rel="stylesheet" href="/mw/skins/monobook/IE50Fixes.css?270" media="screen" /><![endif]-->
<!--[if IE 5.5000]><link rel="stylesheet" href="/mw/skins/monobook/IE55Fixes.css?270" media="screen" /><![endif]-->
<!--[if IE 6]><link rel="stylesheet" href="/mw/skins/monobook/IE60Fixes.css?270" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/mw/skins/monobook/IE70Fixes.css?270" media="screen" /><![endif]-->
<link rel="stylesheet" href="/mw/index.php?title=MediaWiki:Common.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" />
<link rel="stylesheet" href="/mw/index.php?title=MediaWiki:Print.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" media="print" />
<link rel="stylesheet" href="/mw/index.php?title=MediaWiki:Monobook.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" />
<link rel="stylesheet" href="/mw/index.php?title=-&amp;action=raw&amp;maxage=18000&amp;gen=css" />
<script>
var skin="monobook",
stylepath="/mw/skins",
wgUrlProtocols="http\\:\\/\\/|https\\:\\/\\/|ftp\\:\\/\\/|irc\\:\\/\\/|gopher\\:\\/\\/|telnet\\:\\/\\/|nntp\\:\\/\\/|worldwind\\:\\/\\/|mailto\\:|news\\:|svn\\:\\/\\/",
wgArticlePath="/mw/$1",
wgScriptPath="/mw",
wgScriptExtension=".php",
wgScript="/mw/index.php",
wgVariantArticlePath=false,
wgActionPaths={},
wgServer="http://wiki.lifesciencedb.jp",
wgCanonicalNamespace="",
wgCanonicalSpecialPageName=false,
wgNamespaceNumber=0,
wgPageName="TogoWS,_TogoDB_の開発",
wgTitle="TogoWS, TogoDB の開発",
wgAction="edit",
wgArticleId=40,
wgIsArticle=false,
wgUserName=null,
wgUserGroups=null,
wgUserLanguage="ja",
wgContentLanguage="ja",
wgBreakFrames=true,
wgCurRevisionId=774,
wgVersion="1.16.3",
wgEnableAPI=true,
wgEnableWriteAPI=true,
wgSeparatorTransformTable=["", ""],
wgDigitTransformTable=["", ""],
wgMainPageTitle="メインページ",
wgFormattedNamespaces={"-2": "メディア", "-1": "特別", "0": "", "1": "ノート", "2": "利用者", "3": "利用者‐会話", "4": "TogoWiki", "5": "TogoWiki‐ノート", "6": "ファイル", "7": "ファイル‐ノート", "8": "MediaWiki", "9": "MediaWiki‐ノート", "10": "Template", "11": "Template‐ノート", "12": "Help", "13": "Help‐ノート", "14": "Category", "15": "Category‐ノート"},
wgNamespaceIds={"メディア": -2, "特別": -1, "": 0, "ノート": 1, "利用者": 2, "利用者‐会話": 3, "togowiki": 4, "togowiki‐ノート": 5, "ファイル": 6, "ファイル‐ノート": 7, "mediawiki": 8, "mediawiki‐ノート": 9, "template": 10, "template‐ノート": 11, "help": 12, "help‐ノート": 13, "category": 14, "category‐ノート": 15, "画像": 6, "画像‐ノート": 7, "image": 6, "image_talk": 7},
wgSiteName="TogoWiki",
wgCategories=[],
wgRestrictionEdit=[],
wgRestrictionMove=[];
</script><script src="/mw/skins/common/wikibits.js?270"></script>
<script src="/mw/skins/common/edit.js?270"></script>
<script src="/mw/skins/common/ajax.js?270"></script>
<script src="/mw/index.php?title=-&amp;action=raw&amp;gen=js&amp;useskin=monobook&amp;270"></script>

		<style type='text/css'>
		li#pt-openidlogin {
		  background: url(/mw/extensions/OpenID/skin/icons/openid-inputicon.png) top left no-repeat;
		  padding-left: 20px;
		  text-transform: none;
		}
		</style>
</head>
<body class="mediawiki ltr ns-0 ns-subject page-TogoWS_TogoDB_の開発 skin-monobook">
<div id="globalWrapper">
<div id="column-content"><div id="content" >
	<a id="top"></a>
	
	<h1 id="firstHeading" class="firstHeading">TogoWS, TogoDB の開発</h1>
	<div id="bodyContent">
		<h3 id="siteSub">提供：TogoWiki</h3>
		<div id="contentSub"><a href="/mw/TogoWS,_TogoDB_%E3%81%AE%E9%96%8B%E7%99%BA" title="TogoWS, TogoDB の開発">TogoWS, TogoDB の開発</a>のソース</div>
		<div id="jump-to-nav">移動： <a href="#column-one">案内</a>, <a href="#searchInput">検索</a></div>
		<!-- start content -->
<p>以下に示された理由により、このページの編集を行うことができません：
</p>
<div class="permissions-errors">
<p>この操作は、<a href="/mw/index.php?title=TogoWiki:%E5%88%A9%E7%94%A8%E8%80%85&amp;action=edit&amp;redlink=1" class="new" title="TogoWiki:利用者（存在しないページ）">利用者</a>のグループに属する利用者のみが実行できます。
</p>
</div>
<p>このページのソースを閲覧し、コピーすることができます：
</p><textarea id="wpTextbox1" name="wpTextbox1" cols="80" rows="25" readonly="">== TogoWS, TogoDB の開発 ==

== TogoWS ==

=== DDBJ, PDBj のキーワード検索 ===

http//togows.dbcls.jp/search で ddbj, pdbj に対応できていないのは、
オリジナルサイトでキーワード検索用の API がどれかよくわかっていなかったから。

==== PDBj のキーワード検索 ====

SQL を POST すると ID が返るサービスがある（金城）ということなので、これを利用する。

たとえば、"alcohol dehydrogenase" というキーワードで検索するには以下のSQLを投げます。

&lt;pre>
 SELECT pdbid FROM brief_summary where plainto_tsquery('alcohol dehydrogenase') @@ tsv
&lt;/pre>

REST API (SQL Search) はこちらを参照：http://www.pdbj.org/doc/help.cgi?PDBj%20Mine%3aREST%20API

WABIも参照のこと：http://wabi.ddbj.nig.ac.jp/CookBook_jp/index.php/キーワードでPDBを検索する

&lt;pre>
endpoint = 'http://service.pdbj.org/mine/sql'
data = "SELECT pdbid FROM brief_summary where plainto_tsquery('alcohol dehydrogenase') @@ tsv"

uri = URI.parse(endpoint)
host = uri.host
path = uri.path

post_data = CGI.escape(data)
result = ''

Net::HTTP.version_1_2
Net::HTTP.start(host) {|http|
  response = http.post(path, "q=#{post_data}&amp;format=plain")
  result = response.body
}

hit_ids = result.split(/\s+/)
hit_ids.shift

p hit_ids
&lt;/pre>

これを抽象化して TogoWS テスト環境に組み込んだ。

http://togows2.dbcls.jp/search/pdbj-pdb/alcohol+dehydrogenase

http://togows2.dbcls.jp/search/pdbj-pdb/alcohol%20dehydrogenase

ちゃんと動いているようなので、近日中に本番環境に移行予定。

==== DDBJ のキーワード検索 ====

該当 API があるかどうか確認する。

テストコードを頂いた。

&lt;pre>
use LWP::UserAgent;
$ua = new LWP::UserAgent;

my $req = new HTTP::Request POST => "http://xml.ddbj.nig.ac.jp/rest/Invoke";
$req->content_type("application/x-www-form-urlencoded");
$queryPath="/ENTRY/DDBJ//='alcohol dehydrogenase'";
$queryPath=~ s/([^\w ])/'%'.unpack('H2', $1)/eg;
$queryPath=~ tr/ /+/;
$returnPath="/ENTRY/DDBJ/primary-accession,/ENTRY/DDBJ/definition";
$returnPath=~ s/([^\w ])/'%'.unpack('H2', $1)/eg;
$returnPath=~ tr/ /+/;
$offset="1";
$count="10";

$req->content("service=ARSA&amp;method=searchByXMLPath&amp;queryPath=$queryPath&amp;returnPath=$returnPath&amp;offset=$offset&amp;count=$count");

my $res = $ua->request($req);
print $res->content;
&lt;/pre>

=== 糖鎖対応 ===

本家 KEGG GLYCAN, AIST JCGGDB に頼むことは難しいため、TogoWS 経由で GLYCAN と JCGGDB の糖鎖検索に [http://glycomics.ccrc.uga.edu/GlycomicsWiki/Informatics:Cross-Database_Search/Protocol_(WGGDS) Informatics: Cross-Database Search (WGGDS) / Protocol] に基づいて対応したい。

要求仕様：WGGDSのクエリは、糖鎖構造 (WGGDS GLYDE-II XML)、組成 (WGGDS XML)、重さ (WGDS XML) で、
それぞれ prefix + /substructure, /composition, /listOperation にポストされる。
結果は ID 一覧 (XML) か GLYDE-II XML の構造。

 XML をポスト --(*1)--> TogoWS --(*2)--> KEGG --(*3)--> TogoWS --(*4) --> ユーザ

(*1): XML が POST されることはこれまで想定外なので /search にマップして良いかどうか要検討、また (*4) で返されるデータも WDGGS の XML フォーマットなので、TogoWS の /search/db/query.format の .format にそぐわない。

(*2): コンバータが必要。使用するメソッドの仕様も確定。WGGDS と完全対応する？

(*3): コンバータが必要。

(*4): フォーマット指定をどうするか。ID のリストはこれまでの TogoWS では ID だけを羅列した text だったが、WGGDSの要求仕様は XML

==== GLYDE-II と KCF の変換 ====

GLYDE-II → KCF は木下コンバータ (Perl スクリプト) を利用。

KCF → GLYDE-II は難しいが、BioMoby には変換サービスがある。
BioMoby を bl02 (togows.dbcls.jp) で動かすにはインストールやメンテのオーバーヘッドが大きくなる。
[http://www.g-language.org/wiki/rest G-language の API] でできないか？

==== BioMoby の調査 ====

G-language は BioMoby を使いやすくはしてくれているが、BioMoby のサービスを REST API にマップしてくれていたりするわけではない？

動かすには BioMoby と G-language の両方をインストールする必要がありそう。
→ BioMoby のクライアントライブラリは荒川さんの BH2008 の成果であるモジュール（名前は？）を使うと比較的容易にインストール可能。

==== KEGG ====

使用する KEGG API は search_glycans_by_composition, search_glycans_by_mass, [http://www.genome.jp/kegg/soap/doc/keggapi_manual_ja.html#label:122 search_glycans_by_kcam] の３つ
（他の関連APIは convert_mol_to_kcf, search_glycans_by_nameなど）。

====  JCGGDB ====

検索フォームが FLASH で作られているため、API があるかどうかを鹿内さんに確認。

* 糖鎖構造検索
説明：糖鎖構造が検索できます。
http://jcggdb.jp/idb/StructureSearch.do?cmd=changeMode&amp;mode=editor&amp;cd=8&amp;seqString=Mana1-6(Mana1-3)Manb1-4GlcNAcb1-4GlcNAc
* 分子量検索
説明：分子量で糖鎖構造が検索できます。
http://jcggdb.jp/idb/jsp/mzSearch.jsp?PEAK_VALUE=800&amp;TOLERANCE=5
* 単糖組成検索
説明：組成で糖鎖構造が検索できます。
http://jcggdb.jp/idb/jsp/GlycanCompositionSearch.jsp?Hex=3&amp;HexNAc=2
* 検索結果詳細ページサンプル
http://jcggdb.jp/idb/jcggdb/JCGG-STR028882

この結果をハンドリングするのも少々大変なので、今後 JCGGDB との連携で改善していくしかなさそう。

==== TogoWS REST API へのマッピング ====

http://togows.dbcls.jp/search/DB に POST することで結果が得られるように拡張する？オプションは？

これまでの TogoWS REST API はキーワード検索によるエントリIDのリストと、エントリの取得、パース、
というスタティックなデータベースリソースへのアクセスに特化しており、
計算が絡んでくるウェブサービスは SOAP の方がふさわしいだろうという提案も Tokyo Manifesto でしていた。

この状況で、今後どのように拡張するか微妙なところであるが、KEGG GLYCAN とも JCGGDB とも中立な
第３者機関として統合DBがプロキシーサービスをする意味はあるし、SOAP でしか使えないのは今後を考えると不便。

そこで、糖鎖だけでなく、ジェネリックなインターフェイスを考えてみる。
BLAST+, DAS, PSIQUIC などへの対応が該当しそう。

1. http://togows.dbcls.jp/search/togodb-配列db/ に POST すると BLAST+ がかかるようにする？
2. 実行には時間がかかるので POST されると ジョブID が返る仕様とする
3. ジョブIDのステータスを確認する API を提供する（そのURLはどうなってるのが良い？）
4. 実行結果にもジョブIDでアクセスする（そのURLはどうなってるのが良い？）
5. 実行結果のフォーマット変換 (BLAST+ の場合、標準、XML、タブなど) や部分抽出 (blast結果/definition/1,10 件) とかにも対応したい（そのURLはどうなってるのが良い？）
6. どのようにして e-value, %id, overlap などでの絞り込みもココに盛り込むか？（そのURLはどうなってるのが良い？ "-e 1e-5 -p 70" みたいなものをURLパス引数に混ぜる？）
7. 外部の BLAST サーバ (NCBI, KEGG など) とのやりとりも↑に対応できるか？

なかなか大変そうである。とりあえず糖鎖のサービスは

http://togows.dbcls.jp/wggds/DB名/substructure
http://togows.dbcls.jp/wggds/DB名/mass

などなど、/search ではなく /wggds ネームスペースに分離して実装していくことにした。

BLAST も

http://togows.dbcls.jp/blast/DB名/
http://togows.dbcls.jp/blast/DB名/jobID
http://togows.dbcls.jp/blast/DB名/jobID/status
http://togows.dbcls.jp/blast/DB名/jobID/result
http://togows.dbcls.jp/blast/DB名/jobID/result.xml
http://togows.dbcls.jp/blast/DB名/jobID/result.tab
http://togows.dbcls.jp/blast/DB名/jobID/result/definition/1,10
http://togows.dbcls.jp/blast/DB名/jobID/result/definition/"-e 1e-5 -p 70 -c 30"/1,20

みたいなインターフェースになるのだろうか。

糖鎖では、返された２つのジョブIDに対応する検索結果（IDのリスト）から共通する結果、共通しない部分などを論理演算的に計算する機能も定義されているらしい。

http://togows.dbcls.jp/filter/論理演算オペレーション/jobID1,jobID2

みたいな感じになるのだろうか。

==== blast_formatter ====

フォーマット変換は BLAST+ から blast_formatter コマンドがバンドルされているので試してみた。

&lt;pre>
% blastp -query b3702.fa -db e.coli.pep -outfmt 11 > b3702.m11
blastp -query b3702.fa -db e.coli.pep -outfmt 11 > b3702.m11  0.25s user 0.01s system 94% cpu 0.287 total

% time blast_formatter -archive b3702.m11 -outfmt 0
 :
blast_formatter -archive b3702.m11 -outfmt 0  0.30s user 0.13s system 1% cpu 28.412 total
&lt;/pre>

激遅い。。リフォーマットしている間に何度でも再計算できてしまう。。たのむぜ NCBI

=== NCBI, EBI, DDBJ, PDBj のサービス全対応を確認 ===

==== エントリ取得 ====

http://togows.dbcls.jp/entry/ の対応データベース

 ncbi-nuccore	nuccore
 ncbi-nucest	nucest
 ncbi-nucgss	nucgss
 ncbi-nucleotide	nucleotide
 ncbi-protein	protein
 ncbi-gene	gene
 ncbi-omim	omim
 ncbi-homologene	homologene
 ncbi-snp	snp
 ncbi-mesh	mesh
 ncbi-pubmed	pubmed
 ebi-embl	embl
 ebi-uniprot	uniprot
 ebi-uniparc	uniparc
 ebi-uniref100	uniref100
 ebi-uniref90	uniref90
 ebi-uniref50	uniref50
 ddbj-ddbj	ddbj
 ddbj-dad	dad
 pdbj-pdb	pdb
 kegg-compound	compound
 kegg-drug	drug
 kegg-enzyme	enzyme
 kegg-genes	genes
 kegg-glycan	glycan
 kegg-orthology	orthology
 kegg-reaction	reaction
 kegg-module	module
 kegg-pathway	pathway

こらについて、http://togows.dbcls.jp/site/en/rest.html に

* 実例があるかどうか
* 各データベースでフィールド対応がどれくらいできているか

を調査し、不十分な部分はコーディングし、rest.html に追記する。

また、rest.html が長くなりすぎているのでプロバイダ毎にページを分けて整理する。

==== 調査結果 ====

http://www.ncbi.nlm.nih.gov/gene/338
http://togows.dbcls.jp/entry/ncbi-gene/338?
http://togows.dbcls.jp/entry/ncbi-gene/338/additional_links
http://togows.dbcls.jp/entry/ncbi-gene/338/annotation
http://togows.dbcls.jp/entry/ncbi-gene/338/chromosome
http://togows.dbcls.jp/entry/ncbi-gene/338/gene_type
http://togows.dbcls.jp/entry/ncbi-gene/338/lineage
http://togows.dbcls.jp/entry/ncbi-gene/338/location
http://togows.dbcls.jp/entry/ncbi-gene/338/official_full_name
http://togows.dbcls.jp/entry/ncbi-gene/338/official_symbol
http://togows.dbcls.jp/entry/ncbi-gene/338/organism
http://togows.dbcls.jp/entry/ncbi-gene/338/other_aliases
http://togows.dbcls.jp/entry/ncbi-gene/338/other_designations
http://togows.dbcls.jp/entry/ncbi-gene/338/pathways
http://togows.dbcls.jp/entry/ncbi-gene/338/primary_source
http://togows.dbcls.jp/entry/ncbi-gene/338/refseq_status
http://togows.dbcls.jp/entry/ncbi-gene/338/summary
(略)
http://togows.dbcls.jp/entry/omim/125851
(略)
http://www.nlm.nih.gov/cgi/mesh/2010/MB_cgi
http://togows.dbcls.jp/entry/ncbi-mesh/D020790
http://togows.dbcls.jp/entry/ncbi-mesh/D020790/allowable_qualifiers
http://togows.dbcls.jp/entry/ncbi-mesh/D020790/annotation
http://togows.dbcls.jp/entry/ncbi-mesh/D020790/entry_terms
http://togows.dbcls.jp/entry/ncbi-mesh/D020790/heading
http://togows.dbcls.jp/entry/ncbi-mesh/D020790/scope_note
http://togows.dbcls.jp/entry/ncbi-mesh/D020790/tree_numbers
(略)
http://www.ncbi.nlm.nih.gov/projects/SNP/snp_ref.cgi?rs=51804507
http://togows.dbcls.jp/entry/snp/rs51804507
http://togows.dbcls.jp/entry/snp/rs51804507/organism
http://togows.dbcls.jp/entry/snp/rs51804507/ref_allele
(略)
http://togows.dbcls.jp/entry/homologene/40795
(略)
http://www.ncbi.nlm.nih.gov/nuccore/AK143675.1
http://togows.dbcls.jp/entry/nuccore/AK143675.1
(略)
http://www.ncbi.nlm.nih.gov/nucest/BY999645.1
http://togows.dbcls.jp/entry/nucest/BY999645.1
(略)
http://www.ncbi.nlm.nih.gov/nucgss/AF416125.1
http://togows.dbcls.jp/entry/nucgss/AF416125.1
(略)
http://www.ncbi.nlm.nih.gov/genome/sts/sts.cgi?uid=47999
http://togows.dbcls.jp/entry/unists/47999

* さーち

http://togows.dbcls.jp/search/ncbi-pubmed/cerebral+infarction+treatment
http://togows.dbcls.jp/search/ncbi-books/

==== エントリ検索 ====

http://togows.dbcls.jp/search/ の対応データベース

 ncbi-pubmed	pubmed
 ncbi-books
 ncbi-cancerchromosomes
 ncbi-cdd
 ncbi-domains
 ncbi-gap
 ncbi-gds
 ncbi-gene	gene
 ncbi-genome
 ncbi-genomeprj
 ncbi-gensat
 ncbi-geo
 ncbi-homologene	homologene
 ncbi-journals
 ncbi-mesh	mesh
 ncbi-ncbisearch
 ncbi-nlmcatalog
 ncbi-nuccore	nuccore
 ncbi-nucest	nucest
 ncbi-nucgss	nucgss
 ncbi-nucleotide	nucleotide
 ncbi-omia
 ncbi-omim	omim
 ncbi-pcassay
 ncbi-pccompound
 ncbi-pcsubstance
 ncbi-pmc
 ncbi-popset
 ncbi-probe
 ncbi-protein	protein
 ncbi-proteinclusters
 ncbi-snp	snp
 ncbi-structure
 ncbi-taxonomy
 ncbi-toolkit
 ncbi-unigene
 ncbi-unists
 ebi-embl	embl
 ebi-uniprot	uniprot
 ebi-2can
 ebi-arrayexpress-experiments
 ebi-arrayexpress-genes
 ebi-arrayexpress-repository
 ebi-astd
 ebi-biomodels
 ebi-chebi
 ebi-ebiweb_staff
 ebi-emblcds
 ebi-embldeleted
 ebi-emblnew_ann_con
 ebi-emblnew_con
 ebi-emblnew_standard
 ebi-emblnew_wgs
 ebi-emblrelease_ann_con
 ebi-emblrelease_con
 ebi-emblrelease_standard
 ebi-emblrelease_wgs
 ebi-ensembl
 ebi-go
 ebi-groups
 ebi-intact-experiments
 ebi-intact-interactions
 ebi-intact-interactors
 ebi-integr8
 ebi-intenz
 ebi-interpro
 ebi-mainweb
 ebi-medline
 ebi-msdchem
 ebi-msdpdb
 ebi-patentdb
 ebi-pride
 ebi-reactome
 ebi-resid
 ebi-sbo
 ebi-taxonomy
 ebi-uniparc	uniparc
 ebi-uniref100	uniref100
 ebi-uniref50	uniref50
 ebi-uniref90	uniref90
 kegg-compound	compound
 kegg-drug	drug
 kegg-enzyme	enzyme
 kegg-genes	genes
 kegg-glycan	glycan
 kegg-orthology	orthology
 kegg-reaction	reaction
 kegg-module	module
 kegg-pathway	pathway

これらについて、例を http://togows.dbcls.jp/site/en/rest.html に掲載する。

DDBJ, PDBj については search 対応してから例を載せる。

==== ステータス確認 ====

http://togows.dbcls.jp/status で監視している DDBJ, PDBj, KEGG の SOAP サービスに加え、
上記の entry/search サービスが正常に稼働しているかどうかを確認する仕組みを作る。

たとえば http://togows.dbcls.jp/entry/ncbi-gene/338 は現時点で

 1: id: 339 Error occurred: NCBI C++ Exception:
     Error:        HTML(CHTMLException::eTableCellUse)
 "/pubmed_gen/rbuild/version/20100915/entrez/c++/src/html/html.cpp", line 1272:
 ncbi::CHTML_table_Cache::GetCellNode() --- invalid use of big table cell

のようなエラーが NCBI 側で発生し、そのまま表示されていたが、現状ではこれに気付けない。

=== JSONの確認 ===

現在 TogoWS では Ruby の to_json で出来たオブジェクトを JSON フォーマットとして返しているが、
クオートやエスケープを含め valid でない場合がある可能性が指摘された（西田 -- 具体例希望）ので確認する。

== TogoDB ==

* TogoDB では

ユーザは表計算ソフトなどで整形したCSV形式のデータをアップロードする。
サーバは自動的にデータを解析しRDBのスキーマを生成する。
ユーザはスキーマのデータ型を確認し、インポートする。
完了すると、ユーザはそのデータベースを確認し、問題なければ公開することができる。
各カラムのラベルやリンク情報を調整したり、検索用インデックスの作成、
HTMLやCSSを使ったデータベースの表示方法のカスタマイズ、
特定のユーザとの共有などをカスタマイズすることができる。

* TogoDB のウリを再考し来月をメドにまとめる

インポートされたデータベースはウェブ画面から一覧が表示され、検索しなくてもデータベースの中身をすぐに把握することが出来る。
自分のデータベースはウェブ上から編集することができる。
検索はキーワード検索や複合検索による数値や正規表現などによるフィルタリングが可能。
QuickLook 機能を使うと、エントリをクリックすることなくカーソルキーだけで次々と閲覧することが出来る。
絞り込み検索した結果が数百件あったばあいでも容易にブラウズすることが可能である。
全データもしくは絞り込み検索結果に該当するエントリをダウンロードすることも容易でローカルな表計算ソフトに取り込んで利用することができる。
ダウンロードしたデータを整形したり新しいデータを加え、再びアップロードすることで新しいデータベースを作ることができる。
各セルの値を利用してTogoDBの他のデータベースや外部のデータベースにリンクすることができるため、Linked Data を作り易い。

ウェブ上のスプレッドシートアプリと異なるのは、各行がレコードとしてデータベース化され固有の ID を持つことである。

TogoDB は DBCLS のウェブサイトからフリーで利用出来る。
また、TogoDBのソースコードはRuby on Rails のプラグインとして作られたオープンソースソフトウェアなので、
ユーザが自前のサーバを立てることも可能。

=== エンベッド機能の完成とリリース ===

JSONP/Flexigrid による外部サイトへの TogoDB テーブルの提供

==== デザイン面の見直し ====

インポート手順、データベース管理、メタデータ、データ表示各部分について HTML/CSS を完全にやりなおす。QuickLook と Show も同一 partial を使う。

==== リリース機能の提供 ====

CSV, JSON, RDF, FASTA での定期ダンプ機能、動的ダンプとキューイング、などを完成。

==== メタデータ管理 ====

データベース全体に関わる著作権者やライセンスなどの情報をデータベースのメタデータとして入力することができるようにしたい
（受け入れDBで使っているそれ以外のメタデータ管理とは分離したい）。

* データベース名 - dbname
* 作成者 / 作成機関 - creator
* 連絡先（メール、電話、住所、担当者名） - email, phone, address, name
* 概要 - description
* ライセンス（選択項目からCCが確定するUIに改善）- license
* 参考文献 - references
* カテゴリ（データタイプ）- category
* エントリ数？

データベースの各カラムには以下のようなメタデータをつけることができるようにしたい。

* name (schema 上のカラム名)
* type (schema 上の型名)
* label (表示上のカラム名)
* entry_id (ラジオ - このカラムの値をエントリIDとして利用。record name のこと)
* primary_key (ラジオ - このカラムの値を primary key として利用)
* search (フラグ - このカラムの値を標準検索で利用）
* advanced_search (フラグ - このカラムの値を複合検索で利用）

* xref (他のデータベースへのリンク、他テーブルへのリンク - join機能を移行)
* sanitize (フラグ - このカラムの値をエスケープしない)
* prefix (このカラムの値につける prefix &lt;a href=""> など)
* suffix (このカラムの値につける suffix &lt;/a> など)

* list_order (リスト表示のデフォルト表示順)
* show_order (show表示のデフォルト表示順)
* dump_order (ダウンロード用ファイルのデフォルト表示順)</textarea><div class='templatesUsed'>

</div>
<p id="mw-returnto"><a href="/mw/TogoWS,_TogoDB_%E3%81%AE%E9%96%8B%E7%99%BA" title="TogoWS, TogoDB の開発">TogoWS, TogoDB の開発</a>に戻る。</p>
<div class="printfooter">
「<a href="http://wiki.lifesciencedb.jp/mw/TogoWS,_TogoDB_%E3%81%AE%E9%96%8B%E7%99%BA">http://wiki.lifesciencedb.jp/mw/TogoWS,_TogoDB_%E3%81%AE%E9%96%8B%E7%99%BA</a>」より作成</div>
		<div id='catlinks' class='catlinks catlinks-allhidden'></div>		<!-- end content -->
				<div class="visualClear"></div>
	</div>
</div></div>
<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>表示</h5>
		<div class="pBody">
			<ul>
				 <li id="ca-nstab-main" class="selected"><a href="/mw/TogoWS,_TogoDB_%E3%81%AE%E9%96%8B%E7%99%BA" title="本文を表示 [c]" accesskey="c">ページ</a></li>
				 <li id="ca-talk" class="new"><a href="/mw/index.php?title=%E3%83%8E%E3%83%BC%E3%83%88:TogoWS,_TogoDB_%E3%81%AE%E9%96%8B%E7%99%BA&amp;action=edit&amp;redlink=1" title="記事についての議論 [t]" accesskey="t">議論</a></li>
				 <li id="ca-viewsource" class="selected"><a href="/mw/index.php?title=TogoWS,_TogoDB_%E3%81%AE%E9%96%8B%E7%99%BA&amp;action=edit" title="このページは保護されています。&#10;ページのソースを閲覧できます。 [e]" accesskey="e">ソースを表示</a></li>
				 <li id="ca-history"><a href="/mw/index.php?title=TogoWS,_TogoDB_%E3%81%AE%E9%96%8B%E7%99%BA&amp;action=history" title="このページの過去の版 [h]" accesskey="h">履歴</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>個人用ツール</h5>
		<div class="pBody">
			<ul>
				<li id="pt-anonuserpage"><a href="/mw/%E5%88%A9%E7%94%A8%E8%80%85:172.18.8.51" title="自分が編集しているIPアドレスの利用者ページ [.]" accesskey="." class="new">172.18.8.51</a></li>
				<li id="pt-anontalk"><a href="/mw/%E5%88%A9%E7%94%A8%E8%80%85%E2%80%90%E4%BC%9A%E8%A9%B1:172.18.8.51" title="このIPアドレスからなされた編集についての議論 [n]" accesskey="n" class="new">このIPアドレスのトーク</a></li>
				<li id="pt-anonlogin"><a href="/mw/index.php?title=%E7%89%B9%E5%88%A5:%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3&amp;returnto=TogoWS,_TogoDB_%E3%81%AE%E9%96%8B%E7%99%BA&amp;returntoquery=action%3Dedit" title="ログインすることが推奨されます。ただし、必須ではありません。 [o]" accesskey="o">ログイン</a></li>
				<li id="pt-openidlogin"><a href="/mw/index.php?title=%E7%89%B9%E5%88%A5:OpenID%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3&amp;returnto=TogoWS,_TogoDB_%E3%81%AE%E9%96%8B%E7%99%BA">OpenIDでログイン</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a style="background-image: url(/mw/images/togowiki-logo.png);" href="/mw/%E3%83%A1%E3%82%A4%E3%83%B3%E3%83%9A%E3%83%BC%E3%82%B8" title="メインページに移動"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
	<div class='generated-sidebar portlet' id='p-navigation'>
		<h5>案内</h5>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage-description"><a href="/mw/%E3%83%A1%E3%82%A4%E3%83%B3%E3%83%9A%E3%83%BC%E3%82%B8" title="メインページに移動する [z]" accesskey="z">メインページ</a></li>
				<li id="n-portal"><a href="/mw/TogoWiki:%E3%82%B3%E3%83%9F%E3%83%A5%E3%83%8B%E3%83%86%E3%82%A3%E3%83%BB%E3%83%9D%E3%83%BC%E3%82%BF%E3%83%AB" title="このプロジェクトについて、できること、情報を入手する場所">コミュニティ・ポータル</a></li>
				<li id="n-currentevents"><a href="/mw/TogoWiki:%E6%9C%80%E8%BF%91%E3%81%AE%E5%87%BA%E6%9D%A5%E4%BA%8B" title="最近の出来事について予備知識を得る">最近の出来事</a></li>
				<li id="n-recentchanges"><a href="/mw/%E7%89%B9%E5%88%A5:%E6%9C%80%E8%BF%91%E3%81%AE%E6%9B%B4%E6%96%B0" title="ウィキにおける最近の更新の一覧 [r]" accesskey="r">最近の更新</a></li>
				<li id="n-randompage"><a href="/mw/%E7%89%B9%E5%88%A5:%E3%81%8A%E3%81%BE%E3%81%8B%E3%81%9B%E8%A1%A8%E7%A4%BA" title="無作為に抽出されたページの読み込み [x]" accesskey="x">おまかせ表示</a></li>
				<li id="n-help"><a href="/mw/Help:%E7%9B%AE%E6%AC%A1" title="情報を得る場所">ヘルプ</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">検索</label></h5>
		<div id="searchBody" class="pBody">
			<form action="/mw/index.php" id="searchform">
				<input type='hidden' name="title" value="特別:検索"/>
				<input id="searchInput" title="TogoWiki内を検索" accesskey="f" type="search" name="search" />
				<input type='submit' name="go" class="searchButton" id="searchGoButton"	value="表示" title="厳密に一致する名前のページが存在すれば、そのページへ移動します" />&nbsp;
				<input type='submit' name="fulltext" class="searchButton" id="mw-searchButton" value="検索" title="入力された文字列が含まれるページを検索します" />
			</form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>ツールボックス</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="/mw/%E7%89%B9%E5%88%A5:%E3%83%AA%E3%83%B3%E3%82%AF%E5%85%83/TogoWS,_TogoDB_%E3%81%AE%E9%96%8B%E7%99%BA" title="ここにリンクしている全ウィキのページの一覧 [j]" accesskey="j">リンク元</a></li>
				<li id="t-recentchangeslinked"><a href="/mw/%E7%89%B9%E5%88%A5:%E9%96%A2%E9%80%A3%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%AE%E6%9B%B4%E6%96%B0%E7%8A%B6%E6%B3%81/TogoWS,_TogoDB_%E3%81%AE%E9%96%8B%E7%99%BA" title="このページからリンクしているページの最近の更新 [k]" accesskey="k">関連ページの更新状況</a></li>
<li id="t-specialpages"><a href="/mw/%E7%89%B9%E5%88%A5:%E7%89%B9%E5%88%A5%E3%83%9A%E3%83%BC%E3%82%B8%E4%B8%80%E8%A6%A7" title="特別ページの一覧 [q]" accesskey="q">特別ページ</a></li>
			</ul>
		</div>
	</div>
</div><!-- end of the left (by default at least) column -->
<div class="visualClear"></div>
<div id="footer">
	<div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="/mw/skins/common/images/poweredby_mediawiki_88x31.png" height="31" width="88" alt="Powered by MediaWiki" /></a></div>
	<div id="f-copyrightico"><a href="http://creativecommons.org/licenses/by/3.0/"><img src="http://i.creativecommons.org/l/by/3.0/88x31.png" alt="Attribution 3.0 Unported" width="88" height="31" /></a></div>
	<ul id="f-list">
		<li id="privacy"><a href="/mw/TogoWiki:%E3%83%97%E3%83%A9%E3%82%A4%E3%83%90%E3%82%B7%E3%83%BC%E3%83%BB%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC" title="TogoWiki:プライバシー・ポリシー">プライバシー・ポリシー</a></li>
		<li id="about"><a href="/mw/TogoWiki:TogoWiki%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6" title="TogoWiki:TogoWikiについて">TogoWikiについて</a></li>
		<li id="disclaimer"><a href="/mw/TogoWiki:%E5%85%8D%E8%B2%AC%E4%BA%8B%E9%A0%85" title="TogoWiki:免責事項">免責事項</a></li>
	</ul>
</div>
</div>

<script>if (window.runOnloadHook) runOnloadHook();</script>
<!-- Served in 0.358 secs. --></body></html>
