<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="ja" dir="ltr">
<head>
<title>ソースを表示 - TogoWiki</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="MediaWiki 1.16.3" />
<meta name="robots" content="noindex,nofollow" />
<link rel="next" href="http://wiki.lifesciencedb.jp/mw/SPARQLthon26/TogoGenome" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="/mw/opensearch_desc.php" title="TogoWiki (ja)" />
<link rel="copyright" href="http://creativecommons.org/licenses/by/3.0/" />
<link rel="alternate" type="application/atom+xml" title="TogoWikiのAtomフィード" href="/mw/index.php?title=%E7%89%B9%E5%88%A5:%E6%9C%80%E8%BF%91%E3%81%AE%E6%9B%B4%E6%96%B0&amp;feed=atom" />
<!--[if IE 8]><link rel="stylesheet" href="/mw/skins/common/IE80Fixes.css?270" media="screen" /><![endif]-->
<link rel="stylesheet" href="/mw/skins/common/shared.css?270" media="screen" />
<link rel="stylesheet" href="/mw/skins/common/commonPrint.css?270" media="print" />
<link rel="stylesheet" href="/mw/skins/monobook/main.css?270" media="screen" />
<!--[if lt IE 5.5000]><link rel="stylesheet" href="/mw/skins/monobook/IE50Fixes.css?270" media="screen" /><![endif]-->
<!--[if IE 5.5000]><link rel="stylesheet" href="/mw/skins/monobook/IE55Fixes.css?270" media="screen" /><![endif]-->
<!--[if IE 6]><link rel="stylesheet" href="/mw/skins/monobook/IE60Fixes.css?270" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/mw/skins/monobook/IE70Fixes.css?270" media="screen" /><![endif]-->
<link rel="stylesheet" href="/mw/index.php?title=MediaWiki:Common.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" />
<link rel="stylesheet" href="/mw/index.php?title=MediaWiki:Print.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" media="print" />
<link rel="stylesheet" href="/mw/index.php?title=MediaWiki:Monobook.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" />
<link rel="stylesheet" href="/mw/index.php?title=-&amp;action=raw&amp;maxage=18000&amp;gen=css" />
<script>
var skin="monobook",
stylepath="/mw/skins",
wgUrlProtocols="http\\:\\/\\/|https\\:\\/\\/|ftp\\:\\/\\/|irc\\:\\/\\/|gopher\\:\\/\\/|telnet\\:\\/\\/|nntp\\:\\/\\/|worldwind\\:\\/\\/|mailto\\:|news\\:|svn\\:\\/\\/",
wgArticlePath="/mw/$1",
wgScriptPath="/mw",
wgScriptExtension=".php",
wgScript="/mw/index.php",
wgVariantArticlePath=false,
wgActionPaths={},
wgServer="http://wiki.lifesciencedb.jp",
wgCanonicalNamespace="",
wgCanonicalSpecialPageName=false,
wgNamespaceNumber=0,
wgPageName="SPARQLthon26/TogoGenome",
wgTitle="SPARQLthon26/TogoGenome",
wgAction="edit",
wgArticleId=512,
wgIsArticle=false,
wgUserName=null,
wgUserGroups=null,
wgUserLanguage="ja",
wgContentLanguage="ja",
wgBreakFrames=true,
wgCurRevisionId=14877,
wgVersion="1.16.3",
wgEnableAPI=true,
wgEnableWriteAPI=true,
wgSeparatorTransformTable=["", ""],
wgDigitTransformTable=["", ""],
wgMainPageTitle="メインページ",
wgFormattedNamespaces={"-2": "メディア", "-1": "特別", "0": "", "1": "ノート", "2": "利用者", "3": "利用者‐会話", "4": "TogoWiki", "5": "TogoWiki‐ノート", "6": "ファイル", "7": "ファイル‐ノート", "8": "MediaWiki", "9": "MediaWiki‐ノート", "10": "Template", "11": "Template‐ノート", "12": "Help", "13": "Help‐ノート", "14": "Category", "15": "Category‐ノート"},
wgNamespaceIds={"メディア": -2, "特別": -1, "": 0, "ノート": 1, "利用者": 2, "利用者‐会話": 3, "togowiki": 4, "togowiki‐ノート": 5, "ファイル": 6, "ファイル‐ノート": 7, "mediawiki": 8, "mediawiki‐ノート": 9, "template": 10, "template‐ノート": 11, "help": 12, "help‐ノート": 13, "category": 14, "category‐ノート": 15, "画像": 6, "画像‐ノート": 7, "image": 6, "image_talk": 7},
wgSiteName="TogoWiki",
wgCategories=[],
wgRestrictionEdit=[],
wgRestrictionMove=[];
</script><script src="/mw/skins/common/wikibits.js?270"></script>
<script src="/mw/skins/common/edit.js?270"></script>
<script src="/mw/skins/common/ajax.js?270"></script>
<script src="/mw/index.php?title=-&amp;action=raw&amp;gen=js&amp;useskin=monobook&amp;270"></script>

		<style type='text/css'>
		li#pt-openidlogin {
		  background: url(/mw/extensions/OpenID/skin/icons/openid-inputicon.png) top left no-repeat;
		  padding-left: 20px;
		  text-transform: none;
		}
		</style>
</head>
<body class="mediawiki ltr ns-0 ns-subject page-SPARQLthon26_TogoGenome skin-monobook">
<div id="globalWrapper">
<div id="column-content"><div id="content" >
	<a id="top"></a>
	
	<h1 id="firstHeading" class="firstHeading">SPARQLthon26/TogoGenome</h1>
	<div id="bodyContent">
		<h3 id="siteSub">提供：TogoWiki</h3>
		<div id="contentSub"><a href="/mw/SPARQLthon26/TogoGenome" title="SPARQLthon26/TogoGenome">SPARQLthon26/TogoGenome</a>のソース</div>
		<div id="jump-to-nav">移動： <a href="#column-one">案内</a>, <a href="#searchInput">検索</a></div>
		<!-- start content -->
<p>以下に示された理由により、このページの編集を行うことができません：
</p>
<div class="permissions-errors">
<p>この操作は、<a href="/mw/index.php?title=TogoWiki:%E5%88%A9%E7%94%A8%E8%80%85&amp;action=edit&amp;redlink=1" class="new" title="TogoWiki:利用者（存在しないページ）">利用者</a>のグループに属する利用者のみが実行できます。
</p>
</div>
<p>このページのソースを閲覧し、コピーすることができます：
</p><textarea id="wpTextbox1" name="wpTextbox1" cols="80" rows="25" readonly="">=ゲノム RDF 真核対応=
==RDF取得フロー==

===1.NCBIからASSEMBLYのレポートを取得する===
*ftp://ftp.hgc.jp/pub/mirror/ncbi/genomes/GENOME_REPORTS
*ftp://ftp.hgc.jp/pub/mirror/ncbi/genomes/ASSEMBLY_REPORTS

「GENOME_REPORTS/eukaryotes.txt」ではBioProjectIDが対応していないため、「ASSEMBLY_REPORTS/assembly_summary_refseq.txt」を使用する。&lt;br/>
既存の「prokaryotes.txt」は使用せずに、「assembly_summary_refseq.txt」から原核真核含め全生物種を取得する。&lt;br/>&lt;br/>
[http://ep.dbcls.jp/rdf/togogenome/genomes/20141103/ ダウンロード済みファイル]

===2.ASSEMBLY_REPORTの情報をRDFに変換してインポートする===
*変換スクリプト：http://ep.dbcls.jp/rdf/togogenome/bin/assembly_report2ttl.rb
*インポートグラフ名：&lt;http://togogenome.org/graph/assembly_report>
&lt;br/>
[http://ep.dbcls.jp/rdf/togogenome/genomes/20141103/ASSEMBLY_REPORTS/ 変換済みRDF]

* [[SPARQLthon22/AssemblyReports]] で開発（藤澤）

===3.ロード対象のTaxID及びBioProjectID及びRefSeqID(nucleotide)を選択する===
「assembly_summary_refseq.txt」には過去の履歴やクオリティの低いデータも含まれているため、ロード対象のTaxID及びその代表的GenomeのBioProjectIDを&lt;strike>一意に&lt;/strike>選定し、GenBankファイルを取得するためにRefSeqIDを取得する。&lt;br>
選定の基準は次の通り
====選定基準1. assembly_levelに"Chromosome"が含まれているAssembly====
&lt;pre>
PREFIX asm: &lt;http://www.ncbi.nlm.nih.gov/assembly/>
SELECT ?level (COUNT(?assembly) AS ?count)
{
 ?assembly asm:assembly_level ?level .
} GROUP BY ?level ORDER BY DESC (?count)
&lt;/pre>
結果：
&lt;pre>
"Contig" : 12199
"Scaffold" : 10413
"Gapless Chromosome" : 2742
"Chromosome"	: 530
"Chromosome with gaps" : 184
&lt;/pre>
====選定基準2. version_statusで最新フラグがついたAssembly====
&lt;pre>
asm:version_status "latest"
&lt;/pre>
ロード対象となるTaxIDは3182件。
&lt;pre>
PREFIX asm: &lt;http://www.ncbi.nlm.nih.gov/assembly/>
SELECT (COUNT(DISTINCT ?tax_id) AS ?tax_id)
{
 ?assembly asm:tax_id ?tax_id;
  asm:version_status "latest" ;
  asm:assembly_level ?level  . 
 FILTER(CONTAINS(?level, "Chromosome"))
} 
&lt;/pre>
このうち51件のTaxIDについてはProjectIDが一意に決まらない。以下はそのリストを出力するクエリ
[http://goo.gl/3Ec92B 結果リスト]
&lt;pre>
PREFIX asm: &lt;http://www.ncbi.nlm.nih.gov/assembly/>
SELECT ?tax_id ?bioproject_accession ?category ?release_date
FROM &lt;http://togogenome.org/graph/assembly_report>
{
 {
  SELECT ?tax_id
  {
   ?assembly asm:tax_id ?tax_id;
    asm:bioproject_accession ?bioproject_accession ;
    asm:version_status "latest" ;
    asm:assembly_level ?level  . 
   FILTER(CONTAINS(?level, "Chromosome"))
  } GROUP BY ?tax_id HAVING (COUNT(DISTINCT ?bioproject_accession) > 1) 
 }
 ?assembly asm:tax_id ?tax_id;
  asm:bioproject_accession ?bioproject_accession ;
  asm:version_status "latest" ;
  asm:assembly_level ?level  ;
  asm:refseq_category ?category;
  asm:release_date ?release_date .
} ORDER BY ?tax_id 
&lt;/pre>

====選定基準3. ヒトゲノム(9606)に関しては”PRJNA168”のみ====
上記で対象となるBioProjectのうち、ヒトゲノムだけはBioProjectを一つ(”PRJNA168”)に選定して登録する。&lt;br/>
その他の"PRJNA20837"と"PRJNA178030"等はTogoGenomeの対象外とする(SPARQLではなくスクリプト側で除外)。&lt;br/>
ヒトゲノム以外はTaxIDについてProjectIDが複数登録されていてもよいものとする&lt;br/>

&lt;br/>
*なお、データ更新することでバージョン(v61) から削除されるTaxIDは35件(理由は未調査) [http://ep.dbcls.jp/sparql-import?default-graph-uri=&amp;query=PREFIX+asm%3A+%3Chttp%3A%2F%2Fwww.ncbi.nlm.nih.gov%2Fassembly%2F%3E%0D%0ASELECT+DISTINCT+%3Ftax_id%0D%0A%7B%0D%0A+%3Fassembly+asm%3Ataxon+%3Ftax_id%0D%0A%7D&amp;format=text%2Fhtml&amp;timeout=0&amp;debug=on クエリ1] [http://ep.dbcls.jp/sparql-import?default-graph-uri=&amp;query=PREFIX+asm%3A+%3Chttp%3A%2F%2Fwww.ncbi.nlm.nih.gov%2Fassembly%2F%3E%0D%0ASELECT+DISTINCT+%3Ftax_id%0D%0A%7B%0D%0A+%3Fassembly+asm%3Ataxon+%3Ftax_id%0D%0A%7D&amp;format=text%2Fhtml&amp;timeout=0&amp;debug=on クエリ2]
&lt;pre>
http://identifiers.org/taxonomy/1046632
http://identifiers.org/taxonomy/1051631
http://identifiers.org/taxonomy/1069378
http://identifiers.org/taxonomy/1081094
http://identifiers.org/taxonomy/1081095
http://identifiers.org/taxonomy/1091494
http://identifiers.org/taxonomy/1091500
http://identifiers.org/taxonomy/1091501
http://identifiers.org/taxonomy/1100832
http://identifiers.org/taxonomy/1100833
http://identifiers.org/taxonomy/1126885
http://identifiers.org/taxonomy/1167634
http://identifiers.org/taxonomy/117575
http://identifiers.org/taxonomy/1216962
http://identifiers.org/taxonomy/1219083
http://identifiers.org/taxonomy/1219084
http://identifiers.org/taxonomy/1266844
http://identifiers.org/taxonomy/191026
http://identifiers.org/taxonomy/28173
http://identifiers.org/taxonomy/340100
http://identifiers.org/taxonomy/396359
http://identifiers.org/taxonomy/508765
http://identifiers.org/taxonomy/509169
http://identifiers.org/taxonomy/562019
http://identifiers.org/taxonomy/572263
http://identifiers.org/taxonomy/63186
http://identifiers.org/taxonomy/683735
http://identifiers.org/taxonomy/688245
http://identifiers.org/taxonomy/69896
http://identifiers.org/taxonomy/699032
http://identifiers.org/taxonomy/699033
http://identifiers.org/taxonomy/699037
http://identifiers.org/taxonomy/882884
http://identifiers.org/taxonomy/940296
http://identifiers.org/taxonomy/977801
&lt;/pre>

====選定基準4. sequence_roleが"assembled-molecule"となっているシーケンス====
選定したAssemblyのRefseqIDを検索するとscaffold等が混じるため、sequenc_roleが"assembled-molecule"となっているものだけにしぼる。[http://ep.dbcls.jp/sparql-import?default-graph-uri=&amp;query=PREFIX+asm%3A+%3Chttp%3A%2F%2Fwww.ncbi.nlm.nih.gov%2Fassembly%2F%3E%0D%0A%0D%0ASELECT+DISTINCT+%3Fseq_id+%3Frole%0D%0AFROM+%3Chttp%3A%2F%2Ftogogenome.org%2Fgraph%2Fassembly_report%3E%0D%0A%7B%0D%0A+%3Fassembly+asm%3Aassembly_id+%22GCF_000001405.27%22+%3B%0D%0A+asm%3Asequence+%3Fseq+.%0D%0A+%3Fseq+asm%3Aassigned_molecule_location_type+%3Freplicon_type+%3B%0D%0A++asm%3Asequence_role+%3Frole+%3B+%23%22assembled-molecule%22+%3B%0D%0A++asm%3Arefseq_accession+%3Fseq_id+.%0D%0A%7D+ORDER+BY+%3Frole+%3Fseq_id&amp;format=text%2Fhtml&amp;timeout=0&amp;debug=on ヒトゲノムでの例]
&lt;br/>
*確認事項：roleの説明についてはNCBIのAssembly helpのページに説明があるが、選択肢が異なる [http://www.ncbi.nlm.nih.gov/assembly/help/#definition NCBIページ]
====選定基準5. NucleotideのIDがidentifiers.orgのrefseqIDのパターンにマッチしているもの====
refseqIDの項目に"na"(値なし)や"lcl|chr9_random"等[http://ep.dbcls.jp/sparql-import?default-graph-uri=&amp;query=PREFIX+asm%3A+%3Chttp%3A%2F%2Fwww.ncbi.nlm.nih.gov%2Fassembly%2F%3E%0D%0ASELECT+DISTINCT+%3Ftax_link+%3Fbioproject_accession+%3Fgbrs+%3Freplicon_type++%3Frefseq%0D%0AFROM+%3Chttp%3A%2F%2Ftogogenome.org%2Fgraph%2Fassembly_report%3E%0D%0A%7B%0D%0A+%3Fassembly+asm%3Atax_id++%3Ftax_id+%3B%0D%0A++asm%3Abioproject_accession+%3Fbioproject_accession+%3B%0D%0A++asm%3Agbrs_paired_asm+%3Fgbrs+%3B%0D%0A++asm%3Aversion_status+%22latest%22+%3B%0D%0A++asm%3Aassembly_level+%3Flevel++%3B%0D%0A++asm%3Asequence+%3Fseq+.%0D%0A+%3Fseq+asm%3Aassigned_molecule_location_type+%3Freplicon_type+%3B%0D%0A++asm%3Arefseq_accession+%3Frefseq+.%0D%0A+FILTER%28CONTAINS%28%3Flevel%2C+%22Chromosome%22%29+AND+%3Freplicon_type+IN%28%22Chromosome%22%2C+%22Plasmid%22%29%29%0D%0A+BIND%28IRI%28CONCAT%28%22http%3A%2F%2Fwww.ncbi.nlm.nih.gov%2Ftaxonomy%2F%3Fterm%3D%22%2C+%3Ftax_id+%29%29+AS+%3Ftax_link%29%0D%0A%7D+ORDER+BY+DESC+%28%3Frefseq%29+OFFSET+1+LIMIT+20&amp;format=text%2Fhtml&amp;timeout=0&amp;debug=on おかしなRefSeqIDリスト]RefSeqIDとして有効でなさそうなものは除外する。&lt;br/>
&lt;br/>
[http://identifiers.org/refseq/ Identifiers.orgに記載]されているRefSeqIDのIdentifier patternに準拠したIDだけを選定する。&lt;br/>
*課題1；Identifiers.orgのパターンでは無効だが、有効そうなIDが含まれている(416件)
例；[http://www.ncbi.nlm.nih.gov/assembly/GCF_000191665.1/ NZ_CM001142.1](NZ_にアルファベット2文字続くが、Identifiers.orgのパターンでは"(NZ\_[A-Z]{4}\d+))"４文字必要だが)
*課題2；NT_で始まる品質の悪いID(Contig or scaffold, clone-based or WGS)も登録される [http://www.ncbi.nlm.nih.gov/books/NBK21091/table/ch18.T.refseq_accession_numbers_and_mole/?report=objectonly RefSeqIDのPrefixリスト]
現状ではNTが含まれるのは4ゲノム

180454/PRJNA163/NT_078265,NT_078266,NT_078267,NT_078268(Anopheles gambiae str. PEST ハマダラ蚊) [http://www.ncbi.nlm.nih.gov/assembly/GCF_000005575.2/ リンク]
7227/PRJNA164/NT_033777,NT_033778,NT_033779,NT_037436(Drosophila melanogaster　ミバエ) [http://www.ncbi.nlm.nih.gov/assembly/GCF_000001215.4/ リンク]
7240/PRJNA29993/NT_167061,NT_167066,NT_167067,NT_167068(Drosophila simulans オナジショウジョウバエ) [http://www.ncbi.nlm.nih.gov/assembly/GCF_000259055.1/ リンク]
7245/PRJNA29999/NT_167062,NT_167063,NT_167064,NT_167065(Drosophila yakuba ヤクバショウジョウバエ) [http://www.ncbi.nlm.nih.gov/assembly/GCF_000005975.2/ リンク]

====データ取得用SPARQL====
上記の条件に合致するTaxIDとProjectIDのRefSeqID一覧を抽出するクエリ。&lt;br/>
&lt;pre>
PREFIX asm: &lt;http://www.ncbi.nlm.nih.gov/assembly/>

SELECT DISTINCT ?assembly_id ?tax_id ?bioproject_accession ?replicon_type ?seq_id
FROM &lt;http://togogenome.org/graph/assembly_report>
{
 ?assembly asm:assembly_id ?assembly_id ;
  asm:tax_id  ?tax_id ;
  asm:bioproject_accession ?bioproject_accession ;
  asm:gbrs_paired_asm ?gbrs ;
  asm:version_status "latest" ;
  asm:assembly_level ?level  ;
  asm:sequence ?seq .
 ?seq asm:assigned_molecule_location_type ?replicon_type ;
  asm:sequence_role "assembled-molecule" ;
  asm:refseq_accession ?seq_id .
 FILTER(
  CONTAINS(?level, "Chromosome") 
   AND !((?tax_id ="9606") AND !(?bioproject_accession = "PRJNA168"))
   AND regex(?seq_id, "^((AC|AP|NC|NG|NM|NP|NR|NT|NW|XM|XP|XR|YP|ZP)_\\d+|(NZ\\_[A-Z]{2,4}\\d+))(\\.\\d+)?$")
 )
} ORDER BY ?tax_id ?bioproject_accession ?replicon_type ?seq_id
&lt;/pre>
[http://wiki.lifesciencedb.jp/mw/SPARQLthon26/TogoGenome#.E9.81.B8.E5.AE.9A.E5.9F.BA.E6.BA.961._assembly_level.E3.81.AB.22Chromosome.22.E3.81.8C.E5.90.AB.E3.81.BE.E3.82.8C.E3.81.A6.E3.81.84.E3.82.8BAssembly 選定基準3]と[http://wiki.lifesciencedb.jp/mw/SPARQLthon26/TogoGenome#.E9.81.B8.E5.AE.9A.E5.9F.BA.E6.BA.965._Nucleotide.E3.81.AEID.E3.81.8Cidentifiers.org.E3.81.AErefseqID.E3.81.AE.E3.83.91.E3.82.BF.E3.83.BC.E3.83.B3.E3.81.AB.E3.83.9E.E3.83.83.E3.83.81.E3.81.97.E3.81.A6.E3.81.84.E3.82.8B.E3.82.82.E3.81.AE 選定基準5]の条件を切り出したバージョン(速度が遅くなったりヒトゲノムのような条件が増えるとこちらを使う)。
&lt;pre>
PREFIX asm: &lt;http://www.ncbi.nlm.nih.gov/assembly/>

SELECT DISTINCT ?assembly_id ?tax_id ?bioproject_accession ?gbrs ?replicon_type ?seq_id
FROM &lt;http://togogenome.org/graph/assembly_report>
{
 ?assembly asm:assembly_id ?assembly_id ;
  asm:tax_id  ?tax_id ;
  asm:bioproject_accession ?bioproject_accession ;
  asm:gbrs_paired_asm ?gbrs ;
  asm:version_status "latest" ;
  asm:assembly_level ?level  ;
  asm:sequence ?seq .
 ?seq asm:assigned_molecule_location_type ?replicon_type ;
  asm:sequence_role "assembled-molecule" ;
  asm:refseq_accession ?seq_id .
 FILTER(CONTAINS(?level, "Chromosome"))
} ORDER BY ?tax_id ?bioproject_accession ?replicon_type ?seq_id
&lt;/pre>
&lt;strike>上記の条件に合致するTaxIDとProjectIDを抽出するクエリ。Organellaの有無確認でGENOME_REPORTSとデータを繋げるために、gbrs_paired_asmも取得する&lt;/strike>
&lt;pre>
PREFIX asm: &lt;http://www.ncbi.nlm.nih.gov/assembly/>
SELECT DISTINCT ?assembly_id ?tax_id ?bioproject_accession ?gbrs 
FROM &lt;http://togogenome.org/graph/assembly_report>
{
 ?assembly asm:assembly_id  ?assembly_id ;
  asm:tax_id  ?tax_id ;
  asm:bioproject_accession ?bioproject_accession ;
  asm:gbrs_paired_asm ?gbrs ;
  asm:version_status "latest" ;
  asm:assembly_level ?level  .
 FILTER(CONTAINS(?level, "Chromosome"))
} ORDER BY ?tax_id ?bioproject_accession
&lt;/pre>
&lt;strike>個別のTaxとProjectIDに対するRefseqのNucleotide sequenceのタイプとIDを取得するSPARQL&lt;/strike>&lt;br/>

&lt;pre>
PREFIX asm: &lt;http://www.ncbi.nlm.nih.gov/assembly/>
SELECT DISTINCT ?replicon_type ?seq_id 
FROM &lt;http://togogenome.org/graph/assembly_report>
{
 ?assembly asm:assembly_id "GCF_000009705.1" ;
  asm:tax_id  "103690" ;
  asm:bioproject_accession "PRJNA57803" ;
  asm:sequence ?seq .
 ?seq asm:assigned_molecule_location_type ?replicon_type ;
  asm:sequence_role "assembled-molecule" ;
  asm:refseq_accession ?seq_id .
} ORDER BY ?replicon_type ?seq_id
&lt;/pre>

&lt;strike>なお、上記二つは一つのクエリで書く事も可能だが、GROUP_CONCATを使う場合の文字列制限でおこられる様子。&lt;/strike>&lt;br/>
&lt;strike>"Virtuoso 22026 Error SR319: Max row length is exceeded when trying to store a string of 6934 chars into a temp col"&lt;/strike>
&lt;pre>
PREFIX asm: &lt;http://www.ncbi.nlm.nih.gov/assembly/>
SELECT DISTINCT ?tax_id ?bioproject_accession ?gbrs ?replicon_type  (GROUP_CONCAT(?refseq, ',') AS ?sequences)
FROM &lt;http://togogenome.org/graph/assembly_report>
{
 ?assembly asm:tax_id  ?tax_id ;
  asm:bioproject_accession ?bioproject_accession ;
  asm:gbrs_paired_asm ?gbrs ;
  asm:version_status "latest" ;
  asm:assembly_level ?level  ;
  asm:sequence ?seq .
 ?seq asm:assigned_molecule_location_type ?replicon_type ;
  asm:refseq_accession ?refseq .
 FILTER(CONTAINS(?level, "Chromosome") AND ?replicon_type IN("Chromosome", "Plasmid"))
} GROUP BY ?tax_id ?bioproject_accession ?gbrs ?replicon_type  ORDER BY ?tax_id ?bioproject_accession
&lt;/pre>

&lt;br/>
&lt;br/>
以下の選定条件は、TaxIDに対してProjectIDを一つだけ選定するもの。ひとつのTaxIDに複数のProjectIDを登録してもいいことになったため、以降の選定基準は不要。&lt;br/>
*&lt;strike>選定基準3. refseqのcategoryで優先順位を決定する&lt;/strike>
latestで複数のProjectIDがある場合には(複数の機関のProjectIDがあるケース等)、categoryの一番高いものを優先する。&lt;br/>
categoryのリストは以下の通り。
&lt;pre>
PREFIX asm: &lt;http://www.ncbi.nlm.nih.gov/assembly/>
SELECT ?category (COUNT(?assembly) AS ?count)
FROM &lt;http://togogenome.org/graph/assembly_report>
{
 ?assembly asm:refseq_category ?category .
} GROUP BY ?category ORDER BY DESC (?count)
&lt;/pre>
&lt;pre>
"na"	22478
"representative-genome"	3492
"reference-genome"	98
&lt;/pre>

[http://www.ncbi.nlm.nih.gov/pmc/articles/PMC3965038/ 論文]によるとcategoryによるクオリティの優先度は次のようになる&lt;br/>
"reference-genome"> "representative-genome" > "na"

*&lt;strike>選定基準4. release_dateで優先順位を決定する&lt;/strike>
categoryでもProjectIDが一意に決まらない場合には、release_dateが新しいものを選択する。

*&lt;strike>選定基準5. それでも決まらない場合&lt;/strike>
TogoGenomeのロード対象外とする&lt;br/>
このケースは現在一例のみで、Isolateだけが違うProjectIDが3件登録されている。
http://www.ncbi.nlm.nih.gov/assembly/?term=txid1074919

===&lt;strike>4.ASSEMBLY_REPORTSにないシーケンスデータの一覧を取得する&lt;/strike>(廃止)===
&lt;strike>真核生物のうち、人のミトコンドリア等のAssemblyがほぼ発生しないものについては、Assemblyのレポートには記載されていないため、漏れる事がある&lt;/strike>&lt;br/>
&lt;strike>それらのBioProjectを取得するには個別対応となる。漏れている可能性があるものは「GENOME_REPORTS/eukaryotes.txt」のOrganellaの欄に数値があるものでリストアップして個別対応する。&lt;/strike>&lt;br/>
→ 手順2のassembly_reports.ttlからミトコンドリア等のシーケンス番号が取得できたため、この手順は不要

===5.TogoWSでGenBANK形式を取得する===
対象としたTaxIDとBioProjectIDを元にTogoWSからGenBANK形式のデータを取得する
[http://ep.dbcls.jp/rdf/togogenome/bin/wget_refseq.rb スクリプト]&lt;br/>
&lt;br/>
課題：togowsから取得できなかったnucleotide(502 Proxy Error ← Timeout?)
&lt;pre>
http://togows.dbcls.jp/entry/nucleotide/NC_008801
http://togows.dbcls.jp/entry/nucleotide/NC_008802
http://togows.dbcls.jp/entry/nucleotide/NC_008803
http://togows.dbcls.jp/entry/nucleotide/NC_008804
&lt;/pre>

===6.GenBANK形式をRDFに変換する===
[https://github.com/dbcls/rdfsummit/blob/master/insdc2ttl/insdc2ttl.rb 変換スクリプト]&lt;br/>
*課題:Chromosome,Plasmid以外のMolecule typeについて
これまでの微生物だけの場合にはMolecule typeは"Chromosome(SO:0000340)", "Plasmid(SO:0000155)"だけで登録していたが、assembly reportsから真核含めたデータを取得するとこれ以外のtypeも含まれていた（例：Mitochondrion、Linkage Group、Chloroplast等）これらの値に割り当てるSOのIDが必要になる&lt;br/>
&lt;br/>
[https://docs.google.com/spreadsheets/d/11iRBnv29TQRgo4CuZbjjm4rKFrQ88IjZeddZNvBgtMU/edit#gid=936841703 Typeと出現個数]("全seqのタイプと個数"シート)&lt;br/>
[https://docs.google.com/spreadsheets/d/11iRBnv29TQRgo4CuZbjjm4rKFrQ88IjZeddZNvBgtMU/edit#gid=936841703 ChromosomeとPlasmid以外のリスト]("登録対象seqでChromosomeとPlasmid以外のリスト"シート)&lt;br/>
&lt;br/>
解決策：[https://github.com/dbcls/rdfsummit/blob/master/insdc2ttl/insdc2ttl.rb insdc2ttl.rb]側で"Linkage Group"等の新しいタイプへのSO IDの割り当てを行った。

== 関連情報 ==
* [[SPARQLthon26/GenomeDataSubset]]
* [[SPARQLthon26/CyanoBase]]</textarea><div class='templatesUsed'>

</div>
<p id="mw-returnto"><a href="/mw/SPARQLthon26/TogoGenome" title="SPARQLthon26/TogoGenome">SPARQLthon26/TogoGenome</a>に戻る。</p>
<div class="printfooter">
「<a href="http://wiki.lifesciencedb.jp/mw/SPARQLthon26/TogoGenome">http://wiki.lifesciencedb.jp/mw/SPARQLthon26/TogoGenome</a>」より作成</div>
		<div id='catlinks' class='catlinks catlinks-allhidden'></div>		<!-- end content -->
				<div class="visualClear"></div>
	</div>
</div></div>
<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>表示</h5>
		<div class="pBody">
			<ul>
				 <li id="ca-nstab-main" class="selected"><a href="/mw/SPARQLthon26/TogoGenome" title="本文を表示 [c]" accesskey="c">ページ</a></li>
				 <li id="ca-talk" class="new"><a href="/mw/index.php?title=%E3%83%8E%E3%83%BC%E3%83%88:SPARQLthon26/TogoGenome&amp;action=edit&amp;redlink=1" title="記事についての議論 [t]" accesskey="t">議論</a></li>
				 <li id="ca-viewsource" class="selected"><a href="/mw/index.php?title=SPARQLthon26/TogoGenome&amp;action=edit" title="このページは保護されています。&#10;ページのソースを閲覧できます。 [e]" accesskey="e">ソースを表示</a></li>
				 <li id="ca-history"><a href="/mw/index.php?title=SPARQLthon26/TogoGenome&amp;action=history" title="このページの過去の版 [h]" accesskey="h">履歴</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>個人用ツール</h5>
		<div class="pBody">
			<ul>
				<li id="pt-anonuserpage"><a href="/mw/%E5%88%A9%E7%94%A8%E8%80%85:172.18.8.51" title="自分が編集しているIPアドレスの利用者ページ [.]" accesskey="." class="new">172.18.8.51</a></li>
				<li id="pt-anontalk"><a href="/mw/%E5%88%A9%E7%94%A8%E8%80%85%E2%80%90%E4%BC%9A%E8%A9%B1:172.18.8.51" title="このIPアドレスからなされた編集についての議論 [n]" accesskey="n" class="new">このIPアドレスのトーク</a></li>
				<li id="pt-anonlogin"><a href="/mw/index.php?title=%E7%89%B9%E5%88%A5:%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3&amp;returnto=SPARQLthon26/TogoGenome&amp;returntoquery=action%3Dedit" title="ログインすることが推奨されます。ただし、必須ではありません。 [o]" accesskey="o">ログイン</a></li>
				<li id="pt-openidlogin"><a href="/mw/index.php?title=%E7%89%B9%E5%88%A5:OpenID%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3&amp;returnto=SPARQLthon26/TogoGenome">OpenIDでログイン</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a style="background-image: url(/mw/images/togowiki-logo.png);" href="/mw/%E3%83%A1%E3%82%A4%E3%83%B3%E3%83%9A%E3%83%BC%E3%82%B8" title="メインページに移動"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
	<div class='generated-sidebar portlet' id='p-navigation'>
		<h5>案内</h5>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage-description"><a href="/mw/%E3%83%A1%E3%82%A4%E3%83%B3%E3%83%9A%E3%83%BC%E3%82%B8" title="メインページに移動する [z]" accesskey="z">メインページ</a></li>
				<li id="n-portal"><a href="/mw/TogoWiki:%E3%82%B3%E3%83%9F%E3%83%A5%E3%83%8B%E3%83%86%E3%82%A3%E3%83%BB%E3%83%9D%E3%83%BC%E3%82%BF%E3%83%AB" title="このプロジェクトについて、できること、情報を入手する場所">コミュニティ・ポータル</a></li>
				<li id="n-currentevents"><a href="/mw/TogoWiki:%E6%9C%80%E8%BF%91%E3%81%AE%E5%87%BA%E6%9D%A5%E4%BA%8B" title="最近の出来事について予備知識を得る">最近の出来事</a></li>
				<li id="n-recentchanges"><a href="/mw/%E7%89%B9%E5%88%A5:%E6%9C%80%E8%BF%91%E3%81%AE%E6%9B%B4%E6%96%B0" title="ウィキにおける最近の更新の一覧 [r]" accesskey="r">最近の更新</a></li>
				<li id="n-randompage"><a href="/mw/%E7%89%B9%E5%88%A5:%E3%81%8A%E3%81%BE%E3%81%8B%E3%81%9B%E8%A1%A8%E7%A4%BA" title="無作為に抽出されたページの読み込み [x]" accesskey="x">おまかせ表示</a></li>
				<li id="n-help"><a href="/mw/Help:%E7%9B%AE%E6%AC%A1" title="情報を得る場所">ヘルプ</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">検索</label></h5>
		<div id="searchBody" class="pBody">
			<form action="/mw/index.php" id="searchform">
				<input type='hidden' name="title" value="特別:検索"/>
				<input id="searchInput" title="TogoWiki内を検索" accesskey="f" type="search" name="search" />
				<input type='submit' name="go" class="searchButton" id="searchGoButton"	value="表示" title="厳密に一致する名前のページが存在すれば、そのページへ移動します" />&nbsp;
				<input type='submit' name="fulltext" class="searchButton" id="mw-searchButton" value="検索" title="入力された文字列が含まれるページを検索します" />
			</form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>ツールボックス</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="/mw/%E7%89%B9%E5%88%A5:%E3%83%AA%E3%83%B3%E3%82%AF%E5%85%83/SPARQLthon26/TogoGenome" title="ここにリンクしている全ウィキのページの一覧 [j]" accesskey="j">リンク元</a></li>
				<li id="t-recentchangeslinked"><a href="/mw/%E7%89%B9%E5%88%A5:%E9%96%A2%E9%80%A3%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%AE%E6%9B%B4%E6%96%B0%E7%8A%B6%E6%B3%81/SPARQLthon26/TogoGenome" title="このページからリンクしているページの最近の更新 [k]" accesskey="k">関連ページの更新状況</a></li>
<li id="t-specialpages"><a href="/mw/%E7%89%B9%E5%88%A5:%E7%89%B9%E5%88%A5%E3%83%9A%E3%83%BC%E3%82%B8%E4%B8%80%E8%A6%A7" title="特別ページの一覧 [q]" accesskey="q">特別ページ</a></li>
			</ul>
		</div>
	</div>
</div><!-- end of the left (by default at least) column -->
<div class="visualClear"></div>
<div id="footer">
	<div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="/mw/skins/common/images/poweredby_mediawiki_88x31.png" height="31" width="88" alt="Powered by MediaWiki" /></a></div>
	<div id="f-copyrightico"><a href="http://creativecommons.org/licenses/by/3.0/"><img src="http://i.creativecommons.org/l/by/3.0/88x31.png" alt="Attribution 3.0 Unported" width="88" height="31" /></a></div>
	<ul id="f-list">
		<li id="privacy"><a href="/mw/TogoWiki:%E3%83%97%E3%83%A9%E3%82%A4%E3%83%90%E3%82%B7%E3%83%BC%E3%83%BB%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC" title="TogoWiki:プライバシー・ポリシー">プライバシー・ポリシー</a></li>
		<li id="about"><a href="/mw/TogoWiki:TogoWiki%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6" title="TogoWiki:TogoWikiについて">TogoWikiについて</a></li>
		<li id="disclaimer"><a href="/mw/TogoWiki:%E5%85%8D%E8%B2%AC%E4%BA%8B%E9%A0%85" title="TogoWiki:免責事項">免責事項</a></li>
	</ul>
</div>
</div>

<script>if (window.runOnloadHook) runOnloadHook();</script>
<!-- Served in 0.307 secs. --></body></html>
