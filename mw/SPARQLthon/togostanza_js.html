<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="ja" dir="ltr">
<head>
<title>SPARQLthon/togostanza js - TogoWiki</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="MediaWiki 1.16.3" />
<link rel="shortcut icon" href="../../favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="https://wiki.lifesciencedb.jp/mw/opensearch_desc.php" title="TogoWiki (ja)" />
<link title="Creative Commons" type="application/rdf+xml" href="../index.php@title=SPARQLthon%252Ftogostanza_js&amp;action=creativecommons" rel="meta" />
<link rel="copyright" href="http://creativecommons.org/licenses/by/3.0/" />
<link rel="alternate" type="application/atom+xml" title="TogoWikiのAtomフィード" href="../index.php@title=特別%253A最近の更新&amp;feed=atom" />
<link rel="stylesheet" href="../skins/common/shared.css@270.css" media="screen" />
<link rel="stylesheet" href="../skins/common/commonPrint.css@270.css" media="print" />
<link rel="stylesheet" href="../skins/monobook/main.css@270.css" media="screen" />
<!--[if lt IE 5.5000]><link rel="stylesheet" href="/mw/skins/monobook/IE50Fixes.css?270" media="screen" /><![endif]-->
<!--[if IE 5.5000]><link rel="stylesheet" href="/mw/skins/monobook/IE55Fixes.css?270" media="screen" /><![endif]-->
<!--[if IE 6]><link rel="stylesheet" href="/mw/skins/monobook/IE60Fixes.css?270" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/mw/skins/monobook/IE70Fixes.css?270" media="screen" /><![endif]-->
<link rel="stylesheet" href="../index.php@title=MediaWiki%253ACommon.css&amp;usemsgcache=yes&amp;ctype=text%252Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000.css" />
<link rel="stylesheet" href="../index.php@title=MediaWiki%253APrint.css&amp;usemsgcache=yes&amp;ctype=text%252Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000.css" media="print" />
<link rel="stylesheet" href="../index.php@title=MediaWiki%253AMonobook.css&amp;usemsgcache=yes&amp;ctype=text%252Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000.css" />
<link rel="stylesheet" href="../index.php@title=-&amp;action=raw&amp;maxage=18000&amp;gen=css.css" />
<script>
var skin="monobook",
stylepath="/mw/skins",
wgUrlProtocols="http\\:\\/\\/|https\\:\\/\\/|ftp\\:\\/\\/|irc\\:\\/\\/|gopher\\:\\/\\/|telnet\\:\\/\\/|nntp\\:\\/\\/|worldwind\\:\\/\\/|mailto\\:|news\\:|svn\\:\\/\\/",
wgArticlePath="/mw/$1",
wgScriptPath="/mw",
wgScriptExtension=".php",
wgScript="/mw/index.php",
wgVariantArticlePath=false,
wgActionPaths={},
wgServer="http://wiki.lifesciencedb.jp",
wgCanonicalNamespace="",
wgCanonicalSpecialPageName=false,
wgNamespaceNumber=0,
wgPageName="SPARQLthon/togostanza_js",
wgTitle="SPARQLthon/togostanza js",
wgAction="view",
wgArticleId=672,
wgIsArticle=true,
wgUserName=null,
wgUserGroups=null,
wgUserLanguage="ja",
wgContentLanguage="ja",
wgBreakFrames=false,
wgCurRevisionId=25276,
wgVersion="1.16.3",
wgEnableAPI=true,
wgEnableWriteAPI=true,
wgSeparatorTransformTable=["", ""],
wgDigitTransformTable=["", ""],
wgMainPageTitle="メインページ",
wgFormattedNamespaces={"-2": "メディア", "-1": "特別", "0": "", "1": "ノート", "2": "利用者", "3": "利用者‐会話", "4": "TogoWiki", "5": "TogoWiki‐ノート", "6": "ファイル", "7": "ファイル‐ノート", "8": "MediaWiki", "9": "MediaWiki‐ノート", "10": "Template", "11": "Template‐ノート", "12": "Help", "13": "Help‐ノート", "14": "Category", "15": "Category‐ノート"},
wgNamespaceIds={"メディア": -2, "特別": -1, "": 0, "ノート": 1, "利用者": 2, "利用者‐会話": 3, "togowiki": 4, "togowiki‐ノート": 5, "ファイル": 6, "ファイル‐ノート": 7, "mediawiki": 8, "mediawiki‐ノート": 9, "template": 10, "template‐ノート": 11, "help": 12, "help‐ノート": 13, "category": 14, "category‐ノート": 15, "画像": 6, "画像‐ノート": 7, "image": 6, "image_talk": 7},
wgSiteName="TogoWiki",
wgCategories=[],
wgRestrictionEdit=[],
wgRestrictionMove=[];
</script><script src="../skins/common/wikibits.js@270"></script>
<script src="../skins/common/ajax.js@270"></script>
<script src="../index.php@title=-&amp;action=raw&amp;gen=js&amp;useskin=monobook&amp;270"></script>

		<style type='text/css'>
		li#pt-openidlogin {
		  background: url(../extensions/OpenID/skin/icons/openid-inputicon.png) top left no-repeat;
		  padding-left: 20px;
		  text-transform: none;
		}
		</style>
</head>
<body class="mediawiki ltr ns-0 ns-subject page-SPARQLthon_togostanza_js skin-monobook">
<div id="globalWrapper">
<div id="column-content"><div id="content" >
	<a id="top"></a>
	
	<h1 id="firstHeading" class="firstHeading">SPARQLthon/togostanza js</h1>
	<div id="bodyContent">
		<h3 id="siteSub">提供：TogoWiki</h3>
		<div id="contentSub"></div>
		<div id="jump-to-nav">移動： <a href="togostanza_js.html#column-one">案内</a>, <a href="togostanza_js.html#searchInput">検索</a></div>
		<!-- start content -->
<p>Ruby 版と JavaScript 版の TogoStanza の入手方法については <a href="http://togostanza.org/documents/development.html" class="external free" rel="nofollow">http://togostanza.org/documents/development.html</a> をご参照下さい。
</p>
<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>目次</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="togostanza_js.html#.E6.B3.A8.E6.84.8F"><span class="tocnumber">1</span> <span class="toctext">注意</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="togostanza_js.html#Ruby.E7.89.88.E3.81.A8.E3.81.AE.E6.AF.94.E8.BC.83"><span class="tocnumber">2</span> <span class="toctext">Ruby版との比較</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="togostanza_js.html#.E9.95.B7.E6.89.80"><span class="tocnumber">2.1</span> <span class="toctext">長所</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="togostanza_js.html#.E7.9F.AD.E6.89.80"><span class="tocnumber">2.2</span> <span class="toctext">短所</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5"><a href="togostanza_js.html#.E3.82.B5.E3.83.B3.E3.83.97.E3.83.AB.E3.82.B3.E3.83.BC.E3.83.89"><span class="tocnumber">3</span> <span class="toctext">サンプルコード</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="togostanza_js.html#.E5.88.9D.E3.82.81.E3.81.A6.E3.81.AEts"><span class="tocnumber">4</span> <span class="toctext">初めてのts</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="togostanza_js.html#.E3.83.89.E3.82.AD.E3.83.A5.E3.83.A1.E3.83.B3.E3.83.88"><span class="tocnumber">4.1</span> <span class="toctext">ドキュメント</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="togostanza_js.html#.E3.82.B9.E3.82.BF.E3.83.B3.E3.82.B6.E4.BD.9C.E6.88.90.E5.89.8D.E3.81.AE.E7.A2.BA.E8.AA.8D"><span class="tocnumber">4.2</span> <span class="toctext">スタンザ作成前の確認</span></a>
<ul>
<li class="toclevel-3 tocsection-9"><a href="togostanza_js.html#.E3.82.A8.E3.83.B3.E3.83.89.E3.83.9D.E3.82.A4.E3.83.B3.E3.83.88.E3.81.8CCORS.E5.AF.BE.E5.BF.9C.E3.81.95.E3.82.8C.E3.81.A6.E3.81.84.E3.82.8B.E3.81.8B"><span class="tocnumber">4.2.1</span> <span class="toctext">エンドポイントがCORS対応されているか</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="togostanza_js.html#.E3.82.A8.E3.83.B3.E3.83.89.E3.83.9D.E3.82.A4.E3.83.B3.E3.83.88.E3.81.8CCORS.E5.AF.BE.E5.BF.9C.E3.81.95.E3.82.8C.E3.81.A6.E3.81.84.E3.81.AA.E3.81.84.E5.A0.B4.E5.90.88"><span class="tocnumber">4.2.2</span> <span class="toctext">エンドポイントがCORS対応されていない場合</span></a></li>
<li class="toclevel-3 tocsection-11"><a href="togostanza_js.html#.E7.99.BA.E8.A1.8C.E3.81.99.E3.82.8BSPARQL.E3.81.8C.E6.AD.A3.E3.81.97.E3.81.84.E3.81.8B.28.E5.80.A4.E3.81.8C.E8.BF.94.E3.81.A3.E3.81.A6.E3.81.8F.E3.82.8B.E3.81.8B.29"><span class="tocnumber">4.2.3</span> <span class="toctext">発行するSPARQLが正しいか(値が返ってくるか)</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-12"><a href="togostanza_js.html#.E3.82.A4.E3.83.B3.E3.82.B9.E3.83.88.E3.83.BC.E3.83.AB"><span class="tocnumber">4.3</span> <span class="toctext">インストール</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="togostanza_js.html#.E3.82.B9.E3.82.BF.E3.83.B3.E3.82.B6.E4.BD.9C.E6.88.90"><span class="tocnumber">4.4</span> <span class="toctext">スタンザ作成</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-14"><a href="togostanza_js.html#How_To"><span class="tocnumber">5</span> <span class="toctext">How To</span></a>
<ul>
<li class="toclevel-2 tocsection-15"><a href="togostanza_js.html#SPARQL_result.E3.83.87.E3.83.BC.E3.82.BF.E3.81.AE.E5.8A.A0.E5.B7.A5"><span class="tocnumber">5.1</span> <span class="toctext">SPARQL resultデータの加工</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="togostanza_js.html#.E3.83.9A.E3.83.BC.E3.82.B8.E3.81.AE.E3.82.A4.E3.83.99.E3.83.B3.E3.83.88.E3.82.92.E5.8F.97.E3.81.91.E5.8F.96.E3.82.8B"><span class="tocnumber">5.2</span> <span class="toctext">ページのイベントを受け取る</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="togostanza_js.html#.E8.A4.87.E6.95.B0.E3.81.AESPARQL.E3.81.AE.E5.AE.9F.E8.A1.8C"><span class="tocnumber">5.3</span> <span class="toctext">複数のSPARQLの実行</span></a>
<ul>
<li class="toclevel-3 tocsection-18"><a href="togostanza_js.html#.E8.A4.87.E6.95.B0.E3.82.AF.E3.82.A8.E3.83.AA.E3.81.AE.E9.A0.86.E6.AC.A1.E5.AE.9F.E8.A1.8C"><span class="tocnumber">5.3.1</span> <span class="toctext">複数クエリの順次実行</span></a></li>
<li class="toclevel-3 tocsection-19"><a href="togostanza_js.html#.E8.A4.87.E6.95.B0.E3.82.AF.E3.82.A8.E3.83.AA.E3.81.AE.E4.B8.A6.E5.88.97.E5.AE.9F.E8.A1.8C"><span class="tocnumber">5.3.2</span> <span class="toctext">複数クエリの並列実行</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-20"><a href="togostanza_js.html#SPARQL.E4.BB.A5.E5.A4.96.E3.81.AEAPI.E5.91.BC.E3.81.B3.E5.87.BA.E3.81.97"><span class="tocnumber">5.4</span> <span class="toctext">SPARQL以外のAPI呼び出し</span></a>
<ul>
<li class="toclevel-3 tocsection-21"><a href="togostanza_js.html#jQuery"><span class="tocnumber">5.4.1</span> <span class="toctext">jQuery</span></a></li>
<li class="toclevel-3 tocsection-22"><a href="togostanza_js.html#fetch"><span class="tocnumber">5.4.2</span> <span class="toctext">fetch</span></a></li>
<li class="toclevel-3 tocsection-23"><a href="togostanza_js.html#SPARQList"><span class="tocnumber">5.4.3</span> <span class="toctext">SPARQList</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-24"><a href="togostanza_js.html#Style.28css.29.E3.81.AE.E9.81.A9.E7.94.A8"><span class="tocnumber">5.5</span> <span class="toctext">Style(css)の適用</span></a>
<ul>
<li class="toclevel-3 tocsection-25"><a href="togostanza_js.html#templates.E3.83.95.E3.82.A1.E3.82.A4.E3.83.AB.E3.81.B8.E3.81.AE.E8.A8.98.E8.BF.B0"><span class="tocnumber">5.5.1</span> <span class="toctext">templatesファイルへの記述</span></a></li>
<li class="toclevel-3 tocsection-26"><a href="togostanza_js.html#css.E3.83.95.E3.82.A1.E3.82.A4.E3.83.AB.E3.81.AE.E9.81.A9.E7.94.A8"><span class="tocnumber">5.5.2</span> <span class="toctext">cssファイルの適用</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-27"><a href="togostanza_js.html#.E5.85.AC.E9.96.8B.E3.81.95.E3.82.8C.E3.81.9Fjs.E3.81.AE.E3.83.AD.E3.83.BC.E3.83.89"><span class="tocnumber">5.6</span> <span class="toctext">公開されたjsのロード</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="togostanza_js.html#.E9.9D.9E.E5.85.AC.E9.96.8B.28.E7.8B.AC.E8.87.AA.E4.BD.9C.E6.88.90.29js.E3.83.95.E3.82.A1.E3.82.A4.E3.83.AB.E3.81.AE.E3.83.AD.E3.83.BC.E3.83.89"><span class="tocnumber">5.7</span> <span class="toctext">非公開(独自作成)jsファイルのロード</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="togostanza_js.html#.E7.94.BB.E5.83.8F.E3.81.AE.E9.85.8D.E7.BD.AE"><span class="tocnumber">5.8</span> <span class="toctext">画像の配置</span></a></li>
<li class="toclevel-2 tocsection-30"><a href="togostanza_js.html#.E3.82.B9.E3.82.BF.E3.83.B3.E3.82.B6.E3.81.AE.E5.86.8D.E5.AE.9F.E8.A1.8C.28.E3.83.AA.E3.83.AD.E3.83.BC.E3.83.89.29"><span class="tocnumber">5.9</span> <span class="toctext">スタンザの再実行(リロード)</span></a></li>
<li class="toclevel-2 tocsection-31"><a href="togostanza_js.html#.E3.82.B9.E3.82.BF.E3.83.B3.E3.82.B6.E5.90.8C.E5.A3.AB.E3.81.AE.E9.80.A3.E6.90.BA"><span class="tocnumber">5.10</span> <span class="toctext">スタンザ同士の連携</span></a></li>
<li class="toclevel-2 tocsection-32"><a href="togostanza_js.html#.E3.82.B9.E3.82.BF.E3.83.B3.E3.82.B6.E3.81.AE.E5.85.A5.E3.82.8C.E5.AD.90"><span class="tocnumber">5.11</span> <span class="toctext">スタンザの入れ子</span></a></li>
<li class="toclevel-2 tocsection-33"><a href="togostanza_js.html#.E3.82.B9.E3.82.BF.E3.83.B3.E3.82.B6.E3.81.AE.E5.85.AC.E9.96.8B.E6.96.B9.E6.B3.95"><span class="tocnumber">5.12</span> <span class="toctext">スタンザの公開方法</span></a>
<ul>
<li class="toclevel-3 tocsection-34"><a href="togostanza_js.html#.E5.85.AC.E9.96.8B.E3.82.B3.E3.83.B3.E3.83.86.E3.83.B3.E3.83.84.E3.81.AE.E7.94.9F.E6.88.90"><span class="tocnumber">5.12.1</span> <span class="toctext">公開コンテンツの生成</span></a></li>
<li class="toclevel-3 tocsection-35"><a href="togostanza_js.html#.E3.82.B9.E3.82.BF.E3.83.B3.E3.82.B6.E3.81.AE.E5.9F.8B.E3.82.81.E8.BE.BC.E3.81.BF"><span class="tocnumber">5.12.2</span> <span class="toctext">スタンザの埋め込み</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-36"><a href="togostanza_js.html#SSL.E5.8C.96_.28https.29_.E6.BA.96.E5.82.99"><span class="tocnumber">5.13</span> <span class="toctext">SSL化 (https) 準備</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-37"><a href="togostanza_js.html#.E3.83.88.E3.83.A9.E3.83.96.E3.83.AB.E3.82.B7.E3.83.A5.E3.83.BC.E3.83.86.E3.82.A3.E3.83.B3.E3.82.B0"><span class="tocnumber">6</span> <span class="toctext">トラブルシューティング</span></a>
<ul>
<li class="toclevel-2 tocsection-38"><a href="togostanza_js.html#ts_server.28build.29.E3.81.8C.E5.8B.95.E3.81.8B.E3.81.AA.E3.81.84"><span class="tocnumber">6.1</span> <span class="toctext">ts server(build)が動かない</span></a>
<ul>
<li class="toclevel-3 tocsection-39"><a href="togostanza_js.html#.E3.82.B3.E3.83.9E.E3.83.B3.E3.83.89.E3.82.92.E6.89.93.E3.81.A4.E3.83.87.E3.82.A3.E3.83.AC.E3.82.AF.E3.83.88.E3.83.AA.E3.81.8C.E4.B8.8D.E9.81.A9.E5.88.87"><span class="tocnumber">6.1.1</span> <span class="toctext">コマンドを打つディレクトリが不適切</span></a></li>
<li class="toclevel-3 tocsection-40"><a href="togostanza_js.html#.E3.83.9D.E3.83.BC.E3.83.88.E3.81.8C.E3.81.99.E3.81.A7.E3.81.AB.E4.BD.BF.E7.94.A8.E3.81.95.E3.82.8C.E3.81.A6.E3.81.84.E3.82.8B.28ts_server.E3.82.B3.E3.83.9E.E3.83.B3.E3.83.89.E3.81.AE.E3.81.BF.29"><span class="tocnumber">6.1.2</span> <span class="toctext">ポートがすでに使用されている(ts serverコマンドのみ)</span></a></li>
<li class="toclevel-3 tocsection-41"><a href="togostanza_js.html#invalid.E3.81.A8.E3.81.84.E3.81.86.E3.83.A1.E3.83.83.E3.82.BB.E3.83.BC.E3.82.B8.E3.81.8C.E5.87.BA.E3.82.8B"><span class="tocnumber">6.1.3</span> <span class="toctext">invalidというメッセージが出る</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-42"><a href="togostanza_js.html#.E3.82.B9.E3.82.BF.E3.83.B3.E3.82.B6.E3.81.8C.E8.A1.A8.E7.A4.BA.E3.81.95.E3.82.8C.E3.81.AA.E3.81.84"><span class="tocnumber">6.2</span> <span class="toctext">スタンザが表示されない</span></a>
<ul>
<li class="toclevel-3 tocsection-43"><a href="togostanza_js.html#SPARQL.E3.81.AE.E3.82.A8.E3.83.A9.E3.83.BC"><span class="tocnumber">6.2.1</span> <span class="toctext">SPARQLのエラー</span></a>
<ul>
<li class="toclevel-4 tocsection-44"><a href="togostanza_js.html#.E3.82.A8.E3.83.B3.E3.83.89.E3.83.9D.E3.82.A4.E3.83.B3.E3.83.88.E3.81.AECORS.E3.81.8C.E6.9C.AA.E5.AF.BE.E5.BF.9C"><span class="tocnumber">6.2.1.1</span> <span class="toctext">エンドポイントのCORSが未対応</span></a></li>
<li class="toclevel-4 tocsection-45"><a href="togostanza_js.html#SPARQL.E3.81.AE.E7.B5.90.E6.9E.9C.E3.81.8C.E3.82.A8.E3.83.A9.E3.83.BC"><span class="tocnumber">6.2.1.2</span> <span class="toctext">SPARQLの結果がエラー</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-46"><a href="togostanza_js.html#js.E3.81.AE.E8.A8.98.E8.BF.B0.E3.82.A8.E3.83.A9.E3.83.BC"><span class="tocnumber">6.2.2</span> <span class="toctext">jsの記述エラー</span></a></li>
<li class="toclevel-3 tocsection-47"><a href="togostanza_js.html#.E3.83.86.E3.83.B3.E3.83.97.E3.83.AC.E3.83.BC.E3.83.88.E3.83.95.E3.82.A1.E3.82.A4.E3.83.AB.28handlebars.29.E3.81.AE.E8.A8.98.E8.BF.B0.E3.82.A8.E3.83.A9.E3.83.BC"><span class="tocnumber">6.2.3</span> <span class="toctext">テンプレートファイル(handlebars)の記述エラー</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-48"><a href="togostanza_js.html#js_.E3.83.A9.E3.82.A4.E3.83.96.E3.83.A9.E3.83.AA.E3.81.8C.E5.8B.95.E3.81.8B.E3.81.AA.E3.81.84"><span class="tocnumber">6.3</span> <span class="toctext">js ライブラリが動かない</span></a>
<ul>
<li class="toclevel-3 tocsection-49"><a href="togostanza_js.html#jQuery.E3.83.97.E3.83.A9.E3.82.B0.E3.82.A4.E3.83.B3.E3.81.A8.E3.81.97.E3.81.A6.E4.BD.9C.E6.88.90.E3.81.95.E3.82.8C.E3.81.9F.E3.83.A9.E3.82.A4.E3.83.96.E3.83.A9.E3.83.AA"><span class="tocnumber">6.3.1</span> <span class="toctext">jQueryプラグインとして作成されたライブラリ</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-50"><a href="togostanza_js.html#.E6.B3.A8.E6.84.8F.E4.BA.8B.E9.A0.85"><span class="tocnumber">7</span> <span class="toctext">注意事項</span></a>
<ul>
<li class="toclevel-2 tocsection-51"><a href="togostanza_js.html#js.E3.81.AE.E7.AB.B6.E5.90.88_.28ts_v0.0.8.E4.BB.A5.E5.89.8D.29"><span class="tocnumber">7.1</span> <span class="toctext">jsの競合 (ts v0.0.8以前)</span></a></li>
<li class="toclevel-2 tocsection-52"><a href="togostanza_js.html#.E6.8F.8F.E7.94.BB.E3.83.A9.E3.82.A4.E3.83.96.E3.83.A9.E3.83.AA"><span class="tocnumber">7.2</span> <span class="toctext">描画ライブラリ</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-53"><a href="togostanza_js.html#Web_Components_v1_.E5.AF.BE.E5.BF.9C.E3.81.A8_jQuery_.E6.8E.92.E9.99.A4"><span class="tocnumber">8</span> <span class="toctext">Web Components v1 対応と jQuery 排除</span></a>
<ul>
<li class="toclevel-2 tocsection-54"><a href="togostanza_js.html#v1.E5.AF.BE.E5.BF.9C"><span class="tocnumber">8.1</span> <span class="toctext">v1対応</span></a></li>
<li class="toclevel-2 tocsection-55"><a href="togostanza_js.html#jQuery.E6.8E.92.E9.99.A4"><span class="tocnumber">8.2</span> <span class="toctext">jQuery排除</span></a></li>
<li class="toclevel-2 tocsection-56"><a href="togostanza_js.html#.E3.83.86.E3.82.B9.E3.83.88.E7.94.A8.E3.83.90.E3.82.A4.E3.83.8A.E3.83.AA.E3.80.81.E3.82.BD.E3.83.BC.E3.82.B9"><span class="tocnumber">8.3</span> <span class="toctext">テスト用バイナリ、ソース</span></a></li>
</ul>
</li>
</ul>
</td></tr></table><script>if (window.showTocToggle) { var tocShowText = "表示"; var tocHideText = "非表示"; showTocToggle(); } </script>
<h1> <span class="mw-headline" id=".E6.B3.A8.E6.84.8F">注意</span></h1>
<ul><li> 現在 ts v.0.0.8以前とv0.0.9以降の記述が混在してます
<ul><li> v0.0.8以前：Web components v0 と jQuery
<ul><li> ページ全体でのjQueryの競合に注意が必要
</li><li> web components v0 非対応ブラウザ (iOS等) で表示されない
</li></ul>
</li><li> v0.0.9以降：Web components v1 (jQuery無し)
<ul><li> jQuery を使っていないので、親要素で jQuery を使っても競合しない
</li><li> Stanza 内で jQuery のコードを使う場合には、別途 _header.html で jQuery を読み込む必要がある。その場合は競合に注意
</li><li> iOSでも表示できる
</li></ul>
</li></ul>
</li></ul>
<h1> <span class="mw-headline" id="Ruby.E7.89.88.E3.81.A8.E3.81.AE.E6.AF.94.E8.BC.83">Ruby版との比較</span></h1>
<h2> <span class="mw-headline" id=".E9.95.B7.E6.89.80">長所</span></h2>
<ul><li>習得言語がJavaScriptだけでよい
</li><li>依存環境が少なく環境構築が楽(Ruby版は依存パッケージのインストールが必要)。
</li><li>公開にあたって独自サービスが不要(Ruby版はRackサーバ上で動作し、Apacheの場合にはさらにPhusion Passengerが必要)。
</li><li>iframeを使用しないので、SEOでスタンザコンテンツだけが検索にヒットしてしまうことがない。
</li></ul>
<h2> <span class="mw-headline" id=".E7.9F.AD.E6.89.80">短所</span></h2>
<ul><li>SPARQL発行先エンドポイントがCORS対応している必要がある。<a href="http://wiki.lifesciencedb.jp/mw/SPARQLthon/togostanza_js#.E3.82.A8.E3.83.B3.E3.83.89.E3.83.9D.E3.82.A4.E3.83.B3.E3.83.88.E3.81.8CCORS.E5.AF.BE.E5.BF.9C.E3.81.95.E3.82.8C.E3.81.A6.E3.81.84.E3.82.8B.E3.81.8B" class="external text" rel="nofollow">エンドポイントがCORS対応されているか</a>
</li><li>スタンザを埋め込むページ全体でjsの競合に注意する必要がある。 <a href="http://wiki.lifesciencedb.jp/mw/SPARQLthon/togostanza_js#js.E3.81.AE.E7.AB.B6.E5.90.88" class="external text" rel="nofollow">jsの競合</a>, <a href="http://wiki.lifesciencedb.jp/mw/SPARQLthon/togostanza_js#Web_Components_v1_.E5.AF.BE.E5.BF.9C.E3.81.A8_jQuery_.E6.8E.92.E9.99.A4" class="external text" rel="nofollow">Web Components v1 対応と jQuery 排除</a>
</li><li>高機能な可視化ライブラリで表示が崩れる場合がある<a href="http://wiki.lifesciencedb.jp/mw/SPARQLthon/togostanza_js#.E6.8F.8F.E7.94.BB.E3.83.A9.E3.82.A4.E3.83.96.E3.83.A9.E3.83.AA" class="external text" rel="nofollow">描画ライブラリ</a>
</li><li>ifameの替わりにWeb Components(ShadowDOM, HTML imports)を使用しているため、対応が完全ではないブラウザ等では Polyfill (<a href="https://github.com/webcomponents/webcomponentsjs" class="external text" rel="nofollow">webcomponentsjs</a>) 等の代替え技術により表示するので若干の表示崩れがある
<ul><li> <a href="https://caniuse.com/#feat=shadowdom" class="external text" rel="nofollow">Shadow DOM v0 ブラウザ対応状況</a>
<ul><li> ts v0.0.8まで
</li><li> ブラウザがサポートしないので、ほぼPolyfillで対応
</li></ul>
</li><li> <a href="https://caniuse.com/#feat=shadowdomv1" class="external text" rel="nofollow">Shadow DOM v1 ブラウザ対応状況</a>
<ul><li> ts v0.0.9から
</li></ul>
</li><li> <a href="https://caniuse.com/#feat=imports" class="external text" rel="nofollow">HTML imports ブラウザ対応状況</a>
<ul><li> HTML imports は非推奨になり、ブラウザでサポートされなくなるので、 Polyfill で対応 (Chromeは74で HTML imports を削除）
<ul><li> Polyfill は webcomponentsjs v1.x系のみ。 v2.xでは HTML imports の Polyfill が削除された
</li></ul>
</li><li> 今後は <a href="https://caniuse.com/#search=modules" class="external text" rel="nofollow">ES modules, import()</a> に移行？
<ul><li> ts を ES modules で実装しなおすと、今まで &lt;link rel="import" href="...&gt; としていたところを &lt;script type="module" src="...&gt; と変えなきゃならないので、互換性が無くなる
</li><li> そもそも Polyfill 上で HTML imports の代替は ES modules で実装されている
</li></ul>
</li></ul>
</li></ul>
</li></ul>
<h1> <span class="mw-headline" id=".E3.82.B5.E3.83.B3.E3.83.97.E3.83.AB.E3.82.B3.E3.83.BC.E3.83.89">サンプルコード</span></h1>
<p>このページに記述しているスタンザ例のコードの一部は以下のリポジトリからダウンロード可能で、動作確認ができます。
<a href="https://github.com/okbp/ts_samples" class="external text" rel="nofollow">サンプルコードのリポジトリ</a>
</p>
<h1> <span class="mw-headline" id=".E5.88.9D.E3.82.81.E3.81.A6.E3.81.AEts">初めてのts</span></h1>
<h2> <span class="mw-headline" id=".E3.83.89.E3.82.AD.E3.83.A5.E3.83.A1.E3.83.B3.E3.83.88">ドキュメント</span></h2>
<p><a href="https://github.com/togostanza/ts/blob/master/doc/Getting-Started.md" class="external text" rel="nofollow">Getting-Started</a><br />
<a href="https://github.com/togostanza/ts/blob/master/doc/Reference.md" class="external text" rel="nofollow">Reference</a><br />
</p>
<h2> <span class="mw-headline" id=".E3.82.B9.E3.82.BF.E3.83.B3.E3.82.B6.E4.BD.9C.E6.88.90.E5.89.8D.E3.81.AE.E7.A2.BA.E8.AA.8D">スタンザ作成前の確認</span></h2>
<p>スタンザを作成する前に、以下のことを確認しておく必要があります。
</p>
<h3> <span class="mw-headline" id=".E3.82.A8.E3.83.B3.E3.83.89.E3.83.9D.E3.82.A4.E3.83.B3.E3.83.88.E3.81.8CCORS.E5.AF.BE.E5.BF.9C.E3.81.95.E3.82.8C.E3.81.A6.E3.81.84.E3.82.8B.E3.81.8B">エンドポイントがCORS対応されているか</span></h3>
<p>tsはjavascriptでエンドポイントにアクセスするため、tsを動かすWebサーバとエンドポイントのドメインが異なる場合にCross-Origin(CORS)エラーが発生します。<br />
</p>
<ul><li>確認方法
</li></ul>
<p>自分でjavascriptを書いてもいいですが、最も手軽な方法として、d3sparql.jsのデモアプリが利用できます。<br />
<a href="http://biohackathon.org/d3sparql/" class="external text" rel="nofollow">d3sparql.js</a> のページ上の [ Table ] -[ d3htmltable ] をクリック。<br />
SPARQL endpoint:の欄に確認したいエンドポイントURLを入力して、必ず値が返ってくる以下のようなクエリを実行
</p>
<pre>
SELECT * { &nbsp;?s&nbsp;?p&nbsp;?o } LIMIT 10
</pre>
<p>データが表示されればエンドポイントのCORS対応がされています。<br />
表示されない場合、ブラウザのデバッグツールを開いて、'Access-Control-Allow-Origin'というようなエラーメッセージが出ている場合にはエンドポイントの設定が必要です。<br />
Virtuosoの場合には右のサイト等を参考にCORS設定してください。<a href="http://ods.openlinksw.com/dataspace/doc/dav/wiki/Main/VirtTipsAndTricksCORsEnableSPARQLURLs" class="external text" rel="nofollow">マニュアル(英語)</a> <a href="http://qiita.com/misshie@github/items/f603bf5a3971ab576907" class="external text" rel="nofollow">三嶋さんブログ</a> <br />
Apacheなどのフロントサーバを介している場合にはそちらの設定が必要です。
</p>
<h3> <span class="mw-headline" id=".E3.82.A8.E3.83.B3.E3.83.89.E3.83.9D.E3.82.A4.E3.83.B3.E3.83.88.E3.81.8CCORS.E5.AF.BE.E5.BF.9C.E3.81.95.E3.82.8C.E3.81.A6.E3.81.84.E3.81.AA.E3.81.84.E5.A0.B4.E5.90.88">エンドポイントがCORS対応されていない場合</span></h3>
<p>外部管理のCORS対応されていない Endpoint を togostanza で呼び出したい場合は、SPARQList を立てて、経由することでアクセスできます。<a href="http://wiki.lifesciencedb.jp/mw/SPARQLthon/togostanza_js#SPARQList" class="external text" rel="nofollow">下記参照</a>
</p>
<ul><li> SPARQList のSPARQL クエリは SPARQList が動いているサーバー側で処理されるので、CORSエラーは出ません
</li></ul>
<h3> <span class="mw-headline" id=".E7.99.BA.E8.A1.8C.E3.81.99.E3.82.8BSPARQL.E3.81.8C.E6.AD.A3.E3.81.97.E3.81.84.E3.81.8B.28.E5.80.A4.E3.81.8C.E8.BF.94.E3.81.A3.E3.81.A6.E3.81.8F.E3.82.8B.E3.81.8B.29">発行するSPARQLが正しいか(値が返ってくるか)</span></h3>
<p>エラーが発生した場合の切り分けが楽なので、スタンザで使用するクエリが間違いなく返ってくるか、事前に確認しておく方がオススメです。
</p>
<h2> <span class="mw-headline" id=".E3.82.A4.E3.83.B3.E3.82.B9.E3.83.88.E3.83.BC.E3.83.AB">インストール</span></h2>
<p>tsはバイナリのモジュールを<a href="https://github.com/togostanza/ts/releases" class="external text" rel="nofollow">サイト</a>からダウンロードしてPATHを通すだけです。<br />
あとは<a href="https://github.com/togostanza/ts/blob/master/doc/Getting-Started.md" class="external text" rel="nofollow">ドキュメント</a>に沿って、一つスタンザを作成してみてtsサーバを立ち上げてみるとインストールされたことが確認できます。
</p>
<pre>
$ mkdir my_provider //作業用ディレクトリを作成
$ cd my_provider
$ ts new hello //&quot;hello&quot;という名前の新規スタンザを作成
$ ts server //tsサーバを起動(デフォルトポート8080)
</pre>
<p>この状態で<a href="http://localhost:8080/stanza/" class="external free" rel="nofollow">http://localhost:8080/stanza/</a> にアクセスすると、スタンザリストが見えます。helloをクリックすると、スタンザ(のヘルプページ)が表示されます。<br />
Ctrl + c でtsサーバを停止できます。
</p>
<h2> <span class="mw-headline" id=".E3.82.B9.E3.82.BF.E3.83.B3.E3.82.B6.E4.BD.9C.E6.88.90">スタンザ作成</span></h2>
<p><a href="https://github.com/togostanza/ts/blob/master/doc/Getting-Started.md" class="external text" rel="nofollow">ドキュメント</a>にあるとおり、ts new &lt;スタンザ名&gt;で作成コマンドを打つと、スタンザ名のディレクトリと中に自動でいくつかファイル群が生成されますので、それらを編集したりファイルを追加したりしてお好みのスタンザを作ります。<br />
ドキュメントの最後にあるSPARQLを使用した例"Issue SPARQL query"のorganism-nameスタンザコードはこちらにあります。<a href="https://github.com/okbp/ts_samples/tree/master/organism-name" class="external text" rel="nofollow">organism-name</a>
</p>
<h1> <span class="mw-headline" id="How_To">How To</span></h1>
<h2> <span class="mw-headline" id="SPARQL_result.E3.83.87.E3.83.BC.E3.82.BF.E3.81.AE.E5.8A.A0.E5.B7.A5">SPARQL resultデータの加工</span></h2>
<p>stanza.query()を実行すると、SPARQLのresultは仕様で定められたjson(<a href="https://www.w3.org/TR/sparql11-results-json/" class="external text" rel="nofollow">SPARQL 1.1 Query Results JSON Format</a>)形式で返ってきます。<br />
</p>
<ul><li>resultデータをそのまま使用する
</li><li>resultデータからbindingsオブジェクトを辿る
</li><li>resultデータからstanza.unwrapValueFromBinding()を使用してkey-valueにデータを展開する。※この場合はcolumnの型は失われる
</li></ul>
<p>の三通りの扱いができます。<br />
動作確認はサンプルコードで行えます<a href="https://github.com/okbp/ts_samples/tree/master/handling-query-result" class="external text" rel="nofollow">handling-query-result</a>
</p>
<ul><li>templates/stanza.rq
</li></ul>
<pre>
SELECT *
{
 ?s&nbsp;?p&nbsp;?o
} LIMIT 2
</pre>
<ul><li>index.js
</li></ul>
<pre>
Stanza(function(stanza, params) {
  var q = stanza.query({
    endpoint: &quot;http://integbio.jp/rdf/sparql&quot;,
    template: &quot;stanza.rq&quot;,
    parameters: params
  });
  q.then(function(data) {
    var raw_data = JSON.stringify(data);
    var bindings = data.results.bindings;
    var bindings_json = JSON.stringify(data.results.bindings);
    var unwrap = stanza.unwrapValueFromBinding(data);
    var unwrap_json = JSON.stringify(stanza.unwrapValueFromBinding(data));
    stanza.render({
      template: &quot;stanza.html&quot;,
      parameters: {
        raw_data: raw_data,
        bindings: bindings,
        bindings_json: bindings_json,
        unwrap: unwrap,
        unwrap_json: unwrap_json
      },
    });
  });
});:
</pre>
<ul><li>templates/stanza.html
</li></ul>
<pre>
&lt;style&gt;
table {
  width: 400px;
  border: 2px #2b2b2b solid;
  border-collapse: collapse;
}
th {
  background-color: #ffd78c;
}
td, th {
  border: 2px #2b2b2b solid;
}
&lt;/style&gt;

&lt;h3&gt;raw_data&lt;/h3&gt;
{{raw_data}}
&lt;h3&gt;bindings&lt;/h3&gt;
{{bindings_json}}
&lt;table&gt;
  &lt;th&gt;s&lt;/th&gt;
  &lt;th&gt;p&lt;/th&gt;
  &lt;th&gt;o&lt;/th&gt;
  {{#each bindings}}
  &lt;tr&gt;
    &lt;td&gt;
      {{s.value}}
    &lt;/td&gt;
    &lt;td&gt;
      {{p.value}}
    &lt;/td&gt;
    &lt;td&gt;
      {{o.value}}
    &lt;/td&gt;
  {{/each}}
&lt;/table&gt;

&lt;h3&gt;unwrap&lt;/h3&gt;
{{unwrap_json}}
&lt;table&gt;
  &lt;th&gt;s&lt;/th&gt;
  &lt;th&gt;p&lt;/th&gt;
  &lt;th&gt;o&lt;/th&gt;
  {{#each unwrap}}
  &lt;tr&gt;
    &lt;td&gt;
      {{s}}
    &lt;/td&gt;
    &lt;td&gt;
      {{p}}
    &lt;/td&gt;
    &lt;td&gt;
      {{o}}
    &lt;/td&gt;
  {{/each}}
&lt;/table&gt;
</pre>
<h2> <span class="mw-headline" id=".E3.83.9A.E3.83.BC.E3.82.B8.E3.81.AE.E3.82.A4.E3.83.99.E3.83.B3.E3.83.88.E3.82.92.E5.8F.97.E3.81.91.E5.8F.96.E3.82.8B">ページのイベントを受け取る</span></h2>
<p>スタンザ描画後に、ユーザのクリックなどのイベントを受け取る方法を紹介します。サンプルコード<a href="https://github.com/okbp/ts_samples/tree/master/event_listener" class="external text" rel="nofollow">event_listener</a><br />
eventを設定するにはhtmlがレンダリングされた後である必要があるので、stanza.render()と同じ階層に書いてください。<br />
エレメントの取得にはstanza.select()を使用します。
</p>
<ul><li>index.js
</li></ul>
<pre>
Stanza(function(stanza, params) {
  var q = stanza.query({
      endpoint: &quot;http://integbio.jp/rdf/sparql&quot;,
      template: &quot;stanza.rq&quot;,
      parameters: params
  });

  q.then(function(data) {
    stanza.render({
      template: &quot;stanza.html&quot;,
    });
    //プルダウンリストを初期値の値にセット
    $(stanza.select('#current_value')).html(stanza.select('#select1').value);

    //use plain javascript
    stanza.select('#button1').addEventListener(&quot;click&quot;, function(e) {
      alert('button is clicked!');
    });

    //use jQuery (ts v0.0.8 以前)
    $(stanza.select('#select1')).on('change', function(e) {
      $(stanza.select('#current_value')).empty();
      $(stanza.select('#current_value')).html(stanza.select('#select1').value);
    });
  });
});
</pre>
<ul><li>templates/stanza.html
</li></ul>
<pre>
&lt;button type=&quot;button&quot; id=&quot;button1&quot; value=&quot;aaa&quot;&gt;
Click!
&lt;/button&gt;

&lt;select id='select1'&gt;
  &lt;option value='value1'&gt;Value1&lt;/option&gt;
  &lt;option value='value2'&gt;Value2&lt;/option&gt;
&lt;/select&gt;
&lt;div&gt;Current value: &lt;span id='current_value'&gt;&lt;/span&gt;&lt;/div&gt;
</pre>
<h2> <span class="mw-headline" id=".E8.A4.87.E6.95.B0.E3.81.AESPARQL.E3.81.AE.E5.AE.9F.E8.A1.8C">複数のSPARQLの実行</span></h2>
<h3> <span class="mw-headline" id=".E8.A4.87.E6.95.B0.E3.82.AF.E3.82.A8.E3.83.AA.E3.81.AE.E9.A0.86.E6.AC.A1.E5.AE.9F.E8.A1.8C">複数クエリの順次実行</span></h3>
<p>あるクエリの結果を使って、次のクエリを組み立てて実行する場合、前のクエリの結果を受け取るfunctionで次のクエリを組み立てることになります。<br />
サンプルコードは<a href="https://github.com/okbp/ts_samples/tree/master/sequential-query" class="external text" rel="nofollow">sequential-query</a>にあります。
</p>
<ul><li>index.js
</li></ul>
<pre>
Stanza(function(stanza, params) {
  //一つ目のクエリの実行
  var q1 = stanza.query({
    endpoint: &quot;http://integbio.jp/rdf/sparql&quot;,
    template: &quot;query1.rq&quot;,
    parameters: params
  });
  //一つ目のクエリの終了イベント
  q1.then(function(data){
    //一つ目のクエリの実行結果を取得して、次のクエリのパラメータにする
    var first_item = data.results.bindings[0];
    var subject_value = first_item.s.value;
    //二つ目のクエリの実行
    var q2 = stanza.query({
      endpoint: &quot;http://integbio.jp/rdf/sparql&quot;,
      template: &quot;query2.rq&quot;,
      parameters: {
        subject: subject_value
      }
    });
    //二つ目のクエリの終了イベント
    q2.then(function(data){
      var result_list = data.results.bindings;
      //結果を表示
      stanza.render({
        template: &quot;stanza.html&quot;,
        parameters: {
          subject: subject_value,
          result: result_list
        }
      });
    });
  });
});
</pre>
<ul><li>query1.rq
</li></ul>
<pre>
SELECT&nbsp;?s&nbsp;?p&nbsp;?o
WHERE
{
 &nbsp;?s&nbsp;?p&nbsp;?o
} LIMIT 10
</pre>
<ul><li>query2.rq
</li></ul>
<pre>
SELECT&nbsp;?p&nbsp;?o
WHERE
{
  &lt;{{subject}}&gt;&nbsp;?p&nbsp;?o
}
</pre>
<h3> <span class="mw-headline" id=".E8.A4.87.E6.95.B0.E3.82.AF.E3.82.A8.E3.83.AA.E3.81.AE.E4.B8.A6.E5.88.97.E5.AE.9F.E8.A1.8C">複数クエリの並列実行</span></h3>
<p>複数のクエリがお互いに関係せず並列実行できる場合にはv0.0.8 以前はjQueryのwhen()メソッドが、v0.0.9以降はPromiseが使えます。<br />
$.when()を使った場合、then()のfunction引数には発行した数のクエリ結果の引数が渡されますが、実際のSPARQLクエリ結果はこれらの変数の配列[0]に格納されていることに注意してください。<br />
サンプルコードは<a href="https://github.com/okbp/ts_samples/tree/master/parallel-query" class="external text" rel="nofollow">parallel-query</a>にあります。
</p>
<ul><li>index.js
</li><li>ts v0.0.8以前
</li></ul>
<pre>
Stanza(function(stanza, params) {
  //コード可読性のために、クエリオブジェクトを変数に定義
  var query1 = {
    endpoint: &quot;http://integbio.jp/rdf/sparql&quot;,
    template: &quot;query1.rq&quot;,
    parameters: params
  };
  var query2 = {
    endpoint: &quot;http://sparql.uniprot.org/sparql&quot;,
    template: &quot;query2.rq&quot;,
    parameters: params
  };

  //複数クエリの実行
  var q = $.when(stanza.query(query1), stanza.query(query2));
   
  //全てのクエリが終了した時点で実行され、発行したクエリの数の引数が渡される
  q.then(function(data1, data2) { 
    //data1ではなく、data1[0]でSPARQL結果が取得できる 
    var query1_list = data1[0].results.bindings;
    var query2_list = data2[0].results.bindings;
    var all_list = query1_list.concat(query2_list);
    stanza.render({
      template: &quot;stanza.html&quot;,
      parameters: {
        result: all_list
      }
    });
  });
});
</pre>
<ul><li>ts v0.0.9以降
</li></ul>
<pre>
Stanza(function(stanza, params) {
  // SPARQL query 1
  var q1 = stanza.query({
    endpoint: &quot;http://exapmle.org/sparql&quot;,
    template: &quot;query1.rq&quot;,
    parameters: params
  });
  // SPARQL query 2
  var q2 = stanza.query({
    endpoint: &quot;http://example.com/sparql&quot;,
    template: &quot;query2.rq&quot;,
    parameters: params
  });

    var q = Promise.all([q1, q2]);

    q.then(function([data1, data2]){
    // jQuery の $.when() と違い data1[0] ではなく、data1 で SPARQL 結果が取得できる 
    var query1_list = data1.results.bindings;
    var query2_list = ......略
　　.......
    stanza.render({
      template: &quot;stanza.html&quot;,
      parameters: {
        result: all_list
      }
    });
  });
});
</pre>
<ul><li>query1,rq, query2.rq (どちらも同じ内容)
</li></ul>
<pre>
SELECT *
WHERE
{
 ?s&nbsp;?p&nbsp;?o
} LIMIT 10
</pre>
<h2> <span class="mw-headline" id="SPARQL.E4.BB.A5.E5.A4.96.E3.81.AEAPI.E5.91.BC.E3.81.B3.E5.87.BA.E3.81.97">SPARQL以外のAPI呼び出し</span></h2>
<h3> <span class="mw-headline" id="jQuery">jQuery</span></h3>
<ul><li> v0.0.8以前
</li></ul>
<pre>
    var q = $.ajax({
      url: &quot;http://example.of/api/url&quot;,
      method: 'get',
      data: {
        key1: value1,
        key2: value2
      }
    });
</pre>
<h3> <span class="mw-headline" id="fetch">fetch</span></h3>
<pre>
    var q = fetch( &quot;http://example.of/api/url?key1=value1&amp;key2=value2&quot;, { method: 'get'} );
</pre>
<h3> <span class="mw-headline" id="SPARQList">SPARQList</span></h3>
<ul><li> SPARQList で SPARQL 処理を全部やって、結果を受け取ってtemplateのhtmlに渡すだけの index.js
<ul><li> 'POST' は SPARQList ver. 2018-02-20 以降。それ以前の ver. なら 'GET' を使いましょう
</li></ul>
</li></ul>
<pre>
Stanza(function(stanza, params) {
    var formBody = [];
    for (var key in params) {
	if(params[key]) formBody.push(key + &quot;=&quot; + encodeURIComponent(params[key]));
    }
    var options = {
	method: &quot;POST&quot;,
	mode:  &quot;cors&quot;,
	body: formBody.join(&quot;&amp;&quot;),
	headers: {
	    &quot;Accept&quot;: &quot;application/json&quot;,	    
	    'Content-Type': 'application/x-www-form-urlencoded'
	}
    };
    var url = &quot;http://example.of/sparqlist/url&quot;;
    var q = fetch(url, options).then(res =&gt; res.json());
    q.then(function(data){
	stanza.render({
	    template: &quot;stanza.html&quot;,
	    parameters: {
		result: data
	    }
	});
    });
});
</pre>
<h2> <span class="mw-headline" id="Style.28css.29.E3.81.AE.E9.81.A9.E7.94.A8">Style(css)の適用</span></h2>
<p>スタンザに対してStyleを適用する方法を紹介します。<br />
デフォルトでも少しデザインが指定されています。この内容を確認したい場合には、ブラウザのデバッグツールを使用して、スタンザの構成エレメント(
shadow rootの直下)に&lt;style&gt;と&lt;main&gt;があるので、この&lt;style&gt;のcssを参照します。<br />
以下に紹介するStyleの適用は、デフォルトの指定にStyleを追加する方法です。<br />
これらは各スタンザ内だけに適用され、他のスタンザには影響しません。
</p>
<h3> <span class="mw-headline" id="templates.E3.83.95.E3.82.A1.E3.82.A4.E3.83.AB.E3.81.B8.E3.81.AE.E8.A8.98.E8.BF.B0">templatesファイルへの記述</span></h3>
<p>index.jsのrenderで指定したtemplateのhtmlファイルに&lt;style&gt;要素を記述すれば適用されます。<br />
サンプルコードはこちらで確認できます。<a href="https://github.com/okbp/ts_samples/tree/master/apply-style" class="external text" rel="nofollow">apply-style</a>
</p>
<ul><li>index.js
</li></ul>
<pre>
stanza.render({
    template: &quot;stanza.html&quot;,  //指定したtemplateファイル
    parameters: {
      greeting: &quot;Hello, world!&quot;
    }
  });
</pre>
<ul><li>stanza.html
</li></ul>
<pre>
&lt;style&gt;
table {
  width: 400px;
  border: 2px #2b2b2b solid;
  border-collapse: collapse;
}
th {
  background-color: #ffd78c;
}
td, th {
  border: 2px #2b2b2b solid;
}
&lt;/style&gt;

&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;th&gt;column&lt;/th&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;row 1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;row 2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;  
      &lt;td&gt;row 3&lt;/td&gt;
    &lt;/tr&gt; 
  &lt;/tbody&gt;
&lt;/table&gt;
</pre>
<h3> <span class="mw-headline" id="css.E3.83.95.E3.82.A1.E3.82.A4.E3.83.AB.E3.81.AE.E9.81.A9.E7.94.A8">cssファイルの適用</span></h3>
<p>&lt;style&gt;要素ではなく、cssファイルを読み込んで指定したい場合には、次のような方法があります。<br />
サンプルコードはこちらで確認できます。<a href="https://github.com/okbp/ts_samples/tree/master/apply-css" class="external text" rel="nofollow">apply-css</a> <br />
表示templateのhtmlファイルに&lt;style&gt;タグを追加して、cssをインポートします。<br />
cssのファイルは公開されている必要があり、URLを絶対パスを指定します。stanzaのassetsに置いた非公開cssもimportはできますが、stanzaの埋め込み先URLからの相対パス指定になってしまうため、うまく適用できない場合がありオススメできません。<br />
</p>
<ul><li>templates/stanza.html
</li></ul>
<pre>
&lt;style&gt;
  @import url('http://www.coolwebwindow.com/temp/source/simple/sim001_blue/src/css/common.css');
&lt;/style&gt;

&lt;table&gt;
  &lt;a href=&quot;http://www.coolwebwindow.com/temp/source/simple/sim001_blue/src/css/common.css&quot;&gt;Download applied css file&lt;/a&gt;
&lt;/table&gt;
</pre>
<h2> <span class="mw-headline" id=".E5.85.AC.E9.96.8B.E3.81.95.E3.82.8C.E3.81.9Fjs.E3.81.AE.E3.83.AD.E3.83.BC.E3.83.89">公開されたjsのロード</span></h2>
<p>外部公開されたjsファイルを取り込むには、"_header.html"という名前のファイルを作成して&lt;script&gt;タグを記述してロードしたいjsを指定します。<br />
d3を使用したサンプルコードは<a href="https://github.com/okbp/ts_samples/tree/master/d3-sample" class="external text" rel="nofollow">d3-sample</a>にあります。<br />
</p>
<pre>
&lt;script src=&quot;http://d3js.org/d3.v3.min.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;
</pre>
<p>注意点は、指定したjsはグローバル環境に適用されるため、記述したスタンザだけでなく、他のスタンザやスタンザを保有するページ全体に影響することで、お互いが競合する関係にあるjsの場合には、衝突してしまって不具合が出る可能性があります。詳しくは<a href="http://wiki.lifesciencedb.jp/mw/SPARQLthon/togostanza_js#js.E3.81.AE.E7.AB.B6.E5.90.88" class="external text" rel="nofollow">jsの競合</a>も参照してください。<br />
</p><p><br />
ロードすればindex.jsでd3のオブジェクトを使用できます。<br />
d3の描画対象のelementについては、getElementById('chart')やjQueryの$('#chart')ではelementを拾えないため、stanza.select()を使用します。<a href="https://github.com/togostanza/ts/blob/master/doc/Reference.md#stanzaselectselectors" class="external text" rel="nofollow">参照</a>
</p>
<ul><li>index.js
</li></ul>
<pre>
Stanza(function(stanza, params) {
  stanza.render({
    template: &quot;stanza.html&quot;
  });

  //描画用関数 引数に描画対象のelementを指定する
  var draw = (function(elem){
    var margin = {top: 40, right: 20, bottom: 30, left: 40},
        width = 800 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;

    //(中略)

    //指定されたelementに描画する。    
    var svg = d3.select(elem).append(&quot;svg&quot;)

    //(中略)

  });
  //描画の実行。elementの指定には、stanza.select()を利用する。
  draw(stanza.select('#chart'));
});
</pre>
<p>描画する要素をhtmlで指定します。
</p>
<ul><li>templates/stanza.html
</li></ul>
<pre>
&lt;div id=&quot;chart&quot;&gt;&lt;/div&gt;
</pre>
<h2> <span class="mw-headline" id=".E9.9D.9E.E5.85.AC.E9.96.8B.28.E7.8B.AC.E8.87.AA.E4.BD.9C.E6.88.90.29js.E3.83.95.E3.82.A1.E3.82.A4.E3.83.AB.E3.81.AE.E3.83.AD.E3.83.BC.E3.83.89">非公開(独自作成)jsファイルのロード</span></h2>
<p>できません。。。<br />
スタンザのassetsディレクトリに非公開のjsを書いて_header.htmlでロードするように記述すれば出来そうな気がしましたが、スタンザを埋め込む先のURLを起点とした相対パスになってしまうので、うまく動かない場合が多く、オススメできません。
</p>
<h2> <span class="mw-headline" id=".E7.94.BB.E5.83.8F.E3.81.AE.E9.85.8D.E7.BD.AE">画像の配置</span></h2>
<p>公開されている画像であれば&lt;img&gt;タグのsrcにURLを書けばよいですが、スタンザ独自の画像ファイルを使用したい場合には、assetsディレクトリを作成して画像ファイルを置くと表示templateのhtmlファイルから参照できます。
</p>
<ul><li>assets/message.jpg に画像を配置
</li><li>template/stanza.html
</li></ul>
<pre>
&lt;p&gt;{{message}}&lt;/p&gt;
&lt;img src=&quot;./assets/message.jpg&quot;&gt;
</pre>
<h2> <span class="mw-headline" id=".E3.82.B9.E3.82.BF.E3.83.B3.E3.82.B6.E3.81.AE.E5.86.8D.E5.AE.9F.E8.A1.8C.28.E3.83.AA.E3.83.AD.E3.83.BC.E3.83.89.29">スタンザの再実行(リロード)</span></h2>
<p>スタンザを一度描画した後にユーザイベント(クリック)等によってコンテンツを修正するには<a href="http://wiki.lifesciencedb.jp/mw/SPARQLthon/togostanza_js#.E3.83.9A.E3.83.BC.E3.82.B8.E3.81.AE.E3.82.A4.E3.83.99.E3.83.B3.E3.83.88.E3.82.92.E5.8F.97.E3.81.91.E5.8F.96.E3.82.8B" class="external text" rel="nofollow">ページのイベント受け取る</a>で対応可能ですが、イベントによって大幅な書き換えが必要で、再度スタンザを読み込んだほうが早い、といったケースでのスタンザ更新方法を紹介します。<br />
スタンザのリロード(技術的にはリロードではありませんが)はスタンザを埋め込んでいるページのスタンザ描画タグ(参照<a href="http://wiki.lifesciencedb.jp/mw/SPARQLthon/togostanza_js#.E3.82.B9.E3.82.BF.E3.83.B3.E3.82.B6.E3.81.AE.E5.9F.8B.E3.82.81.E8.BE.BC.E3.81.BF" class="external text" rel="nofollow">スタンザの埋め込み</a>)を置き換えることで実現できます。<br />
サンプルコードはで<a href="https://github.com/okbp/ts_samples/tree/master/redo-stanza" class="external text" rel="nofollow">redo-stanza</a>確認できます。
</p>
<ul><li>template/stanza.html
</li></ul>
<pre>
Current position: {{start}} - {{end}}&lt;br/&gt;
From: &lt;input type=&quot;text&quot; id=&quot;txt_from&quot; value=&quot;{{start}}&quot;&gt; To: &lt;input type=&quot;text&quot; id=&quot;txt_to&quot; value=&quot;{{end}}&quot;&gt;
&lt;input type=&quot;button&quot; id=&quot;btn_update&quot; value=&quot;update stanza!&quot;&gt; 
</pre>
<ul><li>index.js
</li></ul>
<pre>
Stanza(function(stanza, params) {
  stanza.render({
    template: &quot;stanza.html&quot;,
    parameters: {
      start: params.start_pos,
      end: params.end_pos
    }
  });
  //ボタン押下時 
  $(stanza.select(&quot;#btn_update&quot;)).on('click', function(){
    //画面で指定された値を取得
    var from = stanza.select(&quot;#txt_from&quot;).value;
    var to = stanza.select(&quot;#txt_to&quot;).value;
    
    //値を引数に指定したタグのhtmlテキストを組み立てる
    var stanza_elem = '&lt;togostanza-redo-stanza start_pos=&quot;' + from + '&quot; end_pos=&quot;' + to + '&quot;&gt;&lt;/togostanza-redo-stanza&gt;'
    //現在の表示スタンザを置き換える
    var current_elem = $(&quot;togostanza-redo-stanza&quot;);//現在のスタンザエレメント idで検索してもよい
    current_elem.before(stanza_elem);//新しいスタンザエレメントの挿入
    current_elem.remove();//古いスタンザエレメントの削除
  });
});
</pre>
<p>注意！！ スタンザタグの属性(attribute)を入れ替えたいだけなので、[エレメント].setAttribute('start_pos', from) と記述してもいいように思うかもしれませんが、属性が複数ある場合には挙動がおかしくなるケースがありますのでこの方法は避けるべきです(属性を一つしかとらないスタンザであれば問題無し)。<br />
詳しくはこちらも参照してください。<a href="https://github.com/togostanza/ts/issues/48" class="external text" rel="nofollow">スタンザタグの属性値を複数変更すると、更新イベントが複数回発生する</a>
</p>
<h2> <span class="mw-headline" id=".E3.82.B9.E3.82.BF.E3.83.B3.E3.82.B6.E5.90.8C.E5.A3.AB.E3.81.AE.E9.80.A3.E6.90.BA">スタンザ同士の連携</span></h2>
<p>スタンザは単体で動作することを基本として設計されていますが、”あるスタンザでのイベントを機に別のスタンザの内容を操作したい”といった場合には、<a href="http://wiki.lifesciencedb.jp/mw/SPARQLthon/togostanza_js#.E3.82.B9.E3.82.BF.E3.83.B3.E3.82.B6.E3.81.AE.E5.86.8D.E5.AE.9F.E8.A1.8C.28.E3.83.AA.E3.83.AD.E3.83.BC.E3.83.89.29" class="external text" rel="nofollow">スタンザの再実行(リロード)</a>と同じ方法で、操作したいスタンザのタグを入れ替えて相手のスタンザを更新(実質的リロード)させることで実現できます。<br />
この方法以外にはスタンザ間でメッセージを送り合うようなI/Fは用意されていません。
</p>
<h2> <span class="mw-headline" id=".E3.82.B9.E3.82.BF.E3.83.B3.E3.82.B6.E3.81.AE.E5.85.A5.E3.82.8C.E5.AD.90">スタンザの入れ子</span></h2>
<p>_header.html で呼びたいStanzaを '&lt;link rel="import" href="stanzaのurl"&gt;' でImportしておくだけ
</p>
<h2> <span class="mw-headline" id=".E3.82.B9.E3.82.BF.E3.83.B3.E3.82.B6.E3.81.AE.E5.85.AC.E9.96.8B.E6.96.B9.E6.B3.95">スタンザの公開方法</span></h2>
<h3> <span class="mw-headline" id=".E5.85.AC.E9.96.8B.E3.82.B3.E3.83.B3.E3.83.86.E3.83.B3.E3.83.84.E3.81.AE.E7.94.9F.E6.88.90">公開コンテンツの生成</span></h3>
<p>公開用コンテンツを生成するには、スタンザプロバイダのディレクトリで次のコマンドを打ちます。
</p>
<pre>
$ ts build
</pre>
<p>すると、ディレクトリ配下に"dist"という名前のディレクトリが作成され、その中に各スタンザのコンテンツが作られます。<br />
$ ts serverコマンドでもdistディレクトリは作成されますが、デバッグモードのコンテンツが出力されるため、公開する場合にはts buildコマンドを使ってください<br />
</p>
<ul><li>buildによって作成されるディレクトリ
</li></ul>
<pre>
--dist
     |---stanza
             |---index.html
             |---assets
             |---metadata.json  
             |---apply-css(スタンザディレクトリ) 
             |        |---help.html
             |        |---index.html
             |        |---metadata.json
             | 
             |---(以下各スタンザディレクトリ)
             |---
</pre>
<h3> <span class="mw-headline" id=".E3.82.B9.E3.82.BF.E3.83.B3.E3.82.B6.E3.81.AE.E5.9F.8B.E3.82.81.E8.BE.BC.E3.81.BF">スタンザの埋め込み</span></h3>
<p>ts buildで生成されるコンテンツは、html,json等の静的コンテンツですので、このままApache等のWebサーバのドキュメントディレクトリに配置しても動作します。<br />
任意のスタンザを埋め込んだページを作成するには各stanzaのhelp.htmlが参考になります。<br />
具体的には&lt;link&gt;タグでインポートしたいstanzaの場所を指し、埋め込みたい場所に&lt;togostanza-[スタンザ名]&gt;というタグを記述すると、スタンザが表示されます<br />
</p>
<ul><li>organism-nameとapply-styleの二つのスタンザを埋め込む例
</li></ul>
<pre>
&lt;!DOCTYPE html&gt;

&lt;html&gt;
  &lt;head&gt;
    &lt;script src=&quot;../assets/components/webcomponentsjs/webcomponents.min.js&quot;&gt;&lt;/script&gt; // ts v0.0.8 以前
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@1.3.0/webcomponents-loader.js&quot; crossorigin&gt;&lt;/script&gt; // ts v0.0.9 以降
    &lt;link rel=&quot;import&quot; href=&quot;../organism-name/&quot;&gt;//埋め込みたいスタンザのディレクトリを指定。ディレクトリ後のスラッシュを忘れると Chrome 以外では動かない
    &lt;link rel=&quot;import&quot; href=&quot;../apply-style/&quot;&gt; //複数ある場合には列挙する
    &lt;link rel=&quot;stylesheet&quot; href=&quot;../assets/css/ts.css&quot;&gt;
    &lt;title&gt;Hello Example&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;togostanza-organism-name tax_id=&quot;1148&quot;&gt;&lt;/togostanza-organism-name&gt; //スタンザの埋め込み。togostanza-[スタンザ名]というタグを記載する。 属性で引数を指定する
    &lt;togostanza-apply-style&gt;&lt;/togostanza-apply-style&gt; //他のスタンザの埋め込み
  &lt;/body&gt;

</pre>
<h2> <span class="mw-headline" id="SSL.E5.8C.96_.28https.29_.E6.BA.96.E5.82.99"> SSL化 (https) 準備 </span></h2>
<ul><li> 自分で管理していて、将来的に全てSSL化する予定なら index.js 内の endpoint や api の URL の protocol 部分を自動取得しておくと便利 
</li></ul>
<pre>
    var endpoint = document.location.protocol + &quot;//example.org/endpoint&quot;; // 現在アクセスしているプロトコルを返す 
    var res = fetch(endpoint, oprtions);
</pre>
<h1> <span class="mw-headline" id=".E3.83.88.E3.83.A9.E3.83.96.E3.83.AB.E3.82.B7.E3.83.A5.E3.83.BC.E3.83.86.E3.82.A3.E3.83.B3.E3.82.B0">トラブルシューティング</span></h1>
<h2> <span class="mw-headline" id="ts_server.28build.29.E3.81.8C.E5.8B.95.E3.81.8B.E3.81.AA.E3.81.84">ts server(build)が動かない</span></h2>
<h4> <span class="mw-headline" id=".E3.82.B3.E3.83.9E.E3.83.B3.E3.83.89.E3.82.92.E6.89.93.E3.81.A4.E3.83.87.E3.82.A3.E3.83.AC.E3.82.AF.E3.83.88.E3.83.AA.E3.81.8C.E4.B8.8D.E9.81.A9.E5.88.87">コマンドを打つディレクトリが不適切</span></h4>
<pre>
$ ts server
no stanzas available under /current/your/directory/
</pre>
<p>カレントディレクトリを移動してコマンドを打ち直すか、または-stanza-base-dirパラメータでスタンザのディレクトリを指定できます。
</p>
<pre>
$ ts server -stanza-base-dir /your/stanza/provider/directory/
</pre>
<h4> <span class="mw-headline" id=".E3.83.9D.E3.83.BC.E3.83.88.E3.81.8C.E3.81.99.E3.81.A7.E3.81.AB.E4.BD.BF.E7.94.A8.E3.81.95.E3.82.8C.E3.81.A6.E3.81.84.E3.82.8B.28ts_server.E3.82.B3.E3.83.9E.E3.83.B3.E3.83.89.E3.81.AE.E3.81.BF.29">ポートがすでに使用されている(ts serverコマンドのみ)</span></h4>
<pre>
$ ts server
・・・・・
listen tcp&nbsp;:8080: bind: address already in use
</pre>
<p>デフォルト8080以外を使用したい場合は-portパラメータで指定できます。
</p>
<pre>
$ ts server -port 9090
</pre>
<h4> <span class="mw-headline" id="invalid.E3.81.A8.E3.81.84.E3.81.86.E3.83.A1.E3.83.83.E3.82.BB.E3.83.BC.E3.82.B8.E3.81.8C.E5.87.BA.E3.82.8B">invalidというメッセージが出る</span></h4>
<pre>
$ ts server
2016/02/26 15:02:04 loading stanza /Users/yoko/DBCLS/ts_samples/redo-stanza
2016/02/26 15:02:04 invalid character '1' after object key:value pair
</pre>
<p>metadata.jsonのjsonが不正な場合にエラーが出ることがあります。よくある間違いは、"stanza:usage"のタグ属性のダブルクォーテーションのエスケープ(バックスラッシュ)忘れです。
</p>
<pre>
誤） &quot;stanza:usage&quot;: &quot;&lt;togostanza-redo-stanza start_pos=&quot;1&quot; end_pos=&quot;50&quot;&gt;&lt;/togostanza-redo-stanza&gt;&quot;,
正） &quot;stanza:usage&quot;: &quot;&lt;togostanza-redo-stanza start_pos=\&quot;1\&quot; end_pos=\&quot;50\&quot;&gt;&lt;/togostanza-redo-stanza&gt;&quot;,
</pre>
<p>また、配列の最後の要素にカンマがあってもtsではエラーになります。
</p>
<pre>
  &quot;stanza:parameter&quot;: [
    {
       ・・・・・
    },
    {
      ・・・・・
    },   //このカンマはNG!!
  ],
</pre>
<h2> <span class="mw-headline" id=".E3.82.B9.E3.82.BF.E3.83.B3.E3.82.B6.E3.81.8C.E8.A1.A8.E7.A4.BA.E3.81.95.E3.82.8C.E3.81.AA.E3.81.84">スタンザが表示されない</span></h2>
<p>なにはなくとも、ブラウザのデバッグツールでエラーが出ていないか確認します。<br />
ts serverで起動している場合にはかなり詳細にログが出ています。発行されたSPARQLや戻り値、テンプレートから生成されたHTML文字列など。(ts buildの場合にはほとんどログはでない)
</p>
<h3> <span class="mw-headline" id="SPARQL.E3.81.AE.E3.82.A8.E3.83.A9.E3.83.BC">SPARQLのエラー</span></h3>
<h4> <span class="mw-headline" id=".E3.82.A8.E3.83.B3.E3.83.89.E3.83.9D.E3.82.A4.E3.83.B3.E3.83.88.E3.81.AECORS.E3.81.8C.E6.9C.AA.E5.AF.BE.E5.BF.9C">エンドポイントのCORSが未対応</span></h4>
<p>エラーメッセージの中に'Access-Control-Allow-Origin' という文字列があった場合には、jsからのアクセスをエンドポイントが拒否しています。<br />
<a href="http://wiki.lifesciencedb.jp/mw/SPARQLthon/togostanza_js#.E3.82.B9.E3.82.BF.E3.83.B3.E3.82.B6.E4.BD.9C.E6.88.90.E5.89.8D.E3.81.AE.E7.A2.BA.E8.AA.8D" class="external text" rel="nofollow">スタンザ作成前の確認</a>の確認でエンドポイントが使用できるか、クエリが間違えていないかを確認しましょう。<br />
</p>
<h4> <span class="mw-headline" id="SPARQL.E3.81.AE.E7.B5.90.E6.9E.9C.E3.81.8C.E3.82.A8.E3.83.A9.E3.83.BC">SPARQLの結果がエラー</span></h4>
<p>サーバが落ちていたり、文法エラーであったりその他の理由でエンドポイントから結果が正しく取得できないといった場合には、通常はHTTPステータスはエラーで返されます。<br />
エラーハンドリングしたい場合には、通常のjQueryでのAjax処理のようにdone()メソッドの替わりに、doneとfailを使います。
</p>
<pre>
  var q = stanza.query({
    ・・・・・
  });
  q.done(function(data) { //成功時
    console.log(&quot;done&quot;);
    console.log(data);
  }).fail(function(data) { //エラー発生時
    console.log(&quot;fail&quot;);
    console.log(data);
  });
</pre>
<h3> <span class="mw-headline" id="js.E3.81.AE.E8.A8.98.E8.BF.B0.E3.82.A8.E3.83.A9.E3.83.BC">jsの記述エラー</span></h3>
<p>基本的には一般のjavascriptと同じようにエラーが出ますので、メッセージに従って修正します。<br />
ただし、デバッグツールが示すエラー発生の行番号とindex.js等のファイルの行番号は一致しません。(エラー発生箇所周辺のコードを表示してくれるようなデバッグツールの場合にはあまり問題ありません)<br /><br />
デバッグツールが実際にどこのファイルの行数を指しているかというと、tsコマンド(server/build)で生成されたコンテンツファイルになります。<br />
</p>
<ul><li>[スタンザディレクトリ]/[スタンザ名]/index.js(実際に修正すべき箇所)
</li></ul>
<pre>
13    stanza.render({
14     ・・・・・
15    }; //ここのカッコとじが抜けている
</pre>
<ul><li>[スタンザディレクトリ]/dist/stanza/[スタンザ名]/index.html  (ビルド後のコンテンツで、デバッグツールが指す行番号はこのファイルの行番号)
</li></ul>
<pre>
203    stanza.render({
204      ・・・・・
205    }; //ここのカッコとじが抜けている。しかしこのファイルを直しても意味はない(再コンパイル)
</pre>
<h3> <span class="mw-headline" id=".E3.83.86.E3.83.B3.E3.83.97.E3.83.AC.E3.83.BC.E3.83.88.E3.83.95.E3.82.A1.E3.82.A4.E3.83.AB.28handlebars.29.E3.81.AE.E8.A8.98.E8.BF.B0.E3.82.A8.E3.83.A9.E3.83.BC">テンプレートファイル(handlebars)の記述エラー</span></h3>
<p>エラーを起こしている箇所にhandlebarsという書かれていた場合は、テンプレートファイル(HTML(*.html)やSPARQL(*.rq))の記述に不備がある場合があります。
たとえばテンプレートファイルを閉じ忘れると次のようなエラーメッセージになります(Chromeのデバッグツール)
</p>
<pre>
正） {{raw_data}}
誤）{{raw_data}   //閉じかっこがたりない。

エラーメッセージ
handlebars.min.js:27 Uncaught Error: Parse error on line 16:
...data&lt;/h3&gt;{{raw_data}&lt;h3&gt;bindings&lt;/h3&gt;
----------------------^
</pre>
<h2> <span class="mw-headline" id="js_.E3.83.A9.E3.82.A4.E3.83.96.E3.83.A9.E3.83.AA.E3.81.8C.E5.8B.95.E3.81.8B.E3.81.AA.E3.81.84">js ライブラリが動かない</span></h2>
<p>あるjsライブラリが動かない、描画が崩れるといった場合には、<a href="http://wiki.lifesciencedb.jp/mw/SPARQLthon/togostanza_js#js.E3.81.AE.E7.AB.B6.E5.90.88" class="external text" rel="nofollow">jsの競合</a>やライブラリがShadowDOMに対応していない<a href="http://wiki.lifesciencedb.jp/mw/SPARQLthon/togostanza_js#.E6.8F.8F.E7.94.BB.E3.83.A9.E3.82.A4.E3.83.96.E3.83.A9.E3.83.AA" class="external text" rel="nofollow">描画ライブラリ</a>といった原因が考えられます。
</p>
<h3> <span class="mw-headline" id="jQuery.E3.83.97.E3.83.A9.E3.82.B0.E3.82.A4.E3.83.B3.E3.81.A8.E3.81.97.E3.81.A6.E4.BD.9C.E6.88.90.E3.81.95.E3.82.8C.E3.81.9F.E3.83.A9.E3.82.A4.E3.83.96.E3.83.A9.E3.83.AA">jQueryプラグインとして作成されたライブラリ</span></h3>
<p>以下のようなメッセージが出る場合にはライブラリがjQueryを拡張していることが原因と考えられます。(ライブラリ読み込み後にスタンザ側でjQueryをロードし直すので、上書き分がなかったことになる)
</p>
<pre>
Uncaught TypeError: $(...).XXXXX is not a function
</pre>
<h1> <span class="mw-headline" id=".E6.B3.A8.E6.84.8F.E4.BA.8B.E9.A0.85">注意事項</span></h1>
<h2> <span class="mw-headline" id="js.E3.81.AE.E7.AB.B6.E5.90.88_.28ts_v0.0.8.E4.BB.A5.E5.89.8D.29">jsの競合 (ts v0.0.8以前)</span></h2>
<p>各スタンザがjQueryなどのjsライブラリをページグローバルな環境に読み込むため、jsの競合（上書きによる不整合）が発生するケースがある。<br />
影響範囲スタンザを埋め込んだページ全体になる<br />
</p>
<ul><li>jQueryのプラグインは基本的には使用できない, <a href="http://wiki.lifesciencedb.jp/mw/SPARQLthon/togostanza_js#Web_Components_v1_.E5.AF.BE.E5.BF.9C.E3.81.A8_jQuery_.E6.8E.92.E9.99.A4" class="external text" rel="nofollow">Web Components v1 対応と jQuery 排除</a>
</li></ul>
<p>bootstrap(一部動作はする)やhighcharts等...
</p>
<ul><li>スタンザ同士で変数名(グローバル変数)やライブラリ名(違い内容で同名)が衝突をしないように気をつける
</li></ul>
<h2> <span class="mw-headline" id=".E6.8F.8F.E7.94.BB.E3.83.A9.E3.82.A4.E3.83.96.E3.83.A9.E3.83.AA">描画ライブラリ</span></h2>
<p>ShadowDOMに未対応(想定していない)描画ライブラリでは、正しく描画できない、表示位置がズレる等の不具合が出ることがある。<br />
例えば、ライブラリが内部でウェブページの左上の起点を探す際に&lt;body&gt;タグを探して位置決めしている場合があり、Shadow DOM(スタンザ)内には&lt;body&gt;タグが存在しないため、スタンザを内包するWebページの&lt;body&gt;タグを見てしまい、位置ズレが発生するというケースがある。<br />
描画の不具合を確認したツール(2016年1月現在)
</p>
<ul><li>plotly.js (軸タイトル等の表示位置がズレてしまう)
</li><li>3Dmol.js (Styleでbodyタグからの絶対位置を用いている箇所があったため、コードを修正して使用)
</li><li>chartjs(よく分からないが描画されない)
</li></ul>
<p><br />
ただし、D3.js等の低機能なチャートライブラリの場合には問題なく動作する。また、&lt;body&gt;タグやDocumentのルートを意識していないライブラリについても使用できると思われる(<a href="http://nvd3.org/index.html" class="external text" rel="nofollow">NVD</a>は動きそう)<br />
</p>
<h1> <span class="mw-headline" id="Web_Components_v1_.E5.AF.BE.E5.BF.9C.E3.81.A8_jQuery_.E6.8E.92.E9.99.A4">Web Components v1 対応と jQuery 排除</span></h1>
<ul><li> 注意：ts v0.0.9 以降は下記に対応済み
</li><li> Web Components
<ul><li> 現在の JS 版 stanza は Web Components v0
</li><li> 今後は v1 が普及予定
</li><li> iOS のブラウザは v1 のみ対応なので表示すらできない
</li></ul>
</li><li> jQuery
<ul><li> jQuery, bootstrap はまだまだサイトで使われてるので競合すると困る
</li></ul>
</li></ul>
<h2> <span class="mw-headline" id="v1.E5.AF.BE.E5.BF.9C">v1対応</span></h2>
<ul><li> ソースの stanza/data/help.html, provider/provider.go（ts build で生成される dist/stanza/stanza-name/help.html）で webcomponentjs 変更
<ul><li> 現在の v0: webcomponents.min.js ver. 0.5.5
</li><li> v1: <a href="https://github.com/webcomponents/webcomponentsjs" class="external free" rel="nofollow">https://github.com/webcomponents/webcomponentsjs</a> の webcomponents-loader.js + webcomponents-******.js
<ul><li> 読み込むのは webcomponents-loader.js だけで、他は同じディレクトリに入れるために provider/provider.go に追記
</li></ul>
</li></ul>
</li><li> ソースの stanza/data/stanza.js（ts build で生成される dist/stanza/stanza-name/index.js) を書き換え
</li></ul>
<pre>
  /* v0 の部分をコメントアウト
  proto.createdCallback = function() {
    var shadow = this.createShadowRoot();
  
    var style = document.createElement(&quot;style&quot;);
    style.appendChild(document.createTextNode(descriptor.stylesheet));
    shadow.appendChild(style);
    var main = document.createElement(&quot;main&quot;);
    shadow.appendChild(main);
  
    update(this);
  };
  
  proto.attributeChangedCallback = function(attrName, oldVal, newVal) {
    var found = false;
    descriptor.parameters.forEach(function(key) {
      if (attrName == key) {
        found = true;
      }
    });
    if (found) {
      update(this);
    }
  };
  
  document.registerElement(descriptor.elementName, {
    prototype: proto
  });
  */
</pre>
<pre>
  // v1 ぽく書き換え
  class StanzaElement extends HTMLElement {
    constructor() {
      super(); 
      var shadow = this.attachShadow({ mode: 'open' });
      var style = document.createElement(&quot;style&quot;);
      style.appendChild(document.createTextNode(descriptor.stylesheet));
      shadow.appendChild(style);
      var main = document.createElement(&quot;main&quot;);
      shadow.appendChild(main);
  
      update(this);
    }
    attributeChangedCallback(attrName, oldVal, newVal) {
      var found = false;
      descriptor.parameters.forEach(function(key) {
        if (attrName == key) {
          found = true;
        }
      });
      if (found) {
        update(this);
      }
    }
  }
  
  if ('customElements' in window &amp;&amp;&nbsp;!window.customElements.get(descriptor.elementName)) {
     window.customElements.define(descriptor.elementName, StanzaElement);
  }
</pre>
<ul><li> ts build したものは stanza更新したりすると、自動で書き換わってもとに戻るので、動作確認にしか使えません
</li></ul>
<h2> <span class="mw-headline" id="jQuery.E6.8E.92.E9.99.A4">jQuery排除</span></h2>
<ul><li> ついでに競合すると困りやすい jQuery 排除
<ul><li> ソースの stanza/data/index.html で jQuery 呼び出しを削除
</li><li> ソースの stanza/data/stanza.js 書き換え
</li></ul>
</li></ul>
<pre>
  // jQuery ---------------------------
  /*        var p = $.ajax({
          method: method,
          url: params.endpoint,
          headers: {
            &quot;Accept&quot;: &quot;application/sparql-results+json&quot;
          },
          data: {
            query: query
          }
        }); */
  // Native (Fetch API)----------------
        var p = fetch(params.endpoint + '?query=' + query, {
          method: method,
          mode: 'cors',
          headers: {
            &quot;Accept&quot;: &quot;application/sparql-results+json&quot;
          }
        }).then(res =&gt; res.json());
  //-----------------------------------
</pre>
<pre>
  // jQuery-----------------
        /* $(selector, element.shadowRoot).html(htmlFragment); */
  // Native-----------------
        element.shadowRoot.querySelector(selector).innerHTML = htmlFragment;
  //------------------------
</pre>
<ul><li> 各 stanza の index.js で jQuery コードを使っている場合は _header.html で jQuery を読み込む必要があります
</li><li> index.js で jQuery を使わずコードする場合
<ul><li> 複数クエリ、APIの並列実行の例
</li></ul>
</li></ul>
<pre>
Stanza(function(stanza, params) {
  // SPARQL query 1
  var q1 = stanza.query({
    endpoint: &quot;http://exapmle.org/sparql&quot;,
    template: &quot;query1.rq&quot;,
    parameters: params
  });
  // SPARQL query 2
  var q2 = stanza.query({
    endpoint: &quot;http://example.com/sparql&quot;,
    template: &quot;query2.rq&quot;,
    parameters: params
  });
  // other API
  var q3 = fetch( &quot;http://example.of/api/url?param=val&quot;, {
        method: 'get',
        mode: 'cors',
  }).then(res =&gt; res.json());  // プレーンテキストで受けるなら res.text()

    var q = Promise.all([q1, q2, q3]);

    q.then(function([data1, data2, data3]){
    // jQuery の $.when() と違い data1[0] ではなく、data1 で SPARQL 結果が取得できる 
    var query1_list = data1.results.bindings;
    var query2_list = ......
　　.......
    stanza.render({
      template: &quot;stanza.html&quot;,
      parameters: {
        result: all_list
      }
    });
  });
});
</pre>
<h2> <span class="mw-headline" id=".E3.83.86.E3.82.B9.E3.83.88.E7.94.A8.E3.83.90.E3.82.A4.E3.83.8A.E3.83.AA.E3.80.81.E3.82.BD.E3.83.BC.E3.82.B9">テスト用バイナリ、ソース</span></h2>
<ul><li> 上記を実装してみたバイナリ (ts v0.0.8mod)
<ul><li> <a href="https://drive.google.com/open?id=0B_NAUKeuU1pmejg1RVJtX0lmRXM" class="external text" rel="nofollow">linux_amd64</a> (for linux)
</li><li> <a href="https://drive.google.com/open?id=0B_NAUKeuU1pmWE9DZVlwTFREMG8" class="external text" rel="nofollow">darwin_amd64</a> (for mac)
<ul><li> webcomponentsjs v1.0.14
</li><li> handlebars v4.0.10
</li><li> 親要素にはみ出る要らない css 削除
</li></ul>
</li></ul>
</li><li> <a href="https://github.com/togostanza/ts/tree/wc_v1" class="external text" rel="nofollow">github branch</a>
</li></ul>

<!-- 
NewPP limit report
Preprocessor node count: 637/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key wikidb-togowiki_:pcache:idhash:672-0!1!0!!ja!2!edit=0 and timestamp 20230808051730 -->
<div class="printfooter">
「<a href="http://wiki.lifesciencedb.jp/mw/SPARQLthon/togostanza_js">http://wiki.lifesciencedb.jp/mw/SPARQLthon/togostanza_js</a>」より作成</div>
		<div id='catlinks' class='catlinks catlinks-allhidden'></div>		<!-- end content -->
				<div class="visualClear"></div>
	</div>
</div></div>
<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>表示</h5>
		<div class="pBody">
			<ul>
				 <li id="ca-nstab-main" class="selected"><a href="togostanza_js.html" title="本文を表示 [c]" accesskey="c">ページ</a></li>
				 <li id="ca-talk" class="new"><a href="https://wiki.lifesciencedb.jp/mw/index.php?title=%E3%83%8E%E3%83%BC%E3%83%88:SPARQLthon/togostanza_js&amp;action=edit&amp;redlink=1" title="記事についての議論 [t]" accesskey="t">議論</a></li>
				 <li id="ca-viewsource"><a href="../index.php@title=SPARQLthon%252Ftogostanza_js&amp;action=edit.html" title="このページは保護されています。&#10;ページのソースを閲覧できます。 [e]" accesskey="e">ソースを表示</a></li>
				 <li id="ca-history"><a href="../index.php@title=SPARQLthon%252Ftogostanza_js&amp;action=history.html" title="このページの過去の版 [h]" accesskey="h">履歴</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>個人用ツール</h5>
		<div class="pBody">
			<ul>
				<li id="pt-anonuserpage"><a href="https://wiki.lifesciencedb.jp/mw/%E5%88%A9%E7%94%A8%E8%80%85:172.18.8.51" title="自分が編集しているIPアドレスの利用者ページ [.]" accesskey="." class="new">172.18.8.51</a></li>
				<li id="pt-anontalk"><a href="https://wiki.lifesciencedb.jp/mw/%E5%88%A9%E7%94%A8%E8%80%85%E2%80%90%E4%BC%9A%E8%A9%B1:172.18.8.51" title="このIPアドレスからなされた編集についての議論 [n]" accesskey="n" class="new">このIPアドレスのトーク</a></li>
				<li id="pt-anonlogin"><a href="../index.php@title=特別%253Aログイン&amp;returnto=SPARQLthon%252Ftogostanza_js.html" title="ログインすることが推奨されます。ただし、必須ではありません。 [o]" accesskey="o">ログイン</a></li>
				<li id="pt-openidlogin"><a href="../index.php@title=特別%253AOpenIDログイン&amp;returnto=SPARQLthon%252Ftogostanza_js.html">OpenIDでログイン</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a style="background-image: url(../images/togowiki-logo.png);" href="../メインページ.html" title="メインページに移動"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
	<div class='generated-sidebar portlet' id='p-navigation'>
		<h5>案内</h5>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage-description"><a href="../メインページ.html" title="メインページに移動する [z]" accesskey="z">メインページ</a></li>
				<li id="n-portal"><a href="https://wiki.lifesciencedb.jp/mw/TogoWiki:%E3%82%B3%E3%83%9F%E3%83%A5%E3%83%8B%E3%83%86%E3%82%A3%E3%83%BB%E3%83%9D%E3%83%BC%E3%82%BF%E3%83%AB" title="このプロジェクトについて、できること、情報を入手する場所">コミュニティ・ポータル</a></li>
				<li id="n-currentevents"><a href="https://wiki.lifesciencedb.jp/mw/TogoWiki:%E6%9C%80%E8%BF%91%E3%81%AE%E5%87%BA%E6%9D%A5%E4%BA%8B" title="最近の出来事について予備知識を得る">最近の出来事</a></li>
				<li id="n-recentchanges"><a href="../特別%253A最近の更新.html" title="ウィキにおける最近の更新の一覧 [r]" accesskey="r">最近の更新</a></li>
				<li id="n-randompage"><a href="../特別%253Aおまかせ表示.html" title="無作為に抽出されたページの読み込み [x]" accesskey="x">おまかせ表示</a></li>
				<li id="n-help"><a href="https://wiki.lifesciencedb.jp/mw/Help:%E7%9B%AE%E6%AC%A1" title="情報を得る場所">ヘルプ</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">検索</label></h5>
		<div id="searchBody" class="pBody">
			<form action="https://wiki.lifesciencedb.jp/mw/index.php" id="searchform">
				<input type='hidden' name="title" value="特別:検索"/>
				<input id="searchInput" title="TogoWiki内を検索" accesskey="f" type="search" name="search" />
				<input type='submit' name="go" class="searchButton" id="searchGoButton"	value="表示" title="厳密に一致する名前のページが存在すれば、そのページへ移動します" />&nbsp;
				<input type='submit' name="fulltext" class="searchButton" id="mw-searchButton" value="検索" title="入力された文字列が含まれるページを検索します" />
			</form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>ツールボックス</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="../特別%253Aリンク元/SPARQLthon/togostanza_js.html" title="ここにリンクしている全ウィキのページの一覧 [j]" accesskey="j">リンク元</a></li>
				<li id="t-recentchangeslinked"><a href="../特別%253A関連ページの更新状況/SPARQLthon/togostanza_js.html" title="このページからリンクしているページの最近の更新 [k]" accesskey="k">関連ページの更新状況</a></li>
<li id="t-specialpages"><a href="../特別%253A特別ページ一覧.html" title="特別ページの一覧 [q]" accesskey="q">特別ページ</a></li>
				<li id="t-print"><a href="../index.php@title=SPARQLthon%252Ftogostanza_js&amp;printable=yes.html" rel="alternate" title="このページの印刷用ページ [p]" accesskey="p">印刷用バージョン</a></li>				<li id="t-permalink"><a href="../index.php@title=SPARQLthon%252Ftogostanza_js&amp;oldid=25276.html" title="ページのこの版への固定リンク">この版への固定リンク</a></li>			</ul>
		</div>
	</div>
</div><!-- end of the left (by default at least) column -->
<div class="visualClear"></div>
<div id="footer">
	<div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="../skins/common/images/poweredby_mediawiki_88x31.png" height="31" width="88" alt="Powered by MediaWiki" /></a></div>
	<div id="f-copyrightico"><a href="http://creativecommons.org/licenses/by/3.0/"><img src="http://i.creativecommons.org/l/by/3.0/88x31.png" alt="Attribution 3.0 Unported" width="88" height="31" /></a></div>
	<ul id="f-list">
		<li id="lastmod"> このページの最終更新は 2019年10月11日 (金) 06:57 に行われました。</li>
		<li id="viewcount">このページは51,532回アクセスされました。</li>
		<li id="copyright">内容は<a href="http://creativecommons.org/licenses/by/3.0/" class="external ">Attribution 3.0 Unported</a>のライセンスで利用することができます。</li>
		<li id="privacy"><a href="../TogoWiki%253Aプライバシー・ポリシー.html" title="TogoWiki:プライバシー・ポリシー">プライバシー・ポリシー</a></li>
		<li id="about"><a href="../TogoWiki%253ATogoWikiについて.html" title="TogoWiki:TogoWikiについて">TogoWikiについて</a></li>
		<li id="disclaimer"><a href="https://wiki.lifesciencedb.jp/mw/TogoWiki:%E5%85%8D%E8%B2%AC%E4%BA%8B%E9%A0%85" title="TogoWiki:免責事項">免責事項</a></li>
	</ul>
</div>
</div>

<script>if (window.runOnloadHook) runOnloadHook();</script>
<!-- Served in 0.380 secs. --></body></html>
